(function(d){d.fn.rssfeed=function(f,e,g){var h={limit:10,header:true,titletag:"h4",date:true,content:true,snippet:true,media:true,showerror:true,errormsg:"",key:null,ssl:false,linktarget:"_self"};var e=d.extend(h,e);return this.each(function(k,n){var j=d(n);var m="";if(e.ssl){m="omnicollagio"}if(!j.hasClass("rssFeed")){j.addClass("rssFeed")}if(f==null){return false}var l="http"+m+"://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=?&q="+encodeURIComponent(f);if(e.limit!=null){l+="&num="+e.limit}if(e.key!=null){l+="&key="+e.key}l+="&output=json_xml";d.getJSON(l,function(i){if(i.responseStatus==200){b(n,i.responseData,e);if(d.isFunction(g)){g.call(this,j)}}else{if(e.showerror){if(e.errormsg!=""){var o=e.errormsg}else{var o=i.responseDetails}}d(n).html('<div class="rssError"><p>'+o+"</p></div>")}})})};var b=function(y,z,j){var o=z.feed;if(!o){return false}var p="";var l="odd";if(j.media){var k=a(z.xmlString);var g=k.getElementsByTagName("item")}if(j.header){p+='<div class="rssHeader"><a href="'+o.link+'" title="'+o.description+'">'+o.title+"</a></div>"}p+='<div class="rssBody"><ul>';for(var x=0;x<o.entries.length;x++){var h=o.entries[x];var w;if(h.publishedDate){var n=new Date(h.publishedDate);var w=n.toLocaleDateString()+" "+n.toLocaleTimeString()}p+='<li class="rssRow '+l+'"><'+j.titletag+'><a href="'+h.link+'" title="View this feed at '+o.title+'">'+h.title+"</a></"+j.titletag+">";if(j.date&&w){p+="<div>"+w+"</div>"}if(j.content){if(j.snippet&&h.contentSnippet!=""){var v=h.contentSnippet}else{var v=h.content}p+="<p>"+v+"</p>"}if(j.media&&g.length>0){var u=g[x].getElementsByTagName("enclosure");if(u.length>0){p+='<div class="rssMedia"><div>Media files</div><ul>';for(var t=0;t<u.length;t++){var q=u[t].getAttribute("url");var r=u[t].getAttribute("type");var f=u[t].getAttribute("length");p+='<li><a href="'+q+'" title="Download this media">'+q.split("/").pop()+"</a> ("+r+", "+c(f)+")</li>"}p+="</ul></div>"}p+="</li>"}if(l=="odd"){l="even"}else{l="odd"}}p+="</ul></div>";d(y).html(p);d("a",y).attr("target",j.linktarget)};function c(f){var g=["bytes","kb","MB","GB","TB","PB"];var h=Math.floor(Math.log(f)/Math.log(1024));return(f/Math.pow(1024,Math.floor(h))).toFixed(2)+" "+g[h]}function a(g){var f=navigator.appName;var e;if(f=="Microsoft Internet Explorer"){e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML(g)}else{e=(new DOMParser()).parseFromString(g,"text/xml")}return e}})(jQuery);(function(){var a,b;if((b=global.myd)==null){global.myd={}}a=(function(){function c(d){var e;this.parser=document.createElement("a");this.parser.href=d;e=this.parser.search.slice(1);this.queryItems=this.buildQueryItems(e)}c.prototype.toString=function(){return this.getProtocol()+"//"+this.getHost()+this.getPathname()+this.getQuery()+this.getHash()};c.prototype.buildQueryItems=function(d){return _.chain(d.split("&")).map(function(e){return e.split("=")}).map(function(e){var f,g;f=e[0],g=e[1];return{key:decodeURIComponent(f).toLowerCase(),value:decodeURIComponent(g)}}).value()};c.prototype.get=function(d){return _.find(this.queryItems,function(e){return e.key===d.toLowerCase()})};c.prototype.set=function(d,f){var e;e=this.get(d);if(e!=null){return e.value=f}else{return this.queryItems.push({key:d,value:f})}};c.prototype.getQuery=function(){var d;d=_.map(this.queryItems,function(e){return""+(encodeURIComponent(e.key))+"="+(encodeURIComponent(e.value))});return"?"+d.join("&")};c.prototype.getProtocol=function(){return this.parser.protocol};c.prototype.getHost=function(){return this.parser.host};c.prototype.getHostname=function(){return this.parser.hostname};c.prototype.getPort=function(){return this.parser.port};c.prototype.getPathname=function(){var d;d=this.parser.pathname;if(d.charAt(0)!=="/"){return"/"+d}else{return d}};c.prototype.getHash=function(){return this.parser.hash};return c})();global.myd.Uri=a}).call(this);(function(){var c,b,a;c=function(d){return d.charAt(0).toUpperCase()+d.slice(1)};b=function(f,e,d){if(f[e]!==1){d=""+d+"omnicollagio"}f[""+e+"_text"]=d;return f};a=function(e,d){if(e.length!==1){d=""+d+"omnicollagio"}return d};global.myd.pluralizeIfNeededText=a;global.myd.pluralizeIfNeeded=b;global.myd.capFirstLetter=c}).call(this);(function(){var a,b;if((b=global.myd)==null){global.myd={}}a=(function(){function c(d){this.queryItems=this.buildQueryItems(d)}c.prototype.buildQueryItems=function(d){return _.chain(d.split("&")).map(function(e){return e.split("=")}).map(function(e){var f,g;f=e[0],g=e[1];return{key:f.toLowerCase(),value:g}}).value()};c.prototype.get=function(d){return _.find(this.queryItems,function(e){return e.key===d.toLowerCase()})};c.prototype.getQuery=function(){var d;d=_.map(this.queryItems,function(e){return""+(encodeURIComponent(e.key))+"="+(encodeURIComponent(e.value))});return"?"+d.join("&")};return c})();global.myd.QueryStringParser=a}).call(this);(function(){var a,b;if((b=global.myd)==null){global.myd={}}a=(function(){function c(d){var h,k,j,g,f,i,e;f=this;this.imageList=[];for(g=i=0,e=d.length;i<e;g=++i){h=d[g];h=$(h);j=h.find(".image").attr("src");k=$("<img/>");k.data("height",h.outerHeight());k.data("width",h.outerWidth());k.data("image-key",g);this.imageList.push(h);k.load(function(m){var n,w,v,p,t,u,q,o,r,l;p=this;v=p.height;l=p.width;t=$(p).data("height");u=$(p).data("width");r=1;n=document.createElement("canvas");w=n.getContext("2d");n.width=u;n.height=t;if(p.width/p.height>=n.width/n.height){r=n.height/p.height;p.height=t;p.width=p.width*r;q=-1*Math.abs((p.width-n.width)/2);o=0}else{r=n.width/p.width;p.width=u;p.height=p.height*r;q=0;o=-1*Math.abs((p.height-n.height)/2)}w.drawImage(p,q,o,p.width,p.height);f.imageList[$(this).data("image-key")].find("canvas").remove();return f.imageList[$(this).data("image-key")].append(n)});k.attr("src",j)}}return c})();global.myd.ImageCenter=a}).call(this);(function(){var b,c,d,a;if((d=global.myd)==null){global.myd={}}if((a=(c=global.myd).common)==null){c.common={}}b=function(f){var e,g;if(f.get("item").get("type")==="collection"&&f.get("item").get("is_topic")){return Router.navigate("topic/"+(f.get("item").get("uid")),{trigger:true})}else{if(f.get("item").get("type")==="collection"){g=f.get("item").get("entity_url");e=myd.routesModule.getRoutesFromUrl(g);return Router.navigate(e.getPapyrusPath(),{trigger:true})}else{if(f.get("item").get("type")==="user"){g=f.get("item").get("entity_url");return Router.navigateToProfileTab({userPath:new global.myd.Uri(g).getPathname(),tab:"collections"})}else{if(f.get("item").get("type")!=="collection"){return this.itemLightboxView=new myd.ItemLightboxView({model:f})}}}}};global.myd.common.selectedScreen=b}).call(this);(function(){var a,b;global.myd||(global.myd={});b=function(e){var c,d;c={};d=e.split("=");c[d[0]]=unescape(d[1]);return c};a=function(){var g,f,e,d,c;if(window.location.search){f=window.location.search.slice(1).split("&");c=[];for(e=0,d=f.length;e<d;e++){g=f[e];c.push(b(g))}return c}};global.myd.ResetFeatureFlags=function(){var d,f,c,e;global.myd.feature={};e=_.filter(a(),function(g){return !!g.ff});for(f=0,c=e.length;f<c;f++){d=e[f];if(d.ff==="publish"){document.cookie="publish=true;path=/"}global.myd.feature[d.ff]=true}if(document.domain==="system-integration.collagio.com"){return global.myd.feature.testing=true}};if(typeof window!=="undefined"&&window!==null){global.myd.ResetFeatureFlags()}}).call(this);(function(){var a;if((a=global.myd)==null){global.myd={}}global.myd.FlashUploaderRequest=function(){var b;b=function(){return $(".close-add-item").click()};return{closeWindow:b}}}).call(this);(function(){var c,a,b;if((b=global.myd)==null){global.myd={}}a={"return":13,escape:27,left:37,up:38,right:39,down:40};c={returnPress:function(d){return d.keyCode===a["return"]},escapePress:function(d){return d.keyCode===a.escape},leftArrowPress:function(d){return d.keyCode===a.left},upArrowPress:function(d){return d.keyCode===a.up},rightArrowPress:function(d){return d.keyCode===a.right},downArrowPress:function(d){return d.keyCode===a.down}};global.myd.inputModule=c}).call(this);(function(){var a;if((a=global.myd)==null){global.myd={}}global.myd.modalAlert=function(b){return window.alert(b)}}).call(this);(function(){var a;if((a=global.myd)==null){global.myd={}}global.myd.Placeholder=function(){var c,b;b=function(d){$("[placeholder]",d).each(function(){var e;if($(this).is("input")){e=$(this);if(e.val().trim()===""||e.val().trim()===e.attr("placeholder")){return e.addClass("placeholder").val(e.attr("placeholder"))}}else{e=$(this);if(e.text().trim()===""||e.text().trim()===e.attr("placeholder")){return e.addClass("placeholder").text(e.attr("placeholder"))}}});return $("[placeholder]").focus(function(){var e;if($(this).is("input")){e=$(this);if(e.val()===e.attr("placeholder")){return e.val("").removeClass("placeholder")}}else{e=$(this);if(e.text()===e.attr("placeholder")){e.text("").removeClass("placeholder")}return this.focus()}}).blur(function(){var e;if($(this).is("input")){e=$(this);if(e.val()===""||e.val()===e.attr("placeholder")){return e.addClass("placeholder").val(e.attr("placeholder"))}}else{e=$(this);if(e.text()===""||e.text()===e.attr("placeholder")){return e.addClass("placeholder").text(e.attr("placeholder"))}}}).blur().parents("form").submit(function(){return $(this).find("[placeholder]").each(function(){var e;if($(this).is("input")){e=$(this);if(e.val()===e.attr("placeholder")){return e.val("")}}else{e=$(this);if(e.text()===e.attr("placeholder")){return e.text("")}}})})};c=function(d){return $("[placeholder]",d).each(function(){var e;if($(this).is("input")){e=$(this);if(e.val()===e.attr("placeholder")){return e.val("")}}else{e=$(this);if(e.text()===e.attr("placeholder")){return e.text("")}}})};return{refresh:b,clean:c}}}).call(this);(function(){var a,b;if((b=global.myd)==null){global.myd={}}a={getRoutesFromRelativePath:function(c){var d;if(c.substr(0,1)==="/"){d=c}else{d="/"+c}return{pathname:d,getPapyrusPath:function(e){if(e!=null){return"/c"+d+"/screens/"+(encodeURIComponent(e))}else{return"/c"+d}}}},getRoutesFromUrl:function(c,e){var d;d=new myd.Uri(c).getPathname();return{pathname:d,getPapyrusPath:function(f){if(f!=null){return"/c"+d+"/screens/"+(encodeURIComponent(f))}else{return"/c"+d}}}}};global.myd.routesModule=a}).call(this);(function(){var d,m,c,e,j,l,n,b,h,a,i,g,k,f;if((f=global.myd)==null){global.myd={}}n=function(A,p,x,t){var y,z,q,B,o,w,v,u,r;if(p==null){p="collections"}if(x==null){x={showActions:false,showLikeButton:false,showReuseButton:false,showFacebookShareButton:false,showScreenNavigation:false,showDeleteButton:false}}if(t==null){t=null}if(A.item!=null){A.item=A.item.toJSON()}else{A.item=A}A.item[A.item.type+"Type"]=true;o=A.item.entity_url;B=myd.routesModule.getRoutesFromUrl(o);A.item.app_url="/papyrus"+B.getPapyrusPath();_.map(x,function(D,C){return A[C]=D});if(A.item.type==="fact"){A.item.text=markdown.toHTML((w=A.item.text)!=null?w:"")}else{if(A.item.type==="collection"){myd.pluralizeIfNeeded(A.item,"screens_count","Element");A.item.thumbnail_url=(v=A.item.cover_asset)!=null?v.thumbnail_url:void 0;A.item.image_745_url=(u=A.item.cover_asset)!=null?u.image_745_url:void 0;A.item.image_300_url=(r=A.item.cover_asset)!=null?r.image_300_url:void 0;if(A.item.is_topic!=null){myd.pluralizeIfNeeded(A.item,"screens_count","Collage");A.item.app_url="/papyrus/topic/"+A.item.uid}else{q=new Date();z=new Date();if(A.item.modified_timestamp!=null){z.setTime(A.item.modified_timestamp*1000);A.item.created=g(q,z)}else{if(A.item.created_timestamp!=null){z.setTime(A.item.created_timestamp*1000);A.item.created=g(q,z)}else{A.item.created=""}}if(A.item.screens_count!=null){myd.pluralizeIfNeeded(A.item,"screens_count","Element")}else{A.item.screens_count_text=""}}}else{delete A.item.title}}A.item.domain=new myd.Uri(A.item.source_page_url).getHost();if(global.myd.feature.testing){A.item.thumbnail_url="/images/default_new_collection.png";A.item.asset_url="/images/default_new_collection.png";A.item.image_150_url="/images/default_new_collection.png";A.item.image_300_url="/images/default_new_collection.png";A.item.image_745_url="/images/default_new_collection.png";A.item.image_1024_url="/images/default_new_collection.png";A.item.image_2048_url="/images/default_new_collection.png"}if(p==="reorder"){return Mustache.render($("#reorder_screen_template").html(),A.item)}else{if(p==="collections"&&A.item.type==="collection"&&!A.item.is_topic){if(A.item.screens!=null){y=A.item.screens.slice(0,6);_.each(y,function(C){var D;if(C.item.type==="fact"){return C.item.text=markdown.toHTML((D=i(C.item.text))!=null?D:"")}else{if(C.item.type==="video"&&(C.item.youtube_id!=null)){return C.item.thumbnail_url=c(C.item.youtube_id)}}});A.item.screens=y}return Mustache.render($("#full_screen_inline_template").html(),A,{screen_nav_template:$("#screen_nav_template").html(),collage_screens_template:$("#collage_screens_template").html()})}else{if(A.item.type==="collection"&&!A.item.is_topic){if(!A.item.view_count||A.item.view_count<1){A.item.view_count="0"}if(!A.item.total_comment_count||A.item.total_comment_count<1){A.item.total_comment_count="0"}return Mustache.render($("#explore_screen_template").html(),A)}else{if(A.item.type==="collection"&&A.item.is_topic){return Mustache.render($("#topic_item_template").html(),A)}else{if(p==="collections"||p==="itemlightbox"||p==="reuse"){return Mustache.render($("#full_screen_inline_template").html(),A,{screen_nav_template:$("#screen_nav_template").html()})}else{if(A.item.type==="user"&&p==="profile"){return Mustache.render($("#search_user_screen_template").html(),A)}else{q=new Date();z=new Date();if(A.item.modified_timestamp!=null){z.setTime(A.item.modified_timestamp*1000);A.item.created=g(q,z)}else{if(A.item.created_timestamp!=null){z.setTime(A.item.created_timestamp*1000);A.item.created=g(q,z);if(!(A.item.view_count!=null)||A.item.view_count<1){A.item.view_count="0"}if(!(A.item.comment_count!=null)||A.item.comment_count<1){A.item.comment_count="0"}}}if(A.item.type==="user"){return Mustache.render($("#search_user_screen_template").html(),A)}else{return Mustache.render($("#full_screen_template").html(),A)}}}}}}}};i=function(p){var o;if(typeof p==="undefined"||p===null){return""}o=p.replace(/\[/g,"");o=o.replace(/]/g,"");o=o.replace(/\)/g,"");return o.replace(/\(/g,"")};j=function(o,p,r,q){var t;t=o.get("item");return l(t,o.get("index"),p,r)};l=function(T,O,z,v){var Q,H,F,S,C,B,R,U,D,L,K,J,M,I,q,P,u,E,G,x,A,y,w,t,r,p,o,N=this;if(O==null){O=0}H=5;S=T.get("screens");F=0;q="";I=[];M="/images/placeholder-logo.jpg";G="/images/placeholder-logo.jpg";K=((A=T.get("cover_asset"))!=null?A.preview_image_url:void 0)||G;R=((y=T.get("cover_asset"))!=null?y.image_150_url:void 0)||G;D=((w=T.get("cover_asset"))!=null?w.image_300_url:void 0)||G;L=((t=T.get("cover_asset"))!=null?t.image_745_url:void 0)||G;B=((r=T.get("cover_asset"))!=null?r.image_1024_url:void 0)||G;U=((p=T.get("cover_asset"))!=null?p.image_2048_url:void 0)||G;u=T.get("description")===""||T.get("description")===null?"":" with-description";if(myd.feature.testing){C=M}q="<div class='asset"+u+"'><div class='gradient'></div><div class='frame'><img class='image' data-src-thumb='"+K+"' data-src-150='"+R+"' data-src-300='"+D+"' data-src-745='"+L+"' data-src-1024='"+B+"' data-src-2048='"+U+"'></div></div>";I.push(q);F++;_.map(S,function(Z,X){var W,V,aa,ab,Y;if(Z.item.type==="image"||Z.item.type==="fact"||Z.item.type==="video"){if(Z.item.type==="image"||Z.item.type==="video"){ab=Z.item.image_150_url||M;if(myd.feature.testing){ab=M}if(F<H){q="<div class='tile'><div class='frame'><img class='image' src='"+ab+"'></div></div>";I.push(q)}}else{if(Z.item.type==="fact"){aa=Z.item.text;W=aa.match(/<\/?\w+((\s+\w+(\s*=\s*(?:".*?"|'.*?'|[^'">\s]+))?)+\s*|\s*)\/?>/);if(!(W!=null)){Z.item.text=markdown.toHTML((Y=i(aa))!=null?Y:"")}V=Z;if(F<H){q=Mustache.render($("#collage_fact_tile_template").html(),V);I.push(q)}}}return F++}});if(F<H){for(P=x=1,o=H-F;1<=o?x<=o:x>=o;P=1<=o?++x:--x){if(P%2===0){q="<div class='tile placeholder even'></div>";I.push(q)}else{q="<div class='tile placeholder'></div>";I.push(q)}}}J=I[0];E=I.slice(1,I.length);v.find(".link").prepend(J);$.each(E,function(V,W){return v.find(".mini-tiles").append(W)});Q=v.find(".fact-wrapper");return $.each(Q,function(W,V){if(W%2){return $(V).addClass("even")}})};g=function(v,u){var p,t,w,o,r,q;o=60*1000;w=o*60;t=w*24;r=t*30;q=t*365;p=v-u;if(p<o){return Math.round(p/1000)+"s ago"}else{if(p<w){return Math.round(p/o)+"m ago"}else{if(p<t){return Math.round(p/w)+"h ago"}else{if(p<r){return Math.round(p/t)+"d ago"}else{if(p<q){return Math.round(p/r)+"mo ago"}else{return Math.round(p/q)+"y ago"}}}}}};h=function(o){if(global.myd.feature.testing){o.item.image_300_url="/images/default_new_collection.png"}else{if(o.item.type==="collection"){if(o.item.cover_asset.type==="video"&&(o.item.cover_asset.youtube_id!=null)){o.item.image_300_url=c(o.item.cover_asset.youtube_id)}else{o.item.image_300_url=o.item.cover_asset.image_300_url}}}if(o.item.type==="video"&&(o.item.youtube_id!=null)){o.item.image_300_url=c(o.item.youtube_id)}return Mustache.render($("#turntable_record_template").html(),o)};c=function(o){return"http://img.youtube.com/vi/"+o+"/0.jpg"};d=function(o){var p;p=""+o+"_template";return $("#"+p).html()};m=function(p){var o;if(p==="image"||p==="externalvideo"||p==="fact"||p==="collection"){return $("#"+p+"_turntable_template").html()}else{o=""+p+"_template";return $("#"+o).html()}};a=function(r,q,o){var p,t,u;if(o==null){o=350}t=r.get("item").get("youtube_id");p=r.toJSON();p.item=p.item.toJSON();u=$("#youtube_embed_template").html();q.find(".video-wrapper").html(Mustache.render(u,p));q.find(".youtube-player").show();return q.find("embed").attr("height",o)};k={theme:"advanced",skin:"collagio",plugins:"inlinepopups",height:"250",width:"100%",inlinepopups_skin:"collagio",dialog_type:"modal",theme_advanced_buttons1:"bold,italic,bullist,numlist,link"};e=function(){k;k.mode="specific_textareas";k.editor_selector="text-editor";return tinyMCE.init(k)};b=function(o){var p;p=new tinymce.Editor(o,k);p.render();tinyMCE.add(p);return p};global.myd.initTextEditor=e;global.myd.renderTextEditor=b;global.myd.renderAssetFragment=j;global.myd.renderAssetFragmentFromItem=l;global.myd.getVideoUrl=c;global.myd.renderScreen=n;global.myd.renderVideoEmbed=a;global.myd.renderTurntableScreen=h;global.myd.timeDifference=g}).call(this);(function(){var a,b;if((b=global.myd)==null){global.myd={}}a={get:function(c){var d;return d=$.ajax({type:"GET",dataType:"json",contentType:"text/json",data:c.data,url:window.location.href.indexOf("https://")>-1?c.url.replace("http://","https://"):c.url,success:c.success,error:c.error})},post:function(c){var d;return d=$.ajax({type:"POST",dataType:"json",contentType:"text/json",url:window.location.href.indexOf("https://")>-1?c.url.replace("http://","https://"):c.url,data:JSON.stringify(c.data),success:c.success,error:c.error})},"delete":function(c){var d;return d=$.ajax({type:"DELETE",dataType:"json",contentType:"text/json",url:window.location.href.indexOf("https://")>-1?c.url.replace("http://","https://"):c.url,data:JSON.stringify(c.data),success:c.success,error:c.error})}};global.myd.serviceModule=a}).call(this);(function(){var a,b;if((b=global.myd)==null){global.myd={}}a=(function(){var d;d=0;function c(e){var f=this;this.$el=e.el;this.onAfterSlide=e.onAfterSlide;this.slides=this.$el.children("li");this.slideWidth=$(this.slides[0]).outerWidth();this.centerSlide();$(window).bind("resize.turntable",_.throttle($.proxy(this.centerSlide,this),500));setTimeout(function(){return $(window).one("scroll",$.proxy(f.stopTimer,f))},5000);this.startTimer()}c.prototype.slide=function(f,e){if(f==null){f=d+1}if(e==null){e=false}if(f===d){return}if(f>=this.slides.length){f=0}if(e){this.resetTimer()}d=f;this.centerSlide();return this.onAfterSlide(f,e)};c.prototype.centerSlide=function(){return this.$el.css("left",(($(window).width()/2)-(this.slideWidth/2))-(d*this.slideWidth))};c.prototype.startTimer=function(){return this.timer=window.setInterval($.proxy(this.slide,this),5000)};c.prototype.stopTimer=function(){return window.clearTimeout(this.timer)};c.prototype.resetTimer=function(){this.stopTimer();return this.startTimer()};c.prototype.getCurrentSlide=function(){return d};c.prototype.close=function(){return $(window).unbind("resize.turntable")};return c})();global.myd.TurntableModule=a}).call(this);(function(){var a,d,b={}.hasOwnProperty,c=function(h,f){for(var e in f){if(b.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}a=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.type="add_collection";e.prototype.defaults={title:"Give me title"};return e})(Backbone.Model);global.myd.AddCollectionTileModel=a}).call(this);(function(){var b,d,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}b=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.defaults={url:"papyrus",name:"Collagio"};e.prototype.initialize=function(g){this.set("name",this.get("name").replace(" - Collagio",""));return this};return e})(Backbone.Model);global.myd.BreadcrumbModel=b}).call(this);(function(){var b,d,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}b=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.idAttribute="uid";e.prototype.defaults={text:"This is a comment",created_timestamp:new Date(),deleted:false,truncated:false};e.prototype.initialize=function(g){this.set("created_timestamp",new Date(this.get("created_timestamp")*1000));return this};return e})(Backbone.Model);global.myd.CommentModel=b}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.idAttribute="uid";f.prototype.exists=function(){return this.get("type")!=null};f.prototype.toggleLike=function(){var g=this;return myd.serviceModule.post({url:myd.urls.bookmarks,data:{entity_url:this.get("entity_url"),bookmarked:!this.get("collected")},success:function(h){var i;i=g.get("collected_count");if(h.collected){g.set("collected_count",++i)}else{g.set("collected_count",i>0?--i:0)}return g.set("collected",h.collected)}})};return f})(Backbone.Model);global.myd.FrontMatterTileModel=d}).call(this);(function(){var c,d,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}c=(function(f){b(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.idAttribute="uid";e.prototype.defaults={metaData:void 0,type:"image"};e.prototype.initialize=function(g){this.bookmark_url=myd.urls.bookmarks;if((g!=null)&&(g.screen_id!=null)){return this.set("screen_id",g.screen_id)}};e.prototype.toggleLike=function(){var g=this;return myd.serviceModule.post({url:this.bookmark_url,data:{entity_url:this.get("entity_url"),bookmarked:!this.get("collected")},success:function(h){var i;i=g.get("collected_count");if(h.collected){g.set("collected_count",++i)}else{g.set("collected_count",i>0?--i:0)}return g.set("collected",h.collected)}})};e.prototype.fetchMetaData=function(){var g=this;return myd.serviceModule.get({url:this.get("meta_data_url"),success:function(h){return g.set("metaData",h)}})};return e})(Backbone.Model);global.myd.ItemModel=c}).call(this);(function(){var a,d,b={}.hasOwnProperty,c=function(h,f){for(var e in f){if(b.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}a=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.defaults={type:"comment",source_user_name:"Eric Novins",text:"This is a comment",created_timestamp:new Date(),read:false};e.prototype.initialize=function(g){return this};return e})(Backbone.Model);global.myd.NotificationModel=a}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.idAttribute="uid";f.prototype.defaults={editable:false,showActions:false,showLikeButton:false,showReuseButton:false,showFacebookShareButton:false,showScreenNavigation:false,showDeleteButton:false};f.prototype.initialize=function(g){this.bookmark_url=myd.urls.bookmarks;return this.set("item",new myd.ItemModel(this.get("item")))};f.prototype.setCoverImage=function(){var g=this;myd.serviceModule.post({url:this.collection.coverUrl,data:{cover_asset_url:this.get("item").get("entity_url")},success:function(h){}});return this.isCoverImageCandidate=false};return f})(Backbone.Model);global.myd.ScreenModel=d}).call(this);(function(){var c,d,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}c=(function(f){b(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.defaults={type:"user",entity_url:"",first_name:"Ondand",last_name:"Only ",user_url:"http://local.collagio.com:9292/api/users/22eab720-7dbf-012f-3269-12313930b4ef",image_url:"",topics_url:"http://local.collagio.com:9292/api/users/22eab720-7dbf-012f-3269-12313930b4ef/assets/collected_topics",bookmarks_url:"http://local.collagio.com:9292/api/users/22eab720-7dbf-012f-3269-12313930b4ef/assets/likes",items_url:"http://local.collagio.com:9292/api/users/22eab720-7dbf-012f-3269-12313930b4ef/owned_items",collections_url:"http://local.collagio.com:9292/api/users/22eab720-7dbf-012f-3269-12313930b4ef/my_profile",my_stats_url:"http://local.collagio.com:9292/api/users/22eab720-7dbf-012f-3269-12313930b4ef/my_stats"};e.prototype.initialize=function(){return this};return e})(Backbone.Model);global.myd.UserModel=c}).call(this);(function(){var c,d,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}c=(function(f){b(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.model=myd.ScreenModel;e.prototype.events={"click .add-bar a":"clickedAddBarButton","click .add-fact":"clickAddText","click .add-photo":"clickAddPhoto","click .add-video":"clickAddVideo","click .add-collage":"clickAddCollage","click .add-rss":"clickAddFeed"};e.prototype.bindToModel={"change:index":"updateIndex"};e.prototype.showFrontMatter=true;e.prototype.prevScreenId=null;e.prototype.initialize=function(g){this.index=g.index;return this.firstTime=g.first_time};e.prototype.reset=function(){return this.render()};e.prototype.render=function(){this.$el.html(Mustache.render($("#add_bar_view_template").html(),{first_time:this.firstTime}));if(this.firstTime){this.$el.find(".add-bar").addClass("add-bar-show")}return this.$el};e.prototype.updateIndex=function(){return this.index=this.model.get("index")};e.prototype.clickAddText=function(g){var h,i=this;h=$(g.target).parents(".add-bar");this.newFactAsset=new myd.AddFactView({container:h,index:this.index});this.bind("finishEdit",function(){return i.newFactAsset.trigger("finishEdit")});this.bind("cancelEdit",function(){return i.newFactAsset.trigger("cancelEdit")});return this.newFactAsset.bind("addItem",this.callAddNewItem,this)};e.prototype.clickAddPhoto=function(g){return this.addPhotoVideo(g,"image")};e.prototype.callAddItemToCollection=function(g){this.trigger("addItem",{view:this,item:g});return false};e.prototype.callAddNewItem=function(g){this.trigger("addNewItem",{view:this,item:g});return false};e.prototype.clickAddVideo=function(g){return this.addPhotoVideo(g,"video")};e.prototype.addPhotoVideo=function(g,i){var h;h=$(g.target).parents(".add-bar");this.newPhotoVideoView=new myd.AddPhotoVideoView({container:h,addType:i,addItemUrl:this.model.get("add_new_item_url"),index:this.index});this.newPhotoVideoView.bind("addItem",this.callAddItemToCollection,this);return this.newPhotoVideoView.bind("addNewItem",this.callAddNewItem,this)};e.prototype.clickAddCollage=function(g){return this.addPhotoVideo(g,"collage")};e.prototype.clickAddFeed=function(g){var h;h=$(g.target).parents(".add-bar");this.newFeedAsset=new myd.AddFeedView({container:h,index:this.index});return this.newFeedAsset.bind("addItem",this.callAddNewItem,this)};e.prototype.clickedAddBarButton=function(){$("body, html").animate({scrollTop:this.$el.find(".add-bar").offset().top-80},750,"easeOutBack");this.$el.find(".add-bar").removeClass("add-bar-show");this.$el.find(".first-edit-callout").remove();return false};e.prototype.onClose=function(){if(this.newFactAsset!=null){this.newFactAsset.unbind("addItem");this.newFactAsset.close()}if(this.newPhotoVideoView!=null){this.newPhotoVideoView.unbind("addItem");this.newPhotoVideoView.close()}if(this.newFeedAsset!=null){this.newFeedAsset.unbind("addItem");this.newFeedAsset.close()}return this.unbind("finishEdit")};return e})(Backbone.View);global.myd.AddBarView=c}).call(this);(function(){var b,a,e,c={}.hasOwnProperty,d=function(i,g){for(var f in g){if(c.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i};if((e=global.myd)==null){global.myd={}}a=myd.routesModule;b=(function(g){d(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.tagName="div";f.prototype.className="add-collection";f.prototype.events={"click #my-profile .add_btn":"clickedAddCollection","click .cancel_btn":"clickedCancel","click .fs_overlay":"clickedCancel","click .create_btn":"submit","submit #create-collection":"submit","keyup select":"keyup","click .selected-topic":"clickedDropdown","click .options li":"clickedDropdownItem"};f.prototype.initialize=function(h){this.inputModule=global.myd.inputModule;this.template=$("#add_collection_template").html();this.getForm=h.getForm;this.getFormWrapper=h.getFormWrapper;this.overlay=h.overlay;this.serviceModule=h.serviceModule;this.createCollectionUrl=h.createCollectionUrl;return this.selectedTopic=null};f.prototype.hideAddCollection=function(){return this.overlay.close()};f.prototype.displayError=function(j){var h,i;this.resetErrorMessages();h=j.title;i=j.topic;if(h){this.showTitleErrorMessage(h)}if(i){this.showTopicErrorMessage(i)}return $("input[name=title]")};f.prototype.showTitleErrorMessage=function(h){var j,i;j=this.getTitleErrorMessageElement();i=this.getTitleTextElement();j.text(h);j.show();return i.addClass("field_validation_error animated pulse")};f.prototype.showTopicErrorMessage=function(i){var j,h;h=this.getTopicErrorMessageElement();j=this.getTopicDropdownElement();h.text(i);h.show();return j.addClass("field_validation_error animated pulse")};f.prototype.resetErrorMessages=function(){var k,j,i,h;i=this.getTopicDropdownElement();j=this.getTitleTextElement();k=this.getTitleErrorMessageElement();h=this.getTopicErrorMessageElement();k.text();k.hide();h.text();h.hide();i.removeClass("field_validation_error");return j.removeClass("field_validation_error")};f.prototype.getTitleErrorMessageElement=function(){return this.getForm().find("#title_error_message")};f.prototype.getTitleTextElement=function(){return this.getForm().find("input[name=title]")};f.prototype.getTopicDropdownElement=function(){return this.getForm().find("select[name=topic_entity_url]")};f.prototype.getTopicErrorMessageElement=function(){return this.getForm().find("#topic_error_message")};f.prototype.clickedAddCollection=function(){this.getForm().addClass("activated");return this.getFormWrapper().addClass("activated")};f.prototype.visitFormElements=function(h){return this.getForm().find(".field").each(function(){return h(this)})};f.prototype.clickedCancel=function(){return this.hideAddCollection()};f.prototype.keyup=function(h){if(this.inputModule.returnPress(h)){return this.submit(h)}};f.prototype.submit=function(h){return this.clickCreate()};f.prototype.clickCreate=function(){var h,i=this;h={};this.visitFormElements(function(j){h[j.name]=$(j).val();return h.topic_entity_url=i.selectedTopic});return this.createCollection(h)};f.prototype.createCollection=function(h){var i=this;if(!this.getTitleTextElement().val()){return this.showTitleErrorMessage("Please enter a title.")}if(!this.selectedTopic){return this.showTopicErrorMessage("Please choose a topic.")}$(".create_btn").hide();return myd.serviceModule.post({url:myd.urls.create_collection,data:h,success:function(j){var k;i.getFormWrapper().remove();i.overlay.close();k=j.url.substring(j.url.lastIndexOf("/")+1);omnicollagio.eVar24=i.selectedTopic+": "+k;if(omnicollagio.events.length){omnicollagio.events+=",event15"}else{omnicollagio.events="event15"}return Router.navigateToEditCollection("/c/api/collections/"+k,{trigger:true})},error:function(j){var k;k=JSON.parse(j.responseText);return i.displayError(k)},dataType:"json"})};f.prototype.clickedDropdown=function(){this.$el.find(".dropdown-container").toggleClass("open");return this.$el.find(".options").toggle("blind",150)};f.prototype.clickedDropdownItem=function(h){var i;i=$(h.target);this.selectedTopic=i.data("entity");this.$el.find(".selected-topic").text(i.text());return this.clickedDropdown()};f.prototype.render=function(){var h;h=Mustache.render(this.template,this.model.toJSON());this.$el.html(h);return this};return f})(Backbone.View);global.myd.AddCollectionTileView=b}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.tagName="div";f.prototype.className="screen-item add-asset fact-type cf";f.prototype.collection=myd.ItemsCollection;f.prototype.events={"click .close-add-item":"clickedClose","click .add-btn":"addItem"};f.prototype.initialize=function(g){var h=this;this.containerTarget=g.container;this.index=g.index;this.bind("finishEdit",function(){return h.clickedClose()});this.bind("cancelEdit",function(){return h.clickedClose()});return this.render()};f.prototype.render=function(){var g=this;this.template=$("#add_fact_item_template").html();this.$el.append(Mustache.render(this.template,{index:this.index}));this.$el.insertAfter(this.containerTarget);this.editBar=$(".edit");myd.Placeholder().refresh(this.$el);return this.$el.show("blind",1000,function(){var h;return h=myd.renderTextEditor("new-text-"+g.index)})};f.prototype.addItem=function(){var i,g,h,k,j;myd.Placeholder().clean(this.$el);j=this.$el.find(".fact_title").text();g=tinyMCE.get("new-text-"+this.index);i=$("<div>").html(g.getContent())[0];k=markdown.serialize(i);if(!j.length&&!k.length){this.clickedClose();return}h=new myd.ItemModel({asset_type:"fact",title:j,text:k,index:this.index,type:"fact"});this.trigger("addItem",h);return this.clickedClose()};f.prototype.clickedClose=function(){var g=this;this.$el.hide("blind",1000,function(){return g.close()});return false};f.prototype.onClose=function(){var g;return(g=tinyMCE.get("new-text-"+this.index))!=null?g.remove():void 0};return f})(Backbone.View);global.myd.AddFactView=d}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.tagName="div";f.prototype.className="screen-item add-asset feed-type cf";f.prototype.collection=myd.ItemsCollection;f.prototype.events={"click .close-add-item":"clickedClosed","click .add-button":"clickedAdd"};f.prototype.initialize=function(g){this.containerTarget=g.container;this.index=g.index;this.collection=new myd.ItemsCollection;this.collection.bind("reset",this.render,this);return this.collection.fetch("FeedAsset")};f.prototype.render=function(){var g,h=this;this.template=$("#add_feed_item_template").html();this.$el.append(Mustache.render(this.template));this.$el.insertAfter(this.containerTarget);g=this.$el.find("ul.liked-items");this.itemViews=[];_.each(this.collection.models,function(j){var i;i=new myd.AddItemView({model:j});g.append(i.el);i.bind("addItem",h.addItem,h);return h.itemViews.push(i)});return this.$el.show("blind",1000)};f.prototype.addItem=function(h){var g;if(!h){g=this.$el.find(".feed_url").val();if(g.length<1){return}h=new myd.ItemModel({asset_type:"feed",title:"",feed_url:g,type:"feed",index:this.index})}else{h.set("asset_type","feed");h.set("index",this.index)}this.trigger("addItem",h);return this.clickedClosed()};f.prototype.clickedAdd=function(){this.addItem();return false};f.prototype.clickedClosed=function(){var g=this;this.$el.hide("blind",1000,function(){return g.close()});return false};f.prototype.onClose=function(){};return f})(Backbone.View);global.myd.AddFeedView=d}).call(this);(function(){var b,d,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}b=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.tagName="li";e.prototype.className="item";e.prototype.model=myd.ItemModel;e.prototype.events={"click a":"clickedItem"};e.prototype.initialize=function(g){this.addType=g.addType;return this.render()};e.prototype.render=function(){var n,g,j,i,h,m,k,l;k="/images/placeholder-logo.jpg";l=this.model.get("image_300_url")||k;m=this.model.get("preview_image_url")||k;g=this.model.get("image_150_url")||k;i=this.model.get("image_300_url")||k;h=this.model.get("image_745_url")||k;n=this.model.get("image_1024_url")||k;j=this.model.get("image_2048_url")||k;if(this.model.get("type").toLowerCase()==="collection"){if(this.addType==="cover"){l=this.model.get("cover_asset").image_745_url||k;this.$el.append("<a href='#' title='Click to add "+(this.model.get("type"))+"' style='background-image: url("+l+")' /></a>")}else{this.$el.html(myd.renderScreen(this.model.toJSON(),"addcollage"));myd.renderAssetFragmentFromItem(this.model,null,"addcollage",this.$el)}}else{if(this.model.get("type")==="video"||this.model.get("type")==="VideoAsset"){this.$el.append("<a href='#' class='video-thumb' title='Click to add "+(this.model.get("type"))+"' style='background-image: url(/images/play.png), url("+l+")' /></a>")}else{if(this.model.get("type")==="FeedAsset"){this.$el.append("<a href='#' title='Click to add "+(this.model.get("type"))+"' ><span class='icon rss'><img src='/images/icon-rss-large.png'  alt='rss icon'/></span>"+(this.model.get("title"))+"</a>")}else{this.$el.append("<a href='#' title='Click to add "+(this.model.get("type"))+"' style='background-image: url("+l+")' /></a>")}}}this.$el.addClass("no-hover");return this.$el.find(".asset .image").attr("src",h)};e.prototype.clickedItem=function(){if(this.addType==="cover"&&this.model.get("type")==="collection"){this.trigger("addItem",new Backbone.Model(this.model.get("cover_asset")))}else{this.trigger("addItem",this.model)}return false};return e})(Backbone.View);global.myd.AddItemView=b}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.tagName="div";f.prototype.className="screen-item add-asset media-type cf";f.prototype.collection=myd.ItemsCollection;f.prototype.events={"click .upload-image":"clickedUploadImage","click .search-images":"clickedSearch","click .close-add-item":"clickedClosed","click .liked-images":"clickedLiked","click .liked-videos":"clickedLikedVideos","keyup .search-photo-bar input":"liveSearch"};f.prototype.initialize=function(g){global.myd.AddPhotoVideoView.instance=this;this.containerTarget=g.container;this.addType=g.addType;this.collectionItems=g.collectionItems||[];this.addItemUrl=g.addItemUrl;this.index=g.index;this.liveSearch=_.debounce(_.bind(this.doSearch,this),300);this.collection=new myd.ItemsCollection;this.collection.bind("reset",this.render,this);if(this.addType==="image"){this.assetType="ImageAsset"}else{if(this.addType==="video"){this.$el.addClass("video-type");this.assetType="VideoAsset"}else{if(this.addType==="collage"){this.$el.addClass("collage-type");this.assetType="Collection"}else{if(this.addType==="cover"){this.$el.addClass("cover-type")}}}}this.$el.addClass(""+this.addType+"-type");if(this.addType!=="cover"){return this.collection.fetch(this.assetType)}else{return this.collection.reset(this.collectionItems)}};f.prototype.render=function(){var g,i,h,k,j,l=this;g=true;k=false;j=false;if(this.addType==="image"){k=true;i="Select an image to add ..."}else{if(this.addType==="video"){i="Select a video to add ...";j=true}else{if(this.addType==="collage"){i="Select a collage to add ..."}else{if(this.addType==="cover"){i="Select a new background image ..."}}}}h=this.$el.find(".liked-items");if(h.length===0){this.$el.append(Mustache.render($("#add_media_item_template").html(),{headline:i,showPhotoBar:k,showVideoBar:j}));this.$el.insertAfter(this.containerTarget);this.likedImagesBtn=this.$el.find(".liked-images");this.searchImagesBtn=this.$el.find(".search-images");this.searchBar=this.$el.find(".search-photo-bar")}h=this.$el.find(".liked-items");if(h.children().length){g=false;h.empty()}this.itemViews=[];if(this.collection.models.length===0){this.$el.find(".no-likes").remove();if(this.$el.find(".search-images").hasClass("active")){this.$el.find(".asset-wrapper").append("<div class='no-likes'>Type in the search box above to find images.</div>")}else{if(this.addType==="cover"){this.$el.find(".asset-wrapper").append("<div class='no-likes'>You must add an image or video to your collage first...</div>")}else{this.$el.find(".asset-wrapper").append("<div class='no-likes'>You must first like a few "+this.addType+"s...</div>")}}this.$el.find(".liked-items").hide()}else{this.$el.find(".no-likes").remove();this.$el.find(".liked-items").show();_.each(this.collection.models,function(n){var m;if((n.get("image_300_url")!=null)||n.get("type")==="collection"){m=new myd.AddItemView({model:n,addType:l.addType});h.append(m.el);m.bind("addItem",l.addItem,l);return l.itemViews.push(m)}})}if(g){this.$el.show("blind",1000)}return h.animate({scrollTop:0},250,"easeOutBack")};f.prototype.addItemFromFlash=function(g){g.index=this.index;this.trigger("addNewItem",new myd.ItemModel(g));return this.clickedClosed()};f.prototype.addItem=function(g){if(this.addType!=="cover"){g.set("index",this.index);this.trigger("addItem",g)}else{this.trigger("setCover",g)}return this.clickedClosed()};f.prototype.clickedSearch=function(){var g;if(this.searchBar.width()===0){this.$el.find(".liked-items-bar .active").removeClass("active");this.searchImagesBtn.addClass("active");this.$el.find(".liked-items").show();this.$el.find(".no-likes").remove();g=$.cookie("add_image_search");if(g){this.$el.find(".search-photo-bar input").focus().val($.cookie("add_image_search"));this.doSearch()}else{this.$el.find(".search-photo-bar input").focus()}}else{$(".liked-items-bar .active").removeClass("active");this.likedImagesBtn.addClass("active")}this.searchBar.animate({width:this.searchBar.width()===0?275:0},500);return false};f.prototype.openFirstTimeSearch=function(){if(this.searchBar.width()===0){this.$el.find(".liked-items-bar").addClass("active");this.searchImagesBtn.removeClass("active")}this.searchBar.animate({width:this.searchBar.width()===0?275:void 0},500);return false};f.prototype.clickedUploadImage=function(){var i,j,g,h;j=$("#flash_uploader_template").html();this.$el.find(".flash-uploader").css({display:"block",position:"absolute",top:35,left:10,width:"810px",height:"630px"});g={url:"/upload/",paramName:"file",key:h=""+myd.s3.prefix,bucket:myd.s3.bucket,acl:myd.s3.acl,AWSAccessKeyId:encodeURIComponent(myd.s3.AWSAccessKeyId),policy:encodeURIComponent(myd.s3.policy),signature:encodeURIComponent(myd.s3.signature),postURL:this.addItemUrl,screenIndex:this.index};i=Mustache.render(j,g);this.$el.find(".flash-uploader").html(i);return false};f.prototype.doSearch=function(){this.searchImagesBtn.addClass("active");this.likedImagesBtn.removeClass("active");$.cookie("add_image_search",this.searchBar.find("input").val());_gaq.push(["_trackEvent","AddBar","Search",this.searchBar.find("input").val(),1]);omnicollagio.linkTrackEvents="event21, prop21, eVar8";omnicollagio.eVar8="CollageAddImageSearchView";omnicollagio.prop21=this.searchBar.find("input").val();omnicollagio.t(this,"o",window.location);return this.collection.fetchSearchResults(this.searchBar.find("input").val())};f.prototype.clickedLiked=function(){this.collection.fetch(this.assetType);$(".liked-items-bar .active").removeClass("active");this.likedImagesBtn.addClass("active");this.searchBar.animate({width:0},500);this.searchBar.find("input").val("");return false};f.prototype.clickedLikedVideos=function(){return false};f.prototype.clickedClosed=function(){var g=this;this.$el.slideUp(1000,function(){return g.close()});this.trigger("cancel");return false};f.prototype.onClose=function(){var g=this;return _.each(this.itemViews,function(h){h.unbind("addItem",g.addItem,g);return h.close()})};return f})(Backbone.View);global.myd.AddPhotoVideoView=d}).call(this);(function(){var k,j,b,a,g,f,d,c,i={}.hasOwnProperty,e=function(o,m){for(var l in m){if(i.call(m,l)){o[l]=m[l]}}function n(){this.constructor=o}n.prototype=m.prototype;o.prototype=new n();o.__super__=m.prototype;return o},h=[].slice;if((g=global.myd)==null){global.myd={}}if((f=(j=global.myd).urls)==null){j.urls={}}if((d=(b=global.myd.urls).current_user)==null){b.current_user={}}if((c=(a=global.myd).topics)==null){a.topics={}}k=(function(l){e(m,l);function m(){return m.__super__.constructor.apply(this,arguments)}m.prototype.el="body";m.prototype.prevScreenId=null;m.prototype.currentView=null;m.prototype.initialize=function(t){var o,q,p,r,n;window.Router=new myd.PapyrusRouter({app_view:this});this.feedbackView=new global.myd.FeedbackView();this.headerView=new global.myd.HeaderView(this);this.notificationsView=new global.myd.NotificationsListView({container:this.headerView.$el.find(".login")});q=new global.myd.Uri(window.location).get("utm_campaign");if(q){_gaq.push(["_setCustomVar",1,"Member Type",q.value,1])}o=document.cookie.split(";");for(r=0,n=o.length;r<n;r++){p=o[r];if(p.indexOf("publish")>-1){global.myd.feature.publish=true}}this.setFeatureFlags();omnicollagio.pageName="home";return this};m.prototype.setFeatureFlags=function(){var n;n=_.map(_.keys(global.myd.feature),function(o){return"ff-"+o});return $("html").addClass(n.join(" "))};m.prototype.showCollection=function(p,o){var n;n=new myd.CollageView({collection:new myd.GridCollection,streamView:true});return this.showView(n,p,o)};m.prototype.showAssetInFullScreen=function(n){if(this.currentView!=null){return this.currentView.showFullScreen(n)}};m.prototype.closeCurrentView=function(){$(".menu a.selected").removeClass("selected");this.currentView.unbind("rendered",this.rendered,this);this.currentView.close();return this.currentView=null};m.prototype.showView=function(){var p,n,o;n=arguments[0],p=2<=arguments.length?h.call(arguments,1):[];if((p!=null?p.tab:void 0)==="likes"&&document.location.hash.indexOf("first")!==-1){$("#first_time_user_callout").remove()}if(this.currentView!=null){this.closeCurrentView()}if(this.notificationsView!=null){this.notificationsView.toggleList({close:true});this.notificationsView.refresh()}this.currentView=n;this.currentView.bind("rendered",this.rendered,this);return(o=this.currentView).display.apply(o,p)};m.prototype.rendered=function(q){var n,r,p,o;r=false;new mediaQuery({media:"screen and (max-width: 639px)",entry:function(){return r=true},exit:function(){}});if((this.wayBackCollection!=null)&&(q!=null)){if(q.clearHistory){this.wayBackCollection.reset()}o=Backbone.history.getFragment();if((q!=null)&&(q.thumbnail!=null)){this.wayBackCollection.add(new myd.BreadcrumbModel({url:o,name:document.title,thumbnail:q.thumbnail}),{at:0})}else{this.wayBackCollection.add(new myd.BreadcrumbModel({url:o,name:document.title}),{at:0})}}if((q!=null?q.tab:void 0)==="likes"&&!r&&document.location.hash.indexOf("first")!==-1){n=$("body");n.addClass("cf");n.addClass("onboardComplete");p=Mustache.render($("#first_time_user_callout").html());$(".name-header").append(p);this.$el.bind("click",function(){return $(this).removeClass("onboardComplete")})}omnicollagio.eVar16=myd.urls.current_user;omnicollagio.eVar23="D=v16";omnicollagio.t(this,"o",window.location);return omnicollagio.events=""};m.prototype.showLatest=function(){var n;n=new myd.ExploreLatestView({collection:_.extend(new myd.LatestGridCollection,{url:myd.urls.new_stream}),filter:"latest",streamView:true,appView:this});this.showView(n);return this.trigger("changedSection",{section:"latest"})};m.prototype.showPopular=function(){var n;n=new myd.ExplorePopularView({collection:_.extend(new myd.PopularGridCollection,{url:myd.urls.popular}),filter:"popular",streamView:true,appView:this});this.showView(n);return this.trigger("changedSection",{section:"popular"})};m.prototype.showTopic=function(o){var n;if(o==null){o={uid:0,filter:"latest"}}n=new myd.ExploreTopicView({collection:_.extend(new myd.TopicGridCollection,{url:"/api/collections/"+o.uid}),filter:o.filter,uid:o.uid,streamView:true,appView:this});return this.showView(n)};m.prototype.showProfile=function(o){var n;n=new myd.ProfileView({collection:new myd.ProfileGridCollection,tab:o.tab});return this.showView(n,{tab:o.tab,userPath:o.userPath})};m.prototype.showSearch=function(o){var n;n=new myd.SearchView({collection:new myd.GridCollection,searchTerm:o});return this.showView(n)};m.prototype.showBookmarklet=function(){return this.showView(new myd.BookmarkletView)};return m})(Backbone.View);global.myd.AppView=k}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.model=myd.ScreenModel;f.prototype.events={"click .submit_edit_text":"clickedSubmitEditText","click .cancel_edit_text":"clickedCancelText"};f.prototype.initialize=function(g){this.containerEl=g.container;return this.render()};f.prototype.render=function(){var g;g=Mustache.render($("#asset_edit_view_template").html(),this.model.toJSON());this.containerEl.append(g);this.setElement($(".edit_controls",this.containerEl));this.containerEl.find(".caption").hide();this.containerEl.find(".editable_btn").hide();if(this.model.get("item").get("type")==="fact"&&this.model.get("item").get("owned")){this.$el.find(".fact-editor").show()}if(this.model.get("item").get("title").length){this.$el.find(".screen_header_input").val(this.model.get("item").get("title"))}this.containerEl.parentsUntil(".fullscreen-overlay").parent()[0].scrollTop=2000;if(this.model.get("item").get("type")==="fact"){this.factEditor=new myd.wysiwygEditor({el:this.$el.find(".screen_text_input")});return this.factEditor.markdown(this.model.get("item").get("text"))}};f.prototype.clickedSubmitEditText=function(){var g;if((this.factEditor!=null)&&this.model.get("item").get("type")==="fact"&&this.factEditor.markdown().length===0){return false}this.$el.find(".saving_text").show();this.$el.find(".submit_edit_text, .cancel_edit_text").hide();g=this.model.toJSON();g.caption=this.$el.find("#asset-caption").val().trim();g.title=this.$el.find(".screen_header_input").val();if(this.factEditor!=null){g.text=this.factEditor.markdown()}if(this.model.get("item").get("type")==="fact"){if(g.caption===this.model.get("caption")&&g.title===this.model.get("item").get("title")&&g.text===this.model.get("item").get("text")){this.clickedCancelText();return false}}else{if(g.caption===this.model.get("caption")){this.clickedCancelText();return false}}this.trigger("assetEdited",g);return false};f.prototype.clickedCancelText=function(){if(this.factEditor!=null){this.factEditor.close()}this.containerEl.parentsUntil(".fullscreen-overlay").parent()[0].scrollTop=0;this.containerEl.find(".caption").show();this.containerEl.find(".editable_btn").show();this.trigger("closeMe");this.close();return false};return f})(Backbone.View);global.myd.AssetEditView=d}).call(this);(function(){var b,d,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}b=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.model=myd.ScreenModel;e.prototype.events={"click .origin_source_url":"clickedViewSource","click .parent_collection_url":"clickedViewParentCollection","click .asset_owner_url":"clickedViewAssetOwner"};e.prototype.initialize=function(h){var g;this.containerEl=h.container;g=this.model.get("metaData");if(!!g){if(g.uploaded){g.source_url_name="Uploaded by User"}else{if(g.source_url===null&&g.asset_url===null){g.source_url_name="Added by User"}else{if(g.source_url===null){g.source_url=g.asset_url}}}g.owner_link="/papyrus/p"+new global.myd.Uri(g.owner.user_url).getPathname()+"/collections";return this.render(g)}};e.prototype.render=function(h){var g;this.containerEl.append("<div class='meta_data_holder' style='display: none;'>");this.setElement($(".meta_data_holder",this.containerEl));this.containerEl.toggleClass("showing_meta_data",!!h);g=$("#asset_meta_data_template").html();this.$el.html(Mustache.render(g,h));return this.$el.slideDown()};e.prototype.toggle=function(){this.containerEl.toggleClass("showing_meta_data");if(this.containerEl.hasClass("showing_meta_data")){this.$el.slideDown();return true}else{this.$el.slideUp();return false}};e.prototype.clickedViewSource=function(){var g;g=this.model.get("metaData").source_url;if(g.indexOf("http://")===0){this.sourceWindow=window.open(this.model.get("metaData").source_url)}return false};e.prototype.clickedViewParentCollection=function(h){var i,g;g=$(h.target).attr("href");i=global.myd.routesModule.getRoutesFromUrl(g);Router.navigate(i.getPapyrusPath(),{trigger:true});return false};e.prototype.clickedViewAssetOwner=function(){var g;g=this.model.get("metaData").owner.user_url;Router.navigateToProfileTab({userPath:new global.myd.Uri(g).getPathname(),tab:"collections"});return false};e.prototype.onClose=function(){return this.containerEl.removeClass("showing_meta_data")};return e})(Backbone.View);global.myd.AssetMetaDataView=b}).call(this);(function(){var a,d,b={}.hasOwnProperty,c=function(h,f){for(var e in f){if(b.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}a=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.model=myd.ScreenModel;e.prototype.events={"click .rssRow a":"clickedRSSReadMore"};e.prototype.initialize=function(i){var h,g;h={limit:3,header:false,snippet:false,content:false,linktarget:"_blank"};this.containerEl=i.container;this.removeEvents=(g=i.removeEvents)!=null?g:false;if(i.limit!=null){h.limit=i.limit}if(i.showContent!=null){h.content=i.showContent}return this.render(h)};e.prototype.render=function(g){var h=this;this.setElement(this.containerEl.find(".content"));if(!global.myd.feature.testing){return this.$el.rssfeed(this.model.get("feed_url"),g,function(){return h.enhanceRssContents()})}};e.prototype.enhanceRssContents=function(){return this.$el.addClass("content-loaded")};e.prototype.clickedRSSReadMore=function(g){if(!this.removeEvents){$(g.target).attr("target","_blank").attr("href");return g.stopPropagation()}};return e})(Backbone.View);global.myd.AssetRSSView=a}).call(this);(function(){var c,a={}.hasOwnProperty,b=function(g,e){for(var d in e){if(a.call(e,d)){g[d]=e[d]}}function f(){this.constructor=g}f.prototype=e.prototype;g.prototype=new f();g.__super__=e.prototype;return g};if((c=global.myd)==null){global.myd={}}global.myd.BookmarkletView=(function(d){b(e,d);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.tagName="div";e.prototype.id="bookmarklet";e.prototype.initialize=function(){$("#content").append(this.$el);this.template=$("#bookmarklet_view").html();return this.render()};e.prototype.display=function(){};e.prototype.render=function(){if(this.template!=null){this.$el.empty().append(Mustache.render(this.template,null))}return this};return e})(Backbone.View)}).call(this);(function(){var a,e,d,f,b={}.hasOwnProperty,c=function(j,h){for(var g in h){if(b.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};if((f=global.myd)==null){global.myd={}}e=global.myd.renderAsset;d=myd.serviceModule;a=(function(h){c(g,h);function g(){return g.__super__.constructor.apply(this,arguments)}g.prototype.tagName="li";g.prototype.model=myd.BreadcrumbModel;g.prototype.events={"click a":"goBack"};g.prototype.initialize=function(i){this.containerEl=i.container;return this.render()};g.prototype.render=function(){var i;i=Mustache.render($("#breadcrumb_template").html(),this.model.toJSON());this.containerEl.append(i);return this.setElement($("li:last-child",this.containerEl))};g.prototype.goBack=function(){this.trigger("goBack",this.model);return false};return g})(Backbone.View);global.myd.BreadcrumbView=a}).call(this);(function(){var d,a,e,b={}.hasOwnProperty,c=function(i,g){for(var f in g){if(b.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i};if((e=global.myd)==null){global.myd={}}a=myd.routesModule;d=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.tagName="div";f.prototype.className="front-matter";f.prototype.model=myd.FrontMatterTileModel;f.prototype.events={"click .author-url":"clickedUserLink","click .topic":"clickedTopic","click #edit-background":"clickedEditBackground","click .collection-reuse":"clickedReuse"};f.prototype.clickedTopicsButton=function(){return Router.navigateToTopicsTab()};f.prototype.initialize=function(h){this.containerEl=h.container;this.collection=h.collection;this.isEditing=h.isEditing;this.currentUserModel=h.currentUserModel;this.model.bind("change:collected",this.refreshLike,this);this.model.bind("change:screens_count",this.refreshElementsCount,this);this.model.bind("change:cover_asset",this.refreshCover,this);this.model.bind("change:view_count",this.refreshViewCount,this);this.render();return this};f.prototype.render=function(){var i,h,o,m,n,j,l,k;if(this.options.type==="mystream"){return}m=$("#front_matter_template_"+this.options.type).html();if(!m){return}n=this.model.toJSON();j=(n.total_comment_count!=null)>0?n.total_comment_count:"0";n.total_comment_count=j>999?j+"k":j;n.comment_label=j!==1?"Comments":"Comment";k=(n.view_count!=null)>0?n.view_count:"0";n.view_count=k>999?k+"k":k;n.view_label=k!==1?"Views":"View";h=new Date();i=new Date();l=new Date();i.setTime(n.created_timestamp*1000);l.setTime(n.modified_timestamp*1000);n.createdAgo=global.myd.timeDifference(h,i);n.updatedAgo=global.myd.timeDifference(h,l);switch(this.options.type){case"search":n=myd.pluralizeIfNeeded(n,"result_quantity","Element");break;case"collection":n=myd.pluralizeIfNeeded(n,"screens_count","Item");break;case"explorelatestm"||"new_stream":n=myd.pluralizeIfNeeded(n,"screen_count","Collection");break;case"profile":n.currentUser=this.currentUserModel.toJSON();n.currentUser=myd.pluralizeIfNeeded(n.currentUser,"collection_count","Collage");n=myd.pluralizeIfNeeded(n,"screens_count","Collage")}n=myd.pluralizeIfNeeded(n,"collected_count","Time");if((n.cover_asset!=null)&&n.cover_asset.type==="video"&&(n.cover_asset.youtube_id!=null)){n.cover_asset.asset_url="http://img.youtube.com/vi/"+n.cover_asset.youtube_id+"/0.jpg"}if(n.cover_asset===null){n.cover_asset={};n.cover_asset.asset_url="/images/default_new_collection.png"}if(myd.feature.testing&&(n.cover_asset!=null)){n.cover_asset.asset_url="/images/default_new_collection.png"}o=Mustache.render(m,n);this.containerEl.prepend(o);this.setElement($("#collage-header .header-content"));this.likeButtonView=new myd.LikeButtonView({model:this.collection.frontMatter,el:this.$el.find(".like-container")});this.itemCount=this.$el.find(".item-count");this.viewCount=this.$el.find(".collage-header-view-count");this.viewCountLabel=this.$el.find(".collage-header-view-label");if(this.options.type==="collection"){this.blurHeader()}if(this.isEditing){this.startEditMode()}this.refreshFollowingUser();return this};f.prototype.refreshFollowingUser=function(){var k,j,i,h,l;j=$(".follow-user");k=myd.urls.current_user;i=k.substring(k.lastIndexOf("/")+1,k.length);if(window.location.pathname.indexOf(i)>0){return j.hide()}else{if(((h=this.collection.collection)!=null?h.owner.collected:void 0)===true||((l=this.currentUser)!=null?l.get("collected"):void 0)){j.find(".text").html("FOLLOWING USER");return j.addClass("followed-user-btn").removeClass("following-user-btn")}else{j.find(".text").html("FOLLOW USER");return j.removeClass("followed-user-btn").addClass("following-user-btn")}}};f.prototype.refreshElementsCount=function(){return this.itemCount.html(this.model.get("screens_count")+" "+myd.pluralizeIfNeededText(this.model.get("screens_count"),"Element"))};f.prototype.refreshViewCount=function(){var h,i;h=this.model.get("view_count");h=h>999?h+"k":h;this.viewCount.text(h);h=this.model.get("view_count");i=h!==1?"Views":"View";return this.viewCountLabel.text(i)};f.prototype.refreshCover=function(){if(this.model.get("cover_asset").type==="video"&&(this.model.get("cover_asset").youtube_id!=null)){this.model.get("cover_asset").asset_url=myd.getVideoUrl(this.model.get("cover_asset").youtube_id)}$("#collage-header").css("background-image","url("+(this.model.get("cover_asset").asset_url)+")");return this.blurHeader()};f.prototype.blurHeader=function(){var j,i,h,k=this;$("#collage-header").find("canvas").remove();$(".page-header").find("canvas").remove();j=(h=this.model.get("cover_asset"))!=null?h.asset_url:void 0;if(!j){return}i=new Image();i.onload=function(){Pixastic.process(i,"blurfast",{amount:0.4},function(n){var v,t,u,l,p,q,o,r,m;$("#collage-header").prepend(n);k.blurredBackground=$(n);v=k.blurredBackground.height();m=k.blurredBackground.width();t=$("#collage-header").height()+$(".head-wrap").height();u=$(window).width();r=1;if(m/v>=u/t){r=t/v;l=t;p=m*r;q=-1*Math.abs((m-u)/2);o=0}else{r=u/m;p=u;l=v*r;q=0;o=-1*Math.abs((v-t)/2)}k.blurredBackground.css({display:"block",position:"fixed",width:p,height:l,top:o,left:q});k.resizeBackground();return $(window).bind("resize",_.throttle($.proxy(k.resizeBackground,k),20))});return Pixastic.process(i,"blurfast",{amount:0.4},function(n){var v,t,u,l,p,q,o,r,m;$(".page-header .canvas-wrap").prepend(n);k.blurredBackgroundNavBar=$(n);v=k.blurredBackgroundNavBar.height();m=k.blurredBackgroundNavBar.width();t=$("#collage-header").height()+$(".head-wrap").height();u=$(window).width();r=1;if(m/v>=u/t){r=t/v;l=t;p=m*r;q=-1*Math.abs((m-u)/2);o=0}else{r=u/m;p=u;l=v*r;q=0;o=-1*Math.abs((v-t)/2)}k.blurredBackgroundNavBar.css({display:"block",position:"absolute",width:p,height:l,top:o,left:q});k.resizeBackgroundNav();return $(window).bind("resize",_.throttle($.proxy(k.resizeBackgroundNav,k),20))})};document.body.appendChild(i);return i.src=j};f.prototype.resizeBackground=function(){var p,n,o,h,k,l,j,m,i;p=this.blurredBackground.height();i=this.blurredBackground.width();n=$("#collage-header").height()+$(".head-wrap").height();o=$(window).width();m=1;if(i/p>=o/n){m=n/p;h=n;k=i*m;l=-1*Math.abs((i-o)/2);j=0}else{m=o/i;k=o;h=p*m;l=0;j=-1*Math.abs((p-n)/2)}return this.blurredBackground.css({width:k,height:h,top:j,left:l})};f.prototype.resizeBackgroundNav=function(){var p,n,o,h,k,l,j,m,i;p=this.blurredBackgroundNavBar.height();i=this.blurredBackgroundNavBar.width();n=$("#collage-header").height()+$(".head-wrap").height();o=$(window).width();m=1;if(i/p>=o/n){m=n/p;h=n;k=i*m;l=-1*Math.abs((i-o)/2);j=0}else{m=o/i;k=o;h=p*m;l=0;j=-1*Math.abs((p-n)/2)}return this.blurredBackgroundNavBar.css({width:k,height:h,top:j,left:l})};f.prototype.clickedUserLink=function(){if(this.isEditing){return false}Router.navigateToProfileTab({userPath:new global.myd.Uri(this.model.get("owner").entity_url).getPathname(),tab:"collections"});return false};f.prototype.clickedTopic=function(){var h;if(this.isEditing){return false}h=this.model.get("topic_url").substring(this.model.get("topic_url").lastIndexOf("/")+1);Router.navigate("/topic/"+h,{trigger:true});return false};f.prototype.clickedEditBackground=function(){this.trigger("editBackground");return false};f.prototype.clickedReuse=function(){this.reuseItemView=new myd.ReuseItemView({model:this.collection});return false};f.prototype.startEditMode=function(){this.isEditing=true;this.$el.find("#edit-collection").hide();this.$el.find("#edit-background").show();$(".logo").hide();this.$el.find("h1, .description").attr("contenteditable",true);return myd.Placeholder().refresh(this.$el)};f.prototype.leaveEditMode=function(){this.isEditing=false;this.$el.find("#edit-collection").show();this.$el.find("#edit-background").hide();return $(".logo").show()};f.prototype.onClose=function(){var h,j,i;$(window).unbind("resize.background");if((h=this.blurredBackground)!=null){h.remove()}if((j=this.blurredBackgroundNavBar)!=null){j.remove()}return(i=this.likeButtonView)!=null?i.close():void 0};return f})(Backbone.View);global.myd.CollageHeaderView=d}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.el="#collections";f.prototype.collection=myd.GridCollection;f.prototype.events={"click div > .fb-share":"shareCollection","click #back-to-top":"clickedBackToTop","click .colleciton-reuse":"clickedReuse","click .collection-fb-share":"clickedShare"};f.prototype.bindToCollection={errorReset:"renderError",reset:"reset",add:"addNewScreen",reordered:"reorderedReset",deleteScreen:"deleteScreen",remove:"reindexCollection"};f.prototype.initialize=function(g){var h=this;$("#content").html(Mustache.render($("#full_stacked_view_template").html()));this.setElement($("div#collections"));$("body").bind("keyup",function(i){return h.screenKeyNav(i)});this.frontMatterView=null;this.weAreInEditingMode=false;this.context="collections";this.clearHistory=g.clearHistory||false;this.startInEditMode=false;this.editBar=$(".edit");this.editCollectionButton=$("#edit-collection");this.activeScreenIndex=0;this.screenViews=[];this.tileViewCreator=g.tileViewCreator||function(k){var i,j;j=k.get("entity_url");i=new myd.ScreenView({model:k,context:"collections",inline:true,isEditing:h.weAreInEditingMode});i.bind("selected",h.selectedAsset,h);i.bind("addItem",h.callAddItem,h);i.bind("addNewItem",h.callAddNewItem,h);i.bind("delete",h.deleteScreen,h);i.bind("active",h.activeScreen,h);h.screenViews.push(i);return i};this.collection=g.collection;if(this.context==="collections"){$(window).scroll(_.throttle($.proxy(function(){if($(window).scrollTop()>360){return $("#back-to-top").slideDown()}else{return $("#back-to-top").slideUp()}},this)))}if(document.cookie.indexOf("publish")>0){return global.myd.feature.publish=true}};f.prototype.display=function(h,g){this.showCommentsForScreen=g;return this.collection.fetch(h)};f.prototype.reset=function(){var g=this;this.closeScreens();$("#content").html(Mustache.render($("#full_stacked_view_template").html()));this.setElement($("div#collections"));this.editBar.find(".cancel-edit-btn, .done-edit-btn, .reorder-btn").unbind("click");if(this.$el.find("article").length===0){this.$el.find("ol").empty()}if(this.frontMatterView!==null){this.frontMatterView.unbind("refresh",function(){return g.collection.fetch()});this.frontMatterView.unbind("editBackground",this.launchEditBackground,this);this.frontMatterView.close()}return this.render()};f.prototype.reorderedReset=function(){this.closeScreens();this.renderCollectionTiles();return myd.Placeholder().refresh(this.$el)};f.prototype.render=function(k){var h,i,j,g,m,l=this;$("#page-title").text(this.collection.frontMatter.get("title"));document.title=""+($("#page-title").text())+" - Collagio";omnicollagio.pageName="topic > "+this.collection.frontMatter.get("topic_title")+": collage detail: "+this.collection.frontMatter.get("uid");omnicollagio.eVar15="D=pageName";if((g=omnicollagio.events)!=null?g.length:void 0){omnicollagio.events+=",event8"}else{omnicollagio.events="event8"}omnicollagio.prop7=this.collection.frontMatter.get("topic_title");$(".page-header").addClass("collection");this.editBar.find(".cancel-edit-btn").click(function(){return l.cancelEdit()});this.editBar.find(".done-edit-btn").click(function(){return l.finishEdit()});this.editBar.find(".reorder-btn").click(function(){return l.launchReorder()});this.frontMatterView=new global.myd.CollageHeaderView({container:this.$el,model:this.collection.frontMatter,collection:this.collection,isEditing:this.weAreInEditingMode||false,type:{explorepopular:"popular",profile:"profile","new":"new_stream",collections:"collection"}[this.context]});this.frontMatterView.bind("refresh",function(){return l.collection.fetch()});this.frontMatterView.bind("editBackground",this.launchEditBackground,this);this.renderCollectionTiles();if(this.showCommentsForScreen){h=0;i=0;_.each(this.collection.models,function(n){if(n.get("uid")===l.showCommentsForScreen){i=h;l.activeScreenIndex=i+1;l.screenViews[i].activateScreen();l.screenViews[i].$el.find("aside.comments").addClass("show");return}return ++h});j=$("a[name='screen-"+(i+1)+"']");if(j.length){$("body, html").delay(3000).animate({scrollTop:j.offset().top-80},500,"easeOutCirc")}this.showCommentsForScreen=null}$(window).bind("scroll",_.throttle($.proxy(this.checkScroll,this)));if(this.collection.models.length===0){this.checkScroll()}if(this.collection.frontMatter.get("editable")){myd.initTextEditor()}if((m=this.screenViews[0])!=null){m.fetchComments()}if(this.collection.frontMatter.get("editable")){this.editCollectionButton.show();this.editCollectionButton.click(function(){return l.enterEditingMode()})}else{this.editCollectionButton.hide()}if(this.startInEditMode){this.enterEditingMode()}if(this.collection.frontMatter.get("cover_asset")!=null){this.trigger("rendered",{clearHistory:this.clearHistory,thumbnail:this.collection.frontMatter.get("cover_asset").thumbnail_url})}else{this.trigger("rendered",{clearHistory:this.clearHistory})}return this.incrementViewCount()};f.prototype.incrementViewCount=function(){var g,h=this;g=this.collection.collection.increment_view_count;return myd.serviceModule.post({url:g,data:[],success:function(i){return h.onIncrementViewCountSuccess(i)},error:function(i){}})};f.prototype.onIncrementViewCountSuccess=function(g){return this.frontMatterView.model.set("view_count",g.view_count)};f.prototype.screenKeyNav=function(i){var h,g,l,k,j;if(i.target.tagName.toLowerCase()==="input"||i.target.tagName.toLowerCase()==="textarea"||$(i.target).attr("contenteditable")){return false}if(i.keyCode===74){h=$("a[name='screen-"+(this.activeScreenIndex+1)+"']");if(h){this.activeScreenIndex++}}else{if(i.keyCode===75){h=$("a[name='screen-"+(this.activeScreenIndex-1)+"']");if(h){this.activeScreenIndex--}}else{if(!this.weAreInEditingMode&&i.keyCode===82){if((g=this.screenViews[this.activeScreenIndex-1])!=null){g.clickedReuse()}return false}else{if(!this.weAreInEditingMode&&i.keyCode===72){if((l=this.screenViews[this.activeScreenIndex-1])!=null){l.likeButtonView.clickedLike()}return false}else{if(!this.weAreInEditingMode&&i.keyCode===83){if((k=this.screenViews[this.activeScreenIndex-1])!=null){k.clickedFBShare()}return false}else{if(!this.weAreInEditingMode&&i.keyCode===67){if((j=this.screenViews[this.activeScreenIndex-1])!=null){j.leaveCommentView.textInput.focus()}return false}}}}}}if(h!=null?h.length:void 0){$("body, html").animate({scrollTop:h.offset().top-100},500,"easeOutCirc")}return false};f.prototype.addNewScreen=function(i,k,h){var j,g;j=i.get("entity_url");i.set("index",h.index,{silent:true});g=new myd.ScreenView({model:i,context:"collections",inline:true,isEditing:true});g.bind("selected",this.selectedAsset,this);g.bind("addItem",this.callAddItem,this);g.bind("addNewItem",this.callAddNewItem,this);g.bind("delete",this.deleteScreen,this);g.bind("active",this.activeScreen,this);g.render();if(h.index>0){this.$el.find("article section:eq("+(h.index-1)+")").after(g.el)}else{this.$el.find("article > div").after(g.el)}this.screenViews.splice(h.index,0,g);myd.Placeholder().refresh(this.$el);return this.reindexCollection()};f.prototype.deleteScreen=function(h){var g;this.collection.remove(h,{silent:true});g=this.frontMatterView.model.get("screens_count");this.frontMatterView.model.set("screens_count",--g);return this.reindexCollection()};f.prototype.reindexCollection=function(){return _.each(this.collection.models,function(h,g,i){h.set("prevIndex",g);h.set("nextIndex",g+2);return h.set("index",g+1)})};f.prototype.checkScroll=function(){var h,i,g,k,j=this;this.window=$(window);i=this.window.scrollTop();h=i+this.window.height();g=this.window.scrollTop()+(this.window.height()/2);k=$(".screen-item");_.all(this.screenViews,function(v){var t,n,r,l,p,q,u,o,m;l=v.$el;r=l.offset().top;n=r+l.height();if(r<=g&&r>i&&r<h){o=j.screenViews;for(q=0,u=o.length;q<u;q++){p=o[q];p.deactivateScreen()}v.activateScreen();t=_.indexOf(j.screenViews,v);j.activeScreenIndex=t+1;if((m=j.screenViews[t+1])!=null){m.fetchComments()}return false}return true});if((this.collection.models.length===0||this.activeScreenIndex>=this.collection.models.length-3)&&typeof this.recommendedCollagesView==="undefined"){return this.recommendedCollagesView=new myd.RecommendedCollagesView({container:$("#content"),topic:this.collection.frontMatter.get("topic_title"),currentCollectionUID:this.collection.frontMatter.id})}};f.prototype.enterEditingMode=function(){var k,i,j,h,g;this.weAreInEditingMode=true;$("body").addClass("editing");this.frontMatterView.startEditMode();this.addFullScreenAddBar();g=this.screenViews;for(j=0,h=g.length;j<h;j++){i=g[j];i.startEditing()}myd.Placeholder().refresh(this.$el);this.startInEditMode=false;$(".comments a").bind("click",function(){return false});if(myd.feature.publish){k=this.$el.find(".publish");k.show();k.find("input")[0].checked=true;if(!this.collection.frontMatter.attributes.published){k.find("input")[1].checked=true}}return false};f.prototype.cancelEdit=function(){this.screenViews.map(function(g){return g.trigger("cancelEdit")});if($("#content article").length>0){this.closeScreens();$("#content").html(Mustache.render($("#full_stacked_view_template").html()))}this.trigger("cancelEdit");this.leaveEditingMode();this.collection.cancelEditing();return false};f.prototype.finishEdit=function(l){var k,n,i,j,h,g,m=this;if(l==null){l={callBack:null}}myd.Placeholder().clean(this.$el);this.screenViews.map(function(o){return o.trigger("finishEdit")});if(myd.feature.publish){n=this.$el.find(".publish");if(n.is(":visible")){k=n.find("input:checked")[0].value==="publish"?true:false;this.collection.frontMatter.set("published",k,{silent:true});n.hide()}}this.collection.frontMatter.set("title",this.$el.find("h1.title").first().text().trim(),{silent:true});if(this.$el.find(".description").first().text().trim()!=="Enter description"){this.collection.frontMatter.set("description",this.$el.find(".description").first().text().trim(),{silent:true})}else{this.$el.find(".description").first().text("");this.collection.frontMatter.set("description","",{silent:true})}this.$el.find("h1, .description").attr("contenteditable",false);g=this.screenViews;for(j=0,h=g.length;j<h;j++){i=g[j];i.stopEditing()}this.trigger("finishEdit");this.leaveEditingMode(l.silent);this.syncEdit({callBack:l.callBack});this.collection.saveCurrentStateAsOriginal();return false};f.prototype.leaveEditingMode=function(){var g=this;this.weAreInEditingMode=false;$("body").removeClass("editing");if(this.frontMatterView!=null){this.frontMatterView.leaveEditMode()}if(this.addBarView!=null){this.bind("finishEdit",function(){return g.addBarView.trigger("finishEdit")});this.bind("cancelEdit",function(){return g.addBarView.trigger("cancelEdit")});this.addBarView.close()}return $(".comments a").unbind("click")};f.prototype.renderCollectionTiles=function(){var g,h,i=this;g=1;h=this.collection.map(function(k){var j;k.set("index",g,{silent:true});k.set("nextIndex",g+1,{silent:true});k.set("prevIndex",g-1,{silent:true});j=i.tileViewCreator(k);j.render();g++;return j.el});if(this.$el.find("article").length){this.$el.find("article").html(h)}else{this.$el.find("ol").html(h)}if(this.weAreInEditingMode){return this.addFullScreenAddBar()}};f.prototype.addFullScreenAddBar=function(){var g=this;this.$el.find("article > div > .add-bar").parent().remove();this.addBarView=new myd.AddBarView({model:this.collection.frontMatter,index:0,first_time:this.startInEditMode});this.$el.find("article").prepend(this.addBarView.render());this.bind("finishEdit",function(){return g.addBarView.trigger("finishEdit")});this.bind("cancelEdit",function(){return g.addBarView.trigger("cancelEdit")});this.addBarView.bind("addItem",function(h){return g.callAddItem(h)});return this.addBarView.bind("addNewItem",function(h){return g.callAddNewItem(h)})};f.prototype.syncEdit=function(g){if(g==null){g={callBack:null}}if(g.callBack===null){return this.collection.sync(this.leaveEditingMode)}else{return this.collection.sync(g.callBack)}};f.prototype.launchReorder=function(){var i,j,h,g;myd.Placeholder().clean(this.$el);g=this.screenViews;for(j=0,h=g.length;j<h;j++){i=g[j];i.saveModelChanges()}this.reorderView=new myd.ReorderCollectionView({collection:this.collection});return false};f.prototype.clickedBackToTop=function(){$("body, html").animate({scrollTop:0},500);return false};f.prototype.callSetCover=function(g){this.collection.setCoverImage(g);this.newPhotoVideoView.close();this.overlayView.close();return this.collection.frontMatter.set("cover_asset",g.toJSON())};f.prototype.selectedAsset=function(g){return myd.common.selectedScreen(g)};f.prototype.submitAssetEdit=function(g){return this.collection.sync_api(g)};f.prototype.renderError=function(){return this.$el.html("There was an error processing your request.")};f.prototype.callAddItem=function(h){var g;g=h.item.get("index");if(h.item.get("search_origin")!=null){h.item.set("asset_type",h.item.get("type")==="ImageAsset"?"image":"video");this.collection.addNewItem(h.item,g)}else{this.collection.addItemToCollection(h.item,g)}return false};f.prototype.callAddNewItem=function(h){var g;g=h.item.get("index");this.collection.addNewItem(h.item,Number(g));return false};f.prototype.shareCollection=function(){var h,j,i,g;i=this.collection.frontMatter.get("title");j=this.collection.frontMatter.get("cover_asset").thumbnail_url;h=this.collection.frontMatter.get("description");g=window.location.href.replace("local.collagio.com:9292","test.collagio.com");if(typeof FB!=="undefined"&&FB!==null){FB.ui({method:"feed",message:"",name:i,caption:"",description:h,link:g,picture:j,display:"popup",actions:[{name:"Check Out Collagio",link:"http://www.collagio.com/"}],user_message_prompt:"Share your thoughts about Collagio"},function(k){if(k&&k.post_id){}else{}})}return false};f.prototype.clickedReuse=function(){this.reuseItemView=new myd.ReuseItemView({model:this.collection});return false};f.prototype.clickedShare=function(){var i,k,j,h,g;j=this.collection.frontMatter.get("title");k=(g=this.collection.frontMatter.get("cover_asset"))!=null?g.thumbnail_url:void 0;i=this.collection.frontMatter.get("description");h=window.location.href.replace("local.collagio.com:9292","test.collagio.com");if(typeof FB!=="undefined"&&FB!==null){FB.ui({method:"feed",message:"",name:j,caption:"",description:i,link:h,picture:k,display:"popup",actions:[{name:"Check Out Collagio",link:"http://www.collagio.com/"}],user_message_prompt:"Share your thoughts about Collagio"},function(l){if(l&&l.post_id){}else{}});return false}};f.prototype.callAddItemToCollection=function(g){this.trigger("addItem",{view:this,item:g});return false};f.prototype.launchEditBackground=function(){var g,h=this;g=[];_.each(this.collection.models,function(i){if(i.get("item").get("type")==="image"||i.get("item").get("type")==="video"||i.get("item").get("type")==="collection"){if(i.get("item").get("type")==="video"&&(i.get("item").get("youtube_id")!=null)){i.get("item").set("image_300_url",myd.getVideoUrl(i.get("item").get("youtube_id")))}return g.push(i.get("item"))}});this.overlayView=new myd.OverlayView();this.newPhotoVideoView=new myd.AddPhotoVideoView({container:$("body"),addType:"cover",collectionItems:g});this.newPhotoVideoView.bind("addItem",this.callAddItemToCollection,this);this.newPhotoVideoView.bind("setCover",this.callSetCover,this);return this.newPhotoVideoView.bind("cancel",function(){return h.overlayView.close()})};f.prototype.closeScreens=function(){_.each(this.screenViews,function(g){g.unbind("selected",this.selectedAsset,this);g.unbind("addItem",this.callAddItem,this);g.unbind("addNewItem",this.callAddNewItem,this);g.unbind("delete",this.deleteScreen,this);return g.close()});return this.screenViews=[]};f.prototype.onClose=function(){var g,j,h,i=this;$.removeCookie("add_image_search");$("body").unbind("keyup");if((g=this.recommendedCollagesView)!=null){g.close()}if(this.addBarView!=null){this.bind("finishEdit",function(){return i.addBarView.trigger("finishEdit")});this.bind("cancelEdit",function(){return i.addBarView.trigger("cancelEdit")});this.addBarView.close()}this.closeScreens();if((j=this.reuseItemView)!=null){j.close()}if(this.frontMatterView!=null){this.frontMatterView.unbind("refresh");this.frontMatterView.unbind("editBackground",this.launchEditBackground,this);this.frontMatterView.close()}if((h=this.reorderView)!=null){h.close()}this.editCollectionButton.hide();return this.leaveEditingMode()};return f})(Backbone.View);global.myd.CollageView=d}).call(this);(function(){var e,d,c,f,a={}.hasOwnProperty,b=function(j,h){for(var g in h){if(a.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};if((f=global.myd)==null){global.myd={}}d=global.myd.renderAsset;c=myd.serviceModule;e=(function(h){b(g,h);function g(){return g.__super__.constructor.apply(this,arguments)}g.prototype.tagName="div";g.prototype.className="collection_tile_meta";g.prototype.events={"click .asset_owner_url":"clickedViewAssetOwner","click .collection_tile_owner_image":"clickedViewAssetOwner"};g.prototype.initialize=function(){return this};g.prototype.clickedViewAssetOwner=function(){var i;i=this.model.get("item").get("owner").entity_url;Router.navigateToProfileTab({userPath:new global.myd.Uri(i).getPathname(),tab:"collections"});return false};return g})(Backbone.View);global.myd.CollectionAuthorView=e}).call(this);(function(){var e,d,b=function(f,g){return function(){return f.apply(g,arguments)}},a={}.hasOwnProperty,c=function(i,g){for(var f in g){if(a.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i};if((d=global.myd)==null){global.myd={}}e=(function(f){c(g,f);function g(){this.showPopular=b(this.showPopular,this);this.showLatest=b(this.showLatest,this);this.showTopics=b(this.showTopics,this);this.changedSectionHandler=b(this.changedSectionHandler,this);return g.__super__.constructor.apply(this,arguments)}g.prototype["class"]="explore-navigation-header";g.prototype.searchViews=[];g.prototype.events=function(){return{"click .explore-latest":"clickedViewLatest","click .explore-popular":"clickedViewPopular","click .topics-options .title":"clickedTopic","click .explore-search a":"toggleSearch","focus .search-form input":"focusSearch"}};g.prototype.initialize=function(h){var i=this;this.appView=h.appView;this.containerEl=h.container;this.filter=h.filter;this.context=h.context;this.uid=h.uid;this.model=h.model;this.searchTerm=h.searchTerm;this.templateObj={topics:[]};this.templateObj.searchTerm=h.searchTerm||"";_.each(myd.topics,function(j){var l,k;l=new myd.Uri(j.entity_url).getPathname();k=l.split("/")[3];j.url="/papyrus/topic/"+k;j.title=j.title.toUpperCase();return i.templateObj.topics.push(j)});this.templateObj.topics.unshift({title:"All Topics",entity_url:"/papyrus/"+this.filter});return this.render()};g.prototype.render=function(){var h=this;this.containerEl.prepend(Mustache.render($("#explore_navigation_template").html(),this.templateObj));this.setElement($(".explore-navigation-header",this.containerEl));this.topicsButton=this.$el.find(".explore-topics");this.latestButton=this.$el.find(".explore-latest");this.popularButton=this.$el.find(".explore-popular");this.topicsMenu=this.$el.find(".topics-options");this.searchInput=this.$el.find(".search-form input");if(this.context==="search"){this.topicsButton.hide();this.latestButton.hide();this.popularButton.hide();this.topicsMenu.hide();this.toggleSearch()}this.topicsButton.hover(function(){return h.topicsMenu.toggle()},function(){return h.topicsMenu.toggle()});this.topicsMenu.hover(function(){h.topicsMenu.show();return h.topicsButton.addClass("selected")},function(){h.topicsMenu.hide();return h.topicsButton.removeClass("selected")});return this.initFilters()};g.prototype.initFilters=function(){this.resetFilter();this.setSelectedTopic();this.setActiveTopic();if(this.filter==="latest"){this.latestButton.addClass("selected")}if(this.filter==="popular"){return this.popularButton.addClass("selected")}};g.prototype.setSelectedTopic=function(){if(this.uid){return this.$el.find(".explore-topics a").text(this.model.get("title").toUpperCase())}};g.prototype.resetFilter=function(){this.latestButton.removeClass("selected");return this.popularButton.removeClass("selected")};g.prototype.setActiveTopic=function(){var h=this;this.$el.find(".topics-options .title").removeClass("topic-selected");if(this.model!=null){if(!(this.model.get("title")!=null)){this.model.set("title","All Topics")}if(this.model.get("title")){return this.$el.find(".topics-options .title").each(function(j,k){if($(k).text().toLowerCase()===h.model.get("title").toLowerCase()){return $(k).addClass("topic-selected")}})}}};g.prototype.changedSectionHandler=function(h){if(h.section==="showSearch"){this.showSearch()}if(h.section==="showTopics"){this.showTopics()}if(h.section==="latest"){this.showLatest()}if(h.section==="popular"){return this.showPopular()}};g.prototype.showTopics=function(){this.resetMenu();return this.topicsButton.addClass("selected")};g.prototype.showLatest=function(){return this.latestButton.addClass("selected")};g.prototype.showPopular=function(){return this.popularButton.addClass("selected")};g.prototype.clickedViewLatest=function(i){var h;if(this.context==="explorepopular"||this.context==="newstream"){Router.navigate("latest",{trigger:true})}if(this.context==="topic"){h="/topic/"+this.uid+"/latest";Router.navigate(h,true)}return false};g.prototype.clickedViewPopular=function(){var h;if(this.context==="explorepopular"||this.context==="newstream"){Router.navigate("popular",{trigger:true})}if(this.context==="topic"){h="/topic/"+this.uid+"/popular";Router.navigate(h,true)}return false};g.prototype.clickedTopic=function(i){var h;h=$(i.target).attr("href");if(this.filter===null||this.filter===void 0){this.filter="popular"}if(h!=="#"){Router.navigate(h.replace("/papyrus","")+("/"+this.filter),{trigger:true})}return false};g.prototype.toggleSearch=function(){var h;h=this.$el.find(".navigation");if(h.hasClass("searchOpen")){Router.navigate("/latest",{trigger:true});this.$el.find(".explore-topics, .explore-popular, .explore-latest").css("opacity",1)}else{this.$el.find(".explore-topics, .explore-popular, .explore-latest").css("opacity",0.4)}h.toggleClass("searchOpen");return false};g.prototype.focusSearch=function(){if(typeof this.searchTerm==="undefined"){return Router.navigate("/search",{trigger:true})}};g.prototype.resetMenu=function(){this.topicsButton.removeClass("selected");this.latestButton.removeClass("selected");return this.popularButton.removeClass("selected")};g.prototype.onClose=function(){return _.each(this.searchViews,function(h){return h.close()})};return g})(Backbone.View);global.myd.ExploreNavigationView=e}).call(this);(function(){var c,b,g,e,f,a={}.hasOwnProperty,d=function(k,i){for(var h in i){if(a.call(i,h)){k[h]=i[h]}}function j(){this.constructor=k}j.prototype=i.prototype;k.prototype=new j();k.__super__=i.prototype;return k};if((f=global.myd)==null){global.myd={}}c=(function(i){d(h,i);function h(){return h.__super__.constructor.apply(this,arguments)}h.prototype.collection=myd.GridCollection;h.prototype.bindToCollection={errorReset:"renderError",reset:"reset"};h.prototype.initialize=function(j){this.context=j.context;this.clearHistory=j.clearHistory||false;this.filter=j.filter;this.appView=j.appView;this.topicUID=j.uid;this.editCollectionButton=$("#edit-collection");this.activeScreenIndex=0;this.screenViews=[];this.tileViewCreator=j.tileViewCreator||function(m){var k,l;l=m.get("entity_url");k=new myd.ScreenView({model:m,context:j.context,inline:false,tab:j.tab});k.bind("selected",this.selectedAsset,this);this.screenViews.push(k);return k};this.collection=j.collection;return this.collection.filter=this.filter};h.prototype.reset=function(j){this.$el.find("ol").empty();return this.render()};h.prototype.render=function(){if(this.context==="popular"||this.context==="newstream"||this.context==="topic"){this.turntableExploreView=new myd.TurntableExploreView({container:this.$el,topic:this.collection.frontMatter.get("title")})}$(".page-header").removeClass("collection");this.renderCollectionTiles();if(this.collection.frontMatter.get("cover_asset")!=null){this.trigger("rendered",{clearHistory:this.clearHistory,thumbnail:this.collection.frontMatter.get("cover_asset").thumbnail_url})}else{this.trigger("rendered",{clearHistory:this.clearHistory})}return this.$el.show()};h.prototype.renderCollectionTiles=function(){var j,k=this;j=this.collection.map(function(m){var l;l=k.tileViewCreator(m);l.render(k.streamView);return l.el});return this.$el.find("ol").html(j)};h.prototype.display=function(){this.$el.show();return this.collection.fetch()};h.prototype.selectedAsset=function(j){return myd.common.selectedScreen(j)};h.prototype.renderError=function(){return this.$el.html("There was an error processing your request.")};h.prototype.clickedReuse=function(){this.reuseItemView=new myd.ReuseItemView({model:this.collection});return false};h.prototype.onClose=function(){_.each(this.screenViews,function(j){j.unbind("selected",this.selectedAsset,this);j.unbind("addItem",this.callAddItem,this);j.unbind("addNewItem",this.callAddNewItem,this);j.unbind("delete",this.deleteScreen,this);return j.close()});if(this.reuseItemView!=null){this.reuseItemView.close()}if(this.turntableExploreView!=null){return this.turntableExploreView.close()}};h.prototype.checkScreenSize=function(){new mediaQuery({media:"screen and (max-width: 639px)",entry:function(){var o,l,n,m,k,j,q,p;$(".collage-list .screen").removeClass("featured subFeatured item");$(".collage-list .screen").addClass("subFeatured no-hover");n=$(".collage-list .screen");for(m=0,k=n.length;m<k;m++){l=n[m];o=$(l).find(".asset .frame .image");if($(l).hasClass("featured")&&((j=o.data("src-745"))!=null?j.length:void 0)){o.attr("src",o.data("src-745"))}if($(l).hasClass("subFeatured")&&((q=o.data("src-300"))!=null?q.length:void 0)){o.attr("src",o.data("src-300"))}if($(l).hasClass("item")&&((p=o.data("src-300"))!=null?p.length:void 0)){o.attr("src",o.data("src-300"))}}return new global.myd.ImageCenter($(".asset"))},exit:function(){}});new mediaQuery({media:"screen and (min-width: 640px) and (max-width: 867px)",entry:function(){var o,l,n,m,k,j,q,p;$(".collage-list .screen").removeClass("featured subFeatured item no-hover");$(".collage-list .screen:nth-child(n+1):nth-child(-n+2)").addClass("featured");$(".collage-list .screen:nth-child(n+3)").addClass("item");n=$(".collage-list .screen");for(m=0,k=n.length;m<k;m++){l=n[m];o=$(l).find(".asset .frame .image");if($(l).hasClass("featured")&&((j=o.data("src-745"))!=null?j.length:void 0)){o.attr("src",o.data("src-745"))}if($(l).hasClass("subFeatured")&&((q=o.data("src-300"))!=null?q.length:void 0)){o.attr("src",o.data("src-300"))}if($(l).hasClass("item")&&((p=o.data("src-300"))!=null?p.length:void 0)){o.attr("src",o.data("src-300"))}}return new global.myd.ImageCenter($(".asset"))},exit:function(){}});new mediaQuery({media:"screen and (min-width: 868px) and (max-width: 949px)",entry:function(){var o,l,n,m,k,j,q,p;$(".collage-list .screen").removeClass("featured subFeatured item");$(".collage-list .featured").removeClass("featured").addClass("subFeatured");$(".collage-list .screen:nth-child(n+1):nth-child(-n+2)").addClass("subFeatured");$(".collage-list .screen:nth-child(n+3)").addClass("item");n=$(".collage-list .screen");for(m=0,k=n.length;m<k;m++){l=n[m];o=$(l).find(".asset .frame .image");if($(l).hasClass("featured")&&((j=o.data("src-745"))!=null?j.length:void 0)){o.attr("src",o.data("src-745"))}if($(l).hasClass("subFeatured")&&((q=o.data("src-300"))!=null?q.length:void 0)){o.attr("src",o.data("src-300"))}if($(l).hasClass("item")&&((p=o.data("src-300"))!=null?p.length:void 0)){o.attr("src",o.data("src-300"))}}return new global.myd.ImageCenter($(".asset"))},exit:function(){}});new mediaQuery({media:"screen and (min-width: 950px) and (max-width: 1099px)",entry:function(){var o,l,n,m,k,j,q,p;$(".collage-list .screen").removeClass("featured subFeatured item");$(".collage-list .screen:nth-child(n+1):nth-child(-n+2)").addClass("featured");$(".collage-list .screen:nth-child(n+3)").addClass("item");n=$(".collage-list .screen");for(m=0,k=n.length;m<k;m++){l=n[m];o=$(l).find(".asset .frame .image");if($(l).hasClass("featured")&&((j=o.data("src-745"))!=null?j.length:void 0)){o.attr("src",o.data("src-745"))}if($(l).hasClass("subFeatured")&&((q=o.data("src-300"))!=null?q.length:void 0)){o.attr("src",o.data("src-300"))}if($(l).hasClass("item")&&((p=o.data("src-300"))!=null?p.length:void 0)){o.attr("src",o.data("src-300"))}}return new global.myd.ImageCenter($(".asset"))},exit:function(){}});return new mediaQuery({media:"screen and (min-width: 1100px)",entry:function(){var o,l,n,m,k,j,q,p;$(".collage-list .screen").removeClass("featured subFeatured item");$(".collage-list .screen:nth-child(1)").addClass("featured");$(".collage-list .screen:nth-child(2)").addClass("featured");$(".collage-list .screen:nth-child(n+3):nth-child(-n+11)").addClass("subFeatured");$(".collage-list .screen:nth-child(n+12)").addClass("item");n=$(".collage-list .screen");for(m=0,k=n.length;m<k;m++){l=n[m];o=$(l).find(".asset .frame .image");if($(l).hasClass("featured")&&((j=o.data("src-745"))!=null?j.length:void 0)){o.attr("src",o.data("src-745"))}if($(l).hasClass("subFeatured")&&((q=o.data("src-300"))!=null?q.length:void 0)){o.attr("src",o.data("src-300"))}if($(l).hasClass("item")&&((p=o.data("src-300"))!=null?p.length:void 0)){o.attr("src",o.data("src-300"))}}return new global.myd.ImageCenter($(".asset"))},exit:function(){}})};return h})(Backbone.View);g=(function(h){d(i,h);function i(){return i.__super__.constructor.apply(this,arguments)}i.prototype.el="#explore-popular";i.prototype.initialize=function(j){var k;k=$('<div id="explore-popular" class="body"><ol class="collage-list cf"></ol></div>');$("#content").append(k);this.setElement(k);j.context="explorepopular";j.clearHistory=true;j.container=this.$el;return i.__super__.initialize.call(this,j)};i.prototype.render=function(){var l,j,k=this;$("#page-title").text("Explore Popular - Collagio");document.title=""+($("#page-title").text());i.__super__.render.call(this);this.$el.children(".collage-list").children("li").addClass("screen");l=this.$el.find(".screen");_.map(l,function(m,n){var o;o=$(".description",m);if((o.html()!=null)&&o.html().trim().length>0){return $(m).addClass("show-description")}});j={};j.uid=this.topicUID;j.context=this.context;j.container=this.$el;j.model=this.collection.frontMatter;j.collection=this.collection;j.appView=this.appView;j.filter=this.filter;this.exploreNavigationView=new global.myd.ExploreNavigationView(j);this.checkScreenSize();return this.$el.show()};return i})(c);b=(function(i){d(h,i);function h(){return h.__super__.constructor.apply(this,arguments)}h.prototype.el="#explore-latest";h.prototype.initialize=function(j){var k;k=$('<div id="explore-latest" class="body"><ol class="collage-list cf"></ol></div>');$("#content").append(k);this.setElement(k);j.context="newstream";j.clearHistory=true;j.container=this.$el;return h.__super__.initialize.call(this,j)};h.prototype.render=function(){var l,j,k=this;$("#page-title").text("Explore Latest - Collagio");document.title=""+($("#page-title").text());h.__super__.render.call(this);this.$el.children(".collage-list").children("li").addClass("screen");l=this.$el.find(".screen");_.map(l,function(m,n){var o;return o=$(".description",m)});omnicollagio.prop7=this.collection.frontMatter.get("title");j={};j.uid=this.topicUID;j.context=this.context;j.container=this.$el;j.model=this.collection.frontMatter;j.collection=this.collection;j.appView=this.appView;j.filter=this.filter;this.exploreNavigationView=new global.myd.ExploreNavigationView(j);this.checkScreenSize();return this.$el.show()};return h})(c);e=(function(i){d(h,i);function h(){return h.__super__.constructor.apply(this,arguments)}h.prototype.showFrontMatter=false;h.prototype.initialize=function(j){var k;k=$('<div id="topic" class="body"><ol class="collage-list cf"></ol></div>');$("#content").append(k);this.setElement(k);j.context="topic";j.clearHistory=true;j.container=this.$el;return h.__super__.initialize.call(this,j)};h.prototype.render=function(){var l,j,k=this;$("#page-title").text(""+(this.collection.frontMatter.get("title"))+" "+(myd.capFirstLetter(this.filter))+" - Collagio");document.title=""+($("#page-title").text());omnicollagio.prop7=this.collection.frontMatter.get("topic_title");omnicollagio.pageName="topic > home: "+this.collection.frontMatter.get("title");omnicollagio.eVar15="D=pageName";h.__super__.render.call(this);this.$el.find(".collage-list").children("li").addClass("screen");l=this.$el.find(".screen");_.map(l,function(m,n){});j={};j.uid=this.topicUID;j.context=this.context;j.container=this.$el;j.model=this.collection.frontMatter;j.collection=this.collection;j.appView=this.appView;j.filter=this.filter;this.exploreNavigationView=new global.myd.ExploreNavigationView(j);this.topicHeaderView=new myd.TopicHeaderView({container:this.$el,model:this.collection.frontMatter,collection:this.collection});this.checkScreenSize();return this.$el.show()};return h})(c);global.myd.ExploreBaseView=c;global.myd.ExploreTopicView=e;global.myd.ExplorePopularView=g;global.myd.ExploreLatestView=b}).call(this);(function(){var a,d,b={}.hasOwnProperty,c=function(h,f){for(var e in f){if(b.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}a=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.initialize=function(){return this.render()};e.prototype.render=function(){var g,h=this;g=$("#feedback_template").html();if(g===null){return false}$("body").append("<div id='feedback_form'>");this.setElement($("#feedback_form"));this.$el.html(Mustache.render(g));this.$el.find(".form_toggle_btn").on("click",function(){h.$el.toggleClass("activated");return false});this.$el.find(".close_form").on("click",function(){return h.$el.removeClass("activated")});return this.$el.find("#feedback_submit").on("click",function(){return h.submitFeedback()})};e.prototype.submitFeedback=function(){var h,i,k,g,j;j="";i=this.$el.find("#feedback_text").val();k=window.location.href;g=navigator.userAgent;this.$el.find("#feedback_form input[type=radio]").each(function(){if($(this).attr("checked")){return j=$(this).val()}});h={feedbackText:i,type:j,feedbackURL:k,feedbackUserAgent:g};h=JSON.stringify(h);return $.post("/api/feedback/submit",h,function(l){alert(l);$("#feedback_form").removeClass("activated");$("#feedback_text").val("");return $("#feedback_form input[type=radio]").each(function(){return $(this).removeAttr("checked")})})};return e})(Backbone.View);global.myd.FeedbackView=a}).call(this);(function(){var b,d,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}b=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.el="header.pageHeader";e.prototype.events=function(){return{"click .my-profile":"clickedMyProfile","click .view-my-collages":"clickedViewMyProfileCollages","click .view-my-stats":"clickedViewMyProfileStats","click .view-my-bookmarks":"clickedViewMyProfileLikes","click .view-my-liked-topics":"clickedViewMyProfileLikedTopics","click .view-my-items":"clickedViewMyProfileItems","click .view-bookmarklet":"clickedViewBookmarklet","click .create-btn":"clickedCreate"}};e.prototype.initialize=function(g){this.appView=g;return this.render()};e.prototype.render=function(){$("body").prepend(Mustache.render($("#header_template").html(),{current_user_image_url:global.myd.current_user_image_url,first_name:global.myd.current_user_fname,last_name:global.myd.current_user_lname}));this.setElement($(".page-header"));this.myProfile=this.$el.find(".login-container");return this.myProfile.hover(function(){return $(this).addClass("open")},function(){return $(this).removeClass("open")})};e.prototype.clickedMyProfile=function(){this.myProfile.removeClass("open");Router.navigateToProfileTabForCurrentUser("my_stats");return false};e.prototype.clickedViewMyProfileCollages=function(){this.myProfile.removeClass("open");Router.navigateToProfileTabForCurrentUser("collections");return false};e.prototype.clickedViewMyProfileStats=function(){this.myProfile.removeClass("open");Router.navigateToProfileTabForCurrentUser("my_stats");return false};e.prototype.clickedViewMyProfileLikes=function(){this.myProfile.removeClass("open");Router.navigateToProfileTabForCurrentUser("likes");return false};e.prototype.clickedViewMyProfileLikedTopics=function(){this.myProfile.removeClass("open");Router.navigateToProfileTabForCurrentUser("topics");return false};e.prototype.clickedViewMyProfileItems=function(){this.myProfile.removeClass("open");Router.navigateToProfileTabForCurrentUser("items");return false};e.prototype.clickedViewBookmarklet=function(){this.myProfile.removeClass("open");Router.navigate("bookmarklet",{trigger:true});return false};e.prototype.clickedCreate=function(){var g=this;this.overlayView=new myd.OverlayView();this.add_collection_view=new myd.AddCollectionTileView({model:new myd.AddCollectionTileModel({topics:myd.topics}),getForm:function(){return $(".add-collection-form")},getFormWrapper:function(){return $(".add-collection-form-wrapper")},overlay:this.overlayView,serviceModule:myd.serviceModule,createCollectionUrl:myd.urls.create_collection});this.add_collection_view.bind("refresh",function(){return g.trigger("refresh")});this.add_collection_view.render();this.overlayView.$el.append(this.add_collection_view.$el);return false};e.prototype.onClose=function(){return this.overlayView.close()};return e})(Backbone.View);global.myd.HeaderView=b}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.model=myd.ScreenModel;f.prototype.events={"click .more-info":"clickedMoreInfo",click:"stopClick","click .origin_source_url":"clickedSource"};f.prototype.initialize=function(g){this.model.set("index",1);this.model.get("item").bind("change:metaData",this.toggleMetaDataView,this);return this.render()};f.prototype.render=function(){this.overlayView=new myd.OverlayView();this.overlayView.bind("clickedClose",this.onClose,this);this.overlayView.$el.html("<div id='item-lightbox'>");this.setElement($("#item-lightbox"));this.$el.html(myd.renderScreen(this.model.toJSON(),"itemlightbox",{showActions:true,showLikeButton:true}));this.$el.css("opacity",1);this.$el.find(".image-wrapper").css("opacity",1);if(this.model.get("item").get("type")==="video"){myd.renderVideoEmbed(this.model,this.$el,600)}else{if(this.model.get("item").get("type")==="feed"){this.assetRSSView=new global.myd.AssetRSSView({model:this.model.get("item"),container:this.$el})}}this.likeButtonView=new myd.LikeButtonView({model:this.model,el:this.$el.find(".like-container")});return this.$el.find(".below-asset").addClass("cf")};f.prototype.toggleMetaDataView=function(){return this.metaDataView=new global.myd.AssetMetaDataView({model:this.model.get("item"),container:this.$el.find(".below-asset")})};f.prototype.clickedMoreInfo=function(g){var h;if(typeof this.metaDataView==="undefined"||this.metaDataView===null){this.model.get("item").fetchMetaData()}else{h=this.metaDataView.toggle()}return false};f.prototype.clickedSource=function(){var g;g=this.model.get("item").get("source_page_url");if((g!=null?g.indexOf("http://"):void 0)===0){this.sourceWindow=window.open(g)}return false};f.prototype.stopClick=function(g){if($(g.target).hasClass("asset-wrapper")){return true}return false};f.prototype.onClose=function(){var g=this;return this.$el.slideUp(500,function(){if(g.metaDataView!=null){g.metaDataView.close()}if(g.likeButtonView!=null){g.likeButtonView.close()}if(g.assetRSSView!=null){g.assetRSSView.close()}g.overlayView.unbind("clickedClose",g.onClose,g);return g.overlayView.close()})};return f})(Backbone.View);global.myd.ItemLightboxView=d}).call(this);(function(){var f,d,c,e,a={}.hasOwnProperty,b=function(j,h){for(var g in h){if(a.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};if((e=global.myd)==null){global.myd={}}d=global.myd.renderAsset;c=myd.serviceModule;f=(function(g){b(h,g);function h(){return h.__super__.constructor.apply(this,arguments)}h.prototype.model=myd.CommentModel;h.prototype.tagName="form";h.prototype.events={"keyup textarea":"clickedPostComment","click .leave-comment-text":"clickedLeaveComment"};h.prototype.bindToCollection={add:"clearForm"};h.prototype.initialize=function(i){this.containerEl=i.container;this.collection=i.collection;this.item=i.item;this.model=new myd.CommentModel();return this.render()};h.prototype.render=function(){var i;i=Mustache.render($("#leave_comment_template").html(),{avatar:myd.current_user_image_url});this.containerEl.append(i);this.setElement($("form.leave-comment",this.containerEl));this.textInput=this.$el.find(".leave-comment-text");this.textInput.keyup(function(k){var j;j=[];while($(this).outerHeight()<this.scrollHeight+parseFloat($(this).css("borderTopWidth"))+parseFloat($(this).css("borderBottomWidth"))){j.push($(this).height($(this).height()+1))}return j});return this.delegateEvents()};h.prototype.clickedLeaveComment=function(){var j,i;j=this.containerEl.find(".screen-comments ol");j.scrollTop(j[0].scrollHeight);i=this.textInput.attr("rows");if(i==="1"){this.textInput.attr("rows","3");return $(".post-comment-btn").show()}};h.prototype.clickedPostComment=function(j){var i,k;if(j.keyCode!==13){return true}i=this.textInput.val().trim();if(i.length===0){this.textInput.addClass("field_validation_error");return false}else{this.textInput.removeClass("field_validation_error")}this.model.set("text",i);this.collection.save(this.model);k=this.containerEl.find(".screen-comments ol");k.scrollTop(k[0].scrollHeight);return false};h.prototype.clearForm=function(){this.$el.find("textarea").val("");this.textInput.height(30);this.model=new myd.CommentModel();this.textInput.blur();$("body").focus();return false};return h})(Backbone.View);global.myd.LeaveCommentView=f}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.model=myd.ScreenModel;f.prototype.className="like-container";f.prototype.events={click:"clickedLike","click .follow-topic":"clickedFollow"};f.prototype.initialize=function(g){if(this.model.get("item")!=null){this.model.get("item").bind("change:collected",this.refreshLike,this)}else{this.model.bind("change:collected",this.refreshLike,this)}this.likeCount=this.$el.find(".like-count");return this.refreshLike()};f.prototype.clickedFollow=function(){var g;this.clickedLike();g=$(".follow-topic");if(g.find(".text").html().toLowerCase()==="following topic"){g.find(".text").html("FOLLOW TOPIC");g.removeClass("followed-topic-btn").addClass("following-topic-btn")}else{g.find(".text").html("FOLLOWING TOPIC");g.addClass("followed-topic-btn").removeClass("following-topic-btn")}return false};f.prototype.clickedLike=function(g){if(this.model.get("item")!=null){this.model.get("item").toggleLike()}else{this.model.toggleLike()}return false};f.prototype.refreshLike=function(){var h,i,g;i=$(".follow-topic");if(this.model.get("collected")){i.find(".text").html("FOLLOWING TOPIC");i.addClass("followed-topic-btn").removeClass("following-topic-btn")}else{i.find(".text").html("FOLLOW TOPIC")}i=$(".follow-topic");if(this.model.get("collected")){i.find(".text").html("FOLLOWING TOPIC");i.addClass("followed-topic-btn").removeClass("following-topic-btn")}else{i.find(".text").html("FOLLOW TOPIC");i.removeClass("followed-topic-btn").addClass("following-topic-btn")}if(this.model.get("item")!=null){h=(g=this.model.get("item"))!=null?g.get("collected_count"):void 0}else{h=this.model.get("collected_count")}return this.likeCount.html(""+h)};return f})(Backbone.View);global.myd.LikeButtonView=d}).call(this);(function(){var a,e,d,f,b={}.hasOwnProperty,c=function(j,h){for(var g in h){if(b.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};if((f=global.myd)==null){global.myd={}}e=global.myd.renderAsset;d=myd.serviceModule;a=(function(h){c(g,h);function g(){return g.__super__.constructor.apply(this,arguments)}g.prototype.model=myd.NotificationModel;g.prototype.tagName="li";g.prototype.events={"click .view-link":"clickedView"};g.prototype.initialize=function(i){this.containerEl=i.container;return this.render()};g.prototype.render=function(){var k,j,i;i=this.model.toJSON();if(i.text.length>100){i.text=i.text.substring(0,99)}i.created_timestamp=new Date(i.created_timestamp*1000);j=myd.routesModule.getRoutesFromUrl(i.collection_url);i.collection_url=j.getPapyrusPath();i.actionText={comment:"added a comment to your collage"}[i.type];k=Mustache.render($("#notifications_list_item_template").html(),i);this.containerEl.append(k);this.setElement($("#notifications-list li:last-child"));return this.$el.find("time").relativeTime()};g.prototype.clickedView=function(){var i;i=myd.routesModule.getRoutesFromUrl(this.model.get("collection_url"));Router.navigate(i.getPapyrusPath()+"/screens/"+this.model.get("screen_uid"),{trigger:true});return this.trigger("clickedView")};return g})(Backbone.View);global.myd.NotificationItemView=a}).call(this);(function(){var f,d,c,e,a={}.hasOwnProperty,b=function(j,h){for(var g in h){if(a.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};if((e=global.myd)==null){global.myd={}}d=global.myd.renderAsset;c=myd.serviceModule;f=(function(g){b(h,g);function h(){return h.__super__.constructor.apply(this,arguments)}h.prototype.collection=myd.NotificationsCollection;h.prototype.notificationViews=[];h.prototype.events={click:"fallThrough"};h.prototype.initialize=function(i){var j=this;this.containerEl=i.container;$("body").on("click",function(){return j.toggleList({close:true,propagate:true})});this.collection=new myd.NotificationsCollection();return this.collection.bind("reset",this.render,this)};h.prototype.refresh=function(){return this.collection.fetch()};h.prototype.render=function(){var i,j=this;if($("#notifications").length===0){$("nav .create-btn").after('<span id="count-wrapper"><a href="#" id="notifications-count" class="zero"></a></span>');this.countEl=$("#notifications-count");this.countEl.bind("click",function(){return j.toggleList()});$("nav").append(Mustache.render($("#notifications_list_template").html()));this.setElement($("#notifications"))}else{this.$el.find("ol#notifications-list").empty()}i=this.collection.where({read:false});this.setCount(i.length);this.notificationsOL=this.$el.find("ol#notifications-list");if(this.collection.models.length>0){_.each(this.collection.models,function(k){var l;l=new myd.NotificationItemView({model:k,container:j.notificationsOL});l.bind("clickedView",j.closeList,j);return j.notificationViews.push(l)});this.notificationsOL.show()}else{$("#no-notifications-message").show();this.notificationsOL.hide()}return $(".notification-date").relativeTime()};h.prototype.setCount=function(i){i=i>-1?i:this.collection.length;this.countEl.html(i);return this.countEl.toggleClass("zero",i===0)};h.prototype.closeList=function(){return this.toggleList({close:true})};h.prototype.toggleList=function(i){if((this.$el!=null)&&(i!=null)&&(i.close!=null)){this.closeDropOut();if(i.propagate){return true}return false}if((this.$el!=null)&&this.$el.css("display")==="none"){this.collection.markAllRead();this.$el.show()}else{this.closeDropOut()}return false};h.prototype.closeDropOut=function(){if(this.countEl!=null){this.$el.slideUp(500);this.setCount(0);return this.collection.reset(this.collection.models)}};h.prototype.fallThrough=function(){return false};h.prototype.onClose=function(){$("body").off("click");return _.each(this.notificationViews,function(i){i.unbind("clickedView",this.closeList,this);return i.close()})};return h})(Backbone.View);global.myd.NotificationsListView=f}).call(this);(function(){var b,d,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}b=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.events={click:"clickedClose"};e.prototype.initialize=function(){return this.render()};e.prototype.render=function(){$("body").addClass("noscroll").append("<div id='overlay'>");this.setElement($("#overlay"));return window.setTimeout(function(){return $("#overlay").addClass("activated")},200)};e.prototype.clickedClose=function(){this.trigger("clickedClose");return false};e.prototype.onClose=function(){return $("body").removeClass("noscroll")};return e})(Backbone.View);global.myd.OverlayView=b}).call(this);(function(){var c,d,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}c=(function(f){b(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.collection=myd.GridCollection;e.prototype.bindToCollection={reset:"render"};e.prototype.initialize=function(g){this.lastElementFilterOption=null;this.user=g.user;this.containerEl=g.container;this.collection=new myd.GridCollection();this.screenViews=[];g.context="profile";g.tab="topics";this.navigationView=g.navigationView;this.screenViews=[];this.tileViewCreator=g.tileViewCreator||function(j){var h,i;i=j.get("entity_url");h=new myd.ScreenView({model:j,context:g.context,inline:false,tab:g.tab});h.bind("selected",this.selectedAsset,this);this.screenViews.push(h);return h};return this.requestDefaultFilter()};e.prototype.requestDefaultFilter=function(){return this.fetchByFilter("views")};e.prototype.fetchByFilter=function(h){var g;g={views:this.user.get("followed_users")}[h];return this.collection.fetchByUrl(g)};e.prototype.render=function(){var h,i,g,j=this;$("#page-title").text("Collagio Profile My Stats - "+(this.collection.frontMatter.get("owner").first_name)+" "+(this.collection.frontMatter.get("owner").last_name));document.title=""+($("#page-title").text());if($("#profile-header").length<1){this.frontMatterView=new global.myd.CollageHeaderView({container:$("#my-profile"),model:this.collection.frontMatter,collection:this.collection,currentUserModel:this.user,type:"profile",collection_count_text:{topics:"Topic",items:"Item",collections:"Collection",likes:"Like"}[this.tab]});this.$el.append(this.frontMatterView.el);this.frontMatterView.bind("refresh",function(){return j.collection.fetch()});$("#profile-header").append(this.navigationView.el);this.navigationView.delegateEvents()}this.setElement($(".profile-content"));this.elementList=this.$el.find(".following-list");$(".no-data").hide();g=[];g=this.collection.models;i=g.map(function(m){var n,l,k;l=m.get("item");n=l.get("image_url");if(!n.indexOf("twitter.com")>0){n=n+"?type=large"}l.set("image_url",n);m.set("item",l);k=j.tileViewCreator(m);k.render(j.streamView);return k.el});if(g.length===0){$(".no-data").show()}this.elementList.append(i);h="Following "+this.collection.collection.screens_count+" People";$(".following-count").html(h);$(".like-container").hide();this.checkScreenSize();return new global.myd.ImageCenter(this.$el.find(".asset"))};e.prototype.checkScreenSize=function(){new mediaQuery({media:"screen and (max-width: 639px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured subFeatured item");$(".element-list .screen").addClass("subFeatured");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 640px) and (max-width: 867px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured subFeatured");$(".element-list .screen").addClass("item");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 868px) and (max-width: 949px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured subFeatured");$(".element-list .screen").addClass("item");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 950px) and (max-width: 1099px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured subFeatured");$(".element-list .screen").addClass("item");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});return new mediaQuery({media:"screen and (min-width: 1100px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured  item");$(".element-list .screen").addClass("subFeatured");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}})};e.prototype.selectedAsset=function(g){return myd.common.selectedScreen(g)};e.prototype.selectedScreen=function(g){return myd.common.selectedScreen(g)};e.prototype.onClose=function(){return _.each(this.screenViews,function(g){g.unbind("selected",this.selectedScreen,this);return g.close()})};return e})(Backbone.View);global.myd.ProfileFollowingView=c}).call(this);(function(){var a,d,b={}.hasOwnProperty,c=function(h,f){for(var e in f){if(b.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}a=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.collection=myd.GridCollection;e.prototype.bindToCollection={reset:"render"};e.prototype.events={"click .collage-view-options .selected-collage-filter":"clickedCollageFilterDropdown","click .collage-view-options .options li":"clickedCollageFilterDropdownItem"};e.prototype.initialize=function(g){this.lastCollageFilterOption=null;this.user=g.user;this.containerEl=g.container;this.collection=new myd.GridCollection();this.screenViews=[];this.tileViewCreator=g.tileViewCreator;g.context="profile";g.tab="my_stats";this.navigationView=g.navigationView;this.screenViews=[];this.tileViewCreator=g.tileViewCreator||function(j){var h,i;i=j.get("entity_url");h=new myd.ScreenView({model:j,context:g.context,inline:false,tab:g.tab});h.bind("selected",this.selectedAsset,this);this.screenViews.push(h);return h};return this.requestDefaultFilter()};e.prototype.requestDefaultFilter=function(){return this.fetchByFilter("views")};e.prototype.clickedCollageFilterDropdown=function(){var g;g=this.$el.find(".collage-view-options");g.toggleClass("open");return g.find(".options").toggle("blind",150)};e.prototype.clickedCollageFilterDropdownItem=function(i){var h,g,j;j=$(i.target);g=j.attr("filter");h=this.$el.find(".collage-view-options");h.find(".selected-collage-filter").text(j.text()).attr("filter",g);this.clickedCollageFilterDropdown();return this.fetchByFilter(g)};e.prototype.fetchByFilter=function(h){var g;g={views:this.user.get("top_collages_by_views"),likes:this.user.get("top_collages_by_likes"),comments:this.user.get("top_collages_by_comments"),reuses:this.user.get("top_collages_by_reuses")}[h];return this.collection.fetchByUrl(g)};e.prototype.render=function(){var h,g,i=this;$("#page-title").text("Collagio Profile My Stats - "+(this.collection.frontMatter.get("owner").first_name)+" "+(this.collection.frontMatter.get("owner").last_name));document.title=""+($("#page-title").text());if($("#profile-header").length<1){this.frontMatterView=new global.myd.CollageHeaderView({container:$("#my-profile"),model:this.collection.frontMatter,collection:this.collection,currentUserModel:this.user,type:"profile",collection_count_text:{topics:"Topic",items:"Item",collections:"Collection",likes:"Like"}[this.tab]});this.$el.append(this.frontMatterView.el);this.frontMatterView.bind("refresh",function(){return i.collection.fetch()});$("#profile-header").append(this.navigationView.el);this.navigationView.delegateEvents()}if(this.containerEl.find("#collage-filter-container").length<1){this.containerEl.prepend(Mustache.render($("#profile_my_stats_collage_filter_template").html()))}this.setElement($("#collage-filter-container"));this.collageList=this.$el.find(".collage-list");this.collageList.empty();g=[];g=this.collection.models;h=g.map(function(k){var j;j=i.tileViewCreator(k);j.model.set("showActions");j.render(i.streamView);return j.el});this.collageList.append(h);this.$el.find(".collage-list li").addClass("screen subFeatured my-stats-collage");this.checkScreenSize();return new global.myd.ImageCenter(this.$el.find(".asset"))};e.prototype.checkScreenSize=function(){new mediaQuery({media:"screen and (max-width: 639px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured subFeatured item");$(".collage-list .screen").addClass("subFeatured");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 640px) and (max-width: 867px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured subFeatured");$(".collage-list .screen").addClass("item");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 868px) and (max-width: 949px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured subFeatured");$(".collage-list .screen").addClass("item");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 950px) and (max-width: 1099px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured subFeatured");$(".collage-list .screen").addClass("item");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});return new mediaQuery({media:"screen and (min-width: 1100px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured  item");$(".collage-list .screen").addClass("subFeatured");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}})};e.prototype.selectedScreen=function(g){return myd.common.selectedScreen(g)};e.prototype.onClose=function(){return _.each(this.screenViews,function(g){g.unbind("selected",this.selectedScreen,this);return g.close()})};return e})(Backbone.View);global.myd.ProfileMyStatsCollageFilterView=a}).call(this);(function(){var a,d,b={}.hasOwnProperty,c=function(h,f){for(var e in f){if(b.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}a=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.collection=myd.GridCollection;e.prototype.bindToCollection={reset:"render"};e.prototype.events={"click .element-view-options .selected-element-filter":"clickedElementFilterDropdown","click .element-view-options .options li":"clickedElementFilterDropdownItem"};e.prototype.initialize=function(g){this.lastElementFilterOption=null;this.user=g.user;this.containerEl=g.container;this.collection=new myd.GridCollection();this.screenViews=[];g.context="profile";g.tab="my_stats";this.navigationView=g.navigationView;this.screenViews=[];this.tileViewCreator=g.tileViewCreator||function(j){var h,i;i=j.get("entity_url");h=new myd.ScreenView({model:j,context:g.context,inline:false,tab:g.tab});h.bind("selected",this.selectedAsset,this);this.screenViews.push(h);return h};return this.requestDefaultFilter()};e.prototype.requestDefaultFilter=function(){return this.fetchByFilter("views")};e.prototype.clickedElementFilterDropdown=function(){var g;g=this.$el.find(".element-view-options");g.toggleClass("open");return g.find(".options").toggle("blind",150)};e.prototype.clickedElementFilterDropdownItem=function(i){var h,g,j;j=$(i.target);g=j.attr("filter");h=this.$el.find(".element-view-options");h.find(".selected-element-filter").text(j.text()).attr("filter",g);this.clickedElementFilterDropdown();return this.fetchByFilter(g)};e.prototype.fetchByFilter=function(h){var g;g={views:this.user.get("top_assets_by_views"),likes:this.user.get("top_assets_by_likes"),comments:this.user.get("top_assets_by_comments"),reuses:this.user.get("top_assets_by_reuses")}[h];return this.collection.fetchByUrl(g)};e.prototype.render=function(){var h,g,i=this;$("#page-title").text("Collagio Profile My Stats - "+(this.collection.frontMatter.get("owner").first_name)+" "+(this.collection.frontMatter.get("owner").last_name));document.title=""+($("#page-title").text());if($("#profile-header").length<1){this.frontMatterView=new global.myd.CollageHeaderView({container:$("#my-profile"),model:this.collection.frontMatter,collection:this.collection,currentUserModel:this.user,type:"profile",collection_count_text:{topics:"Topic",items:"Item",collections:"Collection",likes:"Like"}[this.tab]});this.$el.append(this.frontMatterView.el);this.frontMatterView.bind("refresh",function(){return i.collection.fetch()});$("#profile-header").append(this.navigationView.el);this.navigationView.delegateEvents()}if(this.containerEl.find("#element-filter-container").length<1){this.containerEl.append(Mustache.render($("#profile_my_stats_element_filter_template").html()))}this.setElement($("#element-filter-container"));this.elementList=this.$el.find(".element-list");this.elementList.empty();g=[];g=this.collection.models;h=g.map(function(k){var j;j=i.tileViewCreator(k);j.model.set("showActions");j.render(i.streamView);return j.el});this.elementList.append(h);this.$el.find(".element-list li").addClass("screen subFeatured my-stats-element");this.checkScreenSize();return new global.myd.ImageCenter(this.$el.find(".asset"))};e.prototype.checkScreenSize=function(){new mediaQuery({media:"screen and (max-width: 639px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured subFeatured item");$(".element-list .screen").addClass("subFeatured");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 640px) and (max-width: 867px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured subFeatured");$(".element-list .screen").addClass("item");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 868px) and (max-width: 949px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured subFeatured");$(".element-list .screen").addClass("item");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 950px) and (max-width: 1099px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured subFeatured");$(".element-list .screen").addClass("item");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});return new mediaQuery({media:"screen and (min-width: 1100px)",entry:function(){var l,i,k,j,h,g;$(".element-list .screen").removeClass("featured  item");$(".element-list .screen").addClass("subFeatured");k=$(".element-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}})};e.prototype.selectedAsset=function(g){return myd.common.selectedScreen(g)};e.prototype.selectedScreen=function(g){return myd.common.selectedScreen(g)};e.prototype.onClose=function(){return _.each(this.screenViews,function(g){g.unbind("selected",this.selectedScreen,this);return g.close()})};return e})(Backbone.View);global.myd.ProfileMyStatsElementFilterView=a}).call(this);(function(){var c,d,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}c=(function(f){b(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.tagName="div";e.prototype.id="profile-navigation";e.prototype.events={"click .collections":"collectionsTabSelected","click .topics":"topicsTabSelected","click .likes":"likesTabSelected","click .items":"itemsTabSelected","click .my_stats":"myStatsTabSelected"};e.prototype.bindToModel={"change:activeTab":"setActiveTabClass"};e.prototype.initialize=function(g){this.userPath=g.userPath;this.tab=g.tab;this.template=$("#my_profile_navigation").html();this.model=new Backbone.Model;this.render();return this.loadTabForUserPath()};e.prototype.render=function(){var g;this.$el.empty();g=Mustache.render(this.template,null);this.$el.append(g);this.setActiveTabClass();return this};e.prototype.setActiveTabClass=function(){this.$el.find("a").removeClass("active");return this.$el.find("a."+this.model.get("activeTab")).addClass("active")};e.prototype.loadTabForUserPath=function(){return this.getUserModelForUserWithPathAndThen()};e.prototype.profileRoute=function(){return this.loadTabForUserPath()};e.prototype.collectionsTabSelected=function(){Router.navigateToProfileTab({userPath:this.userPath,tab:"collections"});return false};e.prototype.topicsTabSelected=function(){Router.navigateToProfileTab({userPath:this.userPath,tab:"topics"});return false};e.prototype.likesTabSelected=function(){Router.navigateToProfileTab({userPath:this.userPath,tab:"likes"});return false};e.prototype.itemsTabSelected=function(){Router.navigateToProfileTab({userPath:this.userPath,tab:"items"});return false};e.prototype.myStatsTabSelected=function(){Router.navigateToProfileTab({userPath:this.userPath,tab:"my_stats"});return false};e.prototype.updateTilesCollectionForTab=function(){var g;this.model.set("activeTab",this.tab);g=this.userModel.get({likes:"bookmarks_url",topics:"topics_url",items:"items_url",collections:"collections_url",my_stats:""}[this.tab]);return this.trigger("fetchProfileTabCollection",{url:g,user:this.userModel})};e.prototype.getUserModelForUserWithPathAndThen=function(){var g=this;return myd.serviceModule.get({url:this.userPath,success:function(h){g.userModel=new myd.UserModel(h);return g.updateTilesCollectionForTab()}})};return e})(Backbone.View);global.myd.ProfileNavigationView=c}).call(this);(function(){var d,a,e,b={}.hasOwnProperty,c=function(i,g){for(var f in g){if(b.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i};if((e=global.myd)==null){global.myd={}}a=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.collection=myd.GridCollection;f.prototype.showFrontMatter=true;f.prototype.bindToCollection={errorReset:"renderError",reset:"reset",deleteScreen:"deleteScreen"};f.prototype.events=function(){return{"click .follow-user":"followClicked"}};f.prototype.followClicked=function(){var i,j,h;if((this.currentUser!=null)){this.collection.frontMatter=this.currentUser;j=this.collection.frontMatter.get("entity_url")}else{j=this.collection.frontMatter.get("owner").entity_url}this.collection.frontMatter.set("entity_url",j);i=false;h=$(".follow-user");if(h.find(".text").html().toLowerCase()!=="following user"){i=true}return this.follow_unfollow(this.collection.frontMatter,i)};f.prototype.handleFollowUnfollow=function(){var h;h=$(".follow-user");if(h.find(".text").html().toLowerCase()==="following user"){h.find(".text").html("FOLLOW USER");return h.removeClass("followed-user-btn").addClass("following-user-btn")}else{h.find(".text").html("FOLLOWING USER");return h.addClass("followed-user-btn").removeClass("following-user-btn")}};f.prototype.follow_unfollow=function(i,h){var j=this;return myd.serviceModule.post({url:myd.urls.bookmarks,data:{entity_url:i.get("entity_url"),bookmarked:h},success:function(k){var l;l=h;if(k.collected){i.set("collected_count",++l)}else{i.set("collected_count",l>0?--l:0)}j.handleFollowUnfollow();return i.set("collected",k.collected)}})};f.prototype.initialize=function(h){this.frontMatterView=null;this.context=h.context;this.clearHistory=h.clearHistory||false;this.editBar=$(".edit");this.filter=h.filter;this.lastCollageFilterOption=null;this.lastElementFilterOption=null;this.screenViews=[];this.tileViewCreator=h.tileViewCreator||function(k){var i,j;j=k.get("entity_url");i=new myd.ScreenView({model:k,context:h.context,inline:h.inline,tab:h.tab});i.bind("selected",this.selectedAsset,this);i.bind("delete",this.deleteScreen,this);this.screenViews.push(i);return i};return this.collection=h.collection};f.prototype.reset=function(h){var i=this;if(this.showFrontMatter&&this.frontMatterView!==null){this.frontMatterView.unbind("refresh",function(){return i.collection.fetch()});this.frontMatterView.unbind("editBackground",this.launchEditBackground,this);this.frontMatterView.close()}return this.render()};f.prototype.render=function(){var h=this;this.editBar.find(".cancel-edit-btn").click(function(){return h.cancelEdit()});this.editBar.find(".done-edit-btn").click(function(){return h.finishEdit()});this.editBar.find(".reorder-btn").click(function(){return h.launchReorder()});if(this.showFrontMatter){this.frontMatterView=new global.myd.CollageHeaderView({container:this.$el,model:this.collection.frontMatter,collection:this.collection,isEditing:this.weAreInEditingMode||false,type:{explorepopular:"popular",profile:"profile","new":"new_stream",collections:"collection"}[this.context]});this.frontMatterView.bind("refresh",function(){return h.collection.fetch()});this.frontMatterView.bind("editBackground",this.launchEditBackground,this)}if(myd.feature.turntable&&(this.context==="popular"||this.context==="newstream")){this.turntableExploreView=new myd.TurntableExploreView({container:this.$el,collection:this.collection})}$(".page-header").removeClass("collection");this.renderCollectionTiles();if(this.collection.frontMatter.get("cover_asset")!=null){this.trigger("rendered",{clearHistory:this.clearHistory,thumbnail:this.collection.frontMatter.get("cover_asset").thumbnail_url})}else{this.trigger("rendered",{clearHistory:this.clearHistory})}this.$el.show();if(this.inline&&this.collection.frontMatter.get("editable")){this.editCollectionButton.show();this.editCollectionButton.click(function(){return h.enterEditingMode()})}else{this.editCollectionButton.hide()}if(this.startInEditMode){return this.enterEditingMode()}};f.prototype.renderCollectionTiles=function(){var h,i=this;h=this.collection.map(function(k){var j;j=i.tileViewCreator(k);j.render(i.streamView);return j.el});if(this.$el.find("article").length){this.$el.find("article").html(h)}else{this.$el.find(".collage-list").html(h)}if(this.weAreInEditingMode){return this.addFullScreenAddBar()}};f.prototype.display=function(){this.$el.show();return this.collection.fetch()};f.prototype.selectedAsset=function(h){return myd.common.selectedScreen(h)};f.prototype.deleteScreen=function(h){return this.collection.remove(h)};f.prototype.deleteScreen=function(h){return this.collection.deleteScreen(h.get("item").get("entity_url"),h)};f.prototype.renderError=function(){return this.$el.html("There was an error processing your request.")};f.prototype.onClose=function(){var h=this;_.each(this.screenViews,function(i){i.unbind("selected",this.selectedAsset,this);i.unbind("addItem",this.callAddItem,this);i.unbind("addNewItem",this.callAddNewItem,this);i.unbind("delete",this.deleteScreen,this);return i.close()});if(this.reuseItemView!=null){this.reuseItemView.close()}if(this.frontMatterView!=null){this.frontMatterView.unbind("refresh",function(){return h.collection.fetch()});this.frontMatterView.unbind("editBackground",this.launchEditBackground,this);this.frontMatterView.close()}if(this.itemLightboxView!=null){return this.itemLightboxView.close()}};return f})(Backbone.View);d=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.showFrontMatter=true;f.prototype.initialize=function(h){var i;i="profile_"+h.tab+"_view_template";$("#content").html(Mustache.render($("#"+i).html()));if(h.tab==="topics"){this.setElement($("#my-profile-following"))}else{this.setElement($("#my-profile"))}this.context=h.context;this.model=h.model;this.tab=h.tab;this.userPath=h.userPath;this.context="profile";h.inline=false;h.context=this.context;h.clearHistory=true;new global.myd.ImageCenter($(".asset"));return f.__super__.initialize.call(this,h)};f.prototype.render=function(){var o,n,l,h,r,i,p,j,k,q,m=this;p={collections:"Collages",items:"Elements",following:"Liked Topics",likes:"Likes",topics:"Topics",my_stats:"My Stats"}[this.tab];$("#page-title").text("Collagio Profile "+p+" - "+(this.collection.frontMatter.get("owner").first_name)+" "+(this.collection.frontMatter.get("owner").last_name));document.title=""+($("#page-title").text());if($("#profile-header").length){$("#profile-header").remove()}this.frontMatterView=new global.myd.CollageHeaderView({container:this.$el,model:this.collection.frontMatter,collection:this.collection,currentUserModel:this.currentUser,type:"profile",collection_count_text:{topics:"Topic",items:"Item",collections:"Collection",likes:"Like"}[this.tab]});this.$el.append(this.frontMatterView.el);this.frontMatterView.bind("refresh",function(){return m.collection.fetch()});$(".page-header").removeClass("collection");this.$el.find("#profile-header").append(this.navigationView.el);this.navigationView.delegateEvents();l=this.collection.frontMatter.toJSON();j={collections:"Collage",items:"Element",topics:"Following Topic",likes:"Like"}[this.tab];myd.pluralizeIfNeeded(l,"screens_count",j);this.$el.find("h3.collage-count").text(""+l.screens_count+" "+l.screens_count_text);if(this.tab==="topics"){n=l.screens_count!==1?"Topics":"Topic";this.$el.find("h3.collage-count").text("Following "+l.screens_count+" "+n)}if(this.collection.length>0){h=this.collection.map(function(v,u){var t;t=m.tileViewCreator(v);t.model.set("showActions");t.render(m.streamView);return t.el})}if(this.collection.length<=0){this.template=$("#my_profile_empty_"+this.tab).html();h=Mustache.render(this.template,this.collection.frontMatter.toJSON())}this.$el.find(".collage-list").append(h);this.$el.addClass(this.tab);this.$el.find(".collage-list li").addClass("screen");if(this.tab==="topics"){this.$el.find(".screen").addClass("no-hover")}i=$(".collage-list .screen");for(k=0,q=i.length;k<q;k++){r=i[k];o=$(r).find(".asset .frame .image");o.attr("src",o.data("src-745"))}new mediaQuery({media:"screen and (max-width: 639px)",entry:function(){var w,v,t,y,x,u;$(".collage-list .screen").removeClass("subFeatured");$(".collage-list .screen").addClass("item no-hover");i=$(".collage-list .screen");u=[];for(w=0,v=i.length;w<v;w++){r=i[w];o=$(r).find(".asset .frame .image");if($(r).hasClass("featured")&&((t=o.data("src-745"))!=null?t.length:void 0)){o.attr("src",o.data("src-745"))}if($(r).hasClass("subFeatured")&&((y=o.data("src-300"))!=null?y.length:void 0)){o.attr("src",o.data("src-300"))}if($(r).hasClass("item")&&((x=o.data("src-300"))!=null?x.length:void 0)){u.push(o.attr("src",o.data("src-300")))}else{u.push(void 0)}}return u},exit:function(){}});new mediaQuery({media:"screen and (min-width: 640px) and (max-width: 867px)",entry:function(){var w,v,t,y,x,u;$(".collage-list .screen").removeClass("subFeatured");$(".collage-list .screen").addClass("item no-hover");i=$(".collage-list .screen");u=[];for(w=0,v=i.length;w<v;w++){r=i[w];o=$(r).find(".asset .frame .image");if($(r).hasClass("featured")&&((t=o.data("src-745"))!=null?t.length:void 0)){o.attr("src",o.data("src-745"))}if($(r).hasClass("subFeatured")&&((y=o.data("src-300"))!=null?y.length:void 0)){o.attr("src",o.data("src-300"))}if($(r).hasClass("item")&&((x=o.data("src-300"))!=null?x.length:void 0)){u.push(o.attr("src",o.data("src-300")))}else{u.push(void 0)}}return u},exit:function(){}});new mediaQuery({media:"screen and (min-width: 868px)",entry:function(){var w,v,t,y,x,u;$(".collage-list .screen").addClass("subFeatured");$(".collage-list .screen").removeClass("item");i=$(".collage-list .screen");u=[];for(w=0,v=i.length;w<v;w++){r=i[w];o=$(r).find(".asset .frame .image");if($(r).hasClass("featured")&&((t=o.data("src-745"))!=null?t.length:void 0)){o.attr("src",o.data("src-745"))}if($(r).hasClass("subFeatured")&&((y=o.data("src-300"))!=null?y.length:void 0)){o.attr("src",o.data("src-300"))}if($(r).hasClass("item")&&((x=o.data("src-300"))!=null?x.length:void 0)){u.push(o.attr("src",o.data("src-300")))}else{u.push(void 0)}}return u},exit:function(){}});this.$el.show();this.trigger("rendered",this);new global.myd.ImageCenter($(".asset"));this.refreshFollowingUser();return this.refreshFollowingUser()};f.prototype.display=function(h){h.userPath="/"+h.userPath;this.tab=h.tab;this.navigationView=new myd.ProfileNavigationView(h);return this.navigationView.bind("fetchProfileTabCollection",this.fetchCollection,this)};f.prototype.fetchCollection=function(h){if(h.user){this.currentUser=h.user}if(this.tab==="my_stats"){return this.initMyStatsView()}else{if(this.tab==="topics"){this.initFollowingView();return this.collection.fetchByUrl(h.url)}else{return this.collection.fetchByUrl(h.url)}}};f.prototype.selectedAsset=function(h){myd.common.selectedScreen(h);return false};f.prototype.initMyStatsView=function(h){var i;i={};i.container=this.$el.find(".profile-content");i.user=this.currentUser;i.navigationView=this.navigationView;this.collageFilterView=new myd.ProfileMyStatsCollageFilterView(i);this.elementFilterView=new myd.ProfileMyStatsElementFilterView(i);return this.refreshFollowingUser()};f.prototype.initFollowingView=function(h){var i;i={};i.container=this.$el.find(".profile-content");i.user=this.currentUser;i.navigationView=this.navigationView;this.collageFollowingView=new myd.ProfileFollowingView(i);return this.refreshFollowingUser()};f.prototype.refreshFollowingUser=function(){var k,j,i,h;j=$(".follow-user");k=myd.urls.current_user;i=k.substring(k.lastIndexOf("/")+1,k.length);if(window.location.pathname.indexOf(i)>0){return j.hide()}else{if(((h=this.collection.collection)!=null?h.owner.collected:void 0)===true||this.currentUser.get("collected")){j.find(".text").html("FOLLOWING USER");return j.addClass("followed-user-btn").removeClass("following-user-btn")}else{j.find(".text").html("FOLLOW USER");return j.removeClass("followed-user-btn").addClass("following-user-btn")}}};return f})(a);global.myd.ProifleBaseView=a;global.myd.ProfileView=d}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.id="recommended-collages";f.prototype.collection=myd.GridCollection;f.prototype.bindToCollection={reset:"render"};f.prototype.initialize=function(g){this.containerEl=g.container;this.collection=new myd.GridCollection();this.topic=g.topic||"All Topics";this.screenViews=[];this.currentCollectionUID=g.currentCollectionUID;return this.collection.fetchByUrl(""+myd.urls.spotlight+"?topic="+this.topic)};f.prototype.render=function(){var h,g,j,i=this;this.containerEl.append(Mustache.render($("#recommended_collages_template").html()));this.setElement($("#recommended-collages"));this.list=this.$el.find(".collage-list");h=(function(){var n,m,k,l;k=this.collection.models;l=[];for(n=0,m=k.length;n<m;n++){g=k[n];if(g.get("item").id!==this.currentCollectionUID){l.push(g)}}return l}).call(this);j=h.splice(0,9);_.each(j,function(k){k=new myd.ScreenView({model:k,container:i.list,context:"recommendedcollages"});k.bind("selected",i.selectedScreen,i);k.render();return i.list.append(k.el)});this.$el.find("li").addClass("screen");this.checkScreenSize();return new global.myd.ImageCenter(this.$el.find(".asset"))};f.prototype.checkScreenSize=function(){new mediaQuery({media:"screen and (max-width: 639px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured subFeatured item");$(".collage-list .screen").addClass("subFeatured");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 640px) and (max-width: 867px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured subFeatured");$(".collage-list .screen").addClass("item");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 868px) and (max-width: 949px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured subFeatured");$(".collage-list .screen").addClass("item");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});new mediaQuery({media:"screen and (min-width: 950px) and (max-width: 1099px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured subFeatured");$(".collage-list .screen").addClass("item");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}});return new mediaQuery({media:"screen and (min-width: 1100px)",entry:function(){var l,i,k,j,h,g;$(".collage-list .screen").removeClass("featured  item");$(".collage-list .screen").addClass("subFeatured");k=$(".collage-list .screen");g=[];for(j=0,h=k.length;j<h;j++){i=k[j];l=$(i).find(".asset .frame .image");g.push(l.attr("src",l.data("src-745")))}return g},exit:function(){}})};f.prototype.selectedScreen=function(g){return myd.common.selectedScreen(g)};f.prototype.onClose=function(){return _.each(this.screenViews,function(g){g.unbind("selected",this.selectedScreen,this);return g.close()})};return f})(Backbone.View);global.myd.RecommendedCollagesView=d}).call(this);(function(){var b,d,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}b=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.collection=myd.GridCollection;e.prototype.id="reorder";e.prototype.events={"click .cancel-reorder-btn":"clickedCancel","click .done-reorder-btn":"clickedDone"};e.prototype.initialize=function(g){this.render();return this};e.prototype.render=function(){var g=this;this.overlay=new myd.OverlayView;$("#overlay").append(this.$el.append(Mustache.render($("#reorder_collection_template").html())));this.dragText=this.$el.find(".drag-text");this.list=this.$el.find("#reorder-list");_.each(this.collection.models,function(h){return g.list.append("<li data-id='"+(h.get("uid"))+"'>"+(myd.renderScreen(h.toJSON(),"reorder"))+"</li>")});this.list.sortable({placeholder:"ui-state-highlight",cursor:"all-scroll",start:function(){return g.dragText.css("visibility","hidden")},stop:function(){return g.dragText.css("visibility","visible")}});this.list.disableSelection();return $("body").addClass("noscroll")};e.prototype.clickedCancel=function(){this.close();return false};e.prototype.clickedDone=function(){var g,h=this;g=[];_.each(this.list.find(" > li"),function(k,i){var j;j=h.collection.get($(k).data("id"));return j.set("index",i,{silent:true})});this.collection.sort();this.collection.trigger("reordered");this.close();return false};e.prototype.onClose=function(){$("body").removeClass("noscroll");return this.overlay.close()};return e})(Backbone.View);global.myd.ReorderCollectionView=b}).call(this);(function(){var b,d,e,a={}.hasOwnProperty,c=function(i,g){for(var f in g){if(a.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i};if((e=global.myd)==null){global.myd={}}d=global.myd.renderVideoEmbed;b=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.model=myd.ScreenModel;f.prototype.events={"click .cancel-btn":"close","click .reuse-btn":"clickedReuseItem","click .screen-item":"clickFail","click .selected-collage":"clickedDropdown","click .options li":"clickedDropdownItem"};f.prototype.initialize=function(h){this.selectedCollectionUrl=null;this.getUserCollections();return this.render()};f.prototype.render=function(){var j,i,l,m,k,h,n=this;k=$("#reuse_item_template").html();if(k===null){return false}$("div#content").append("<div id='reuse'>");this.setElement($("#reuse"));this.overlayView=new myd.OverlayView();j=this.model.get("caption");l=this.model.collection.frontMatter!=null?this.model.collection.frontMatter.get("owner"):this.model.frontMatter.get("owner");if(this.model.models!=null){i=new myd.ScreenModel(this.model.frontMatter.toJSON());m=[];_.each(this.model.models,function(p){var r,q,o;if(p.get("item").get("uid")!==((o=n.model.frontMatter.get("cover_asset"))!=null?o.uid:void 0)){r=p.get("item");q=p.toJSON();q.item=r.toJSON();return m.push(q)}});h=i.toJSON();h.item.set("type","collection");h.item.set("cover_asset",this.model.frontMatter.get("cover_asset"));h.item.set("screens",m);h.item.set("screens_count",this.model.frontMatter.get("screens_count"));h.item.set("created_timestamp",this.model.frontMatter.get("created_timestamp"));this.$el.html(Mustache.render(k,h));this.$el.find(".screen").html(myd.renderScreen(h,"reuse"));myd.renderAssetFragment(i,this.context,this.$el);this.$el.find(".screen-item").addClass("wide");$("#reuse-asset-caption").remove();$(".reuse-item-form-wrapper").height("440px")}else{if(typeof this.model.get("item").get("screens")==="undefined"){h=this.model.toJSON();if((j!=null)&&j.length>0){h.quotedCaption=""+l.first_name+" "+l.last_name+": "+j}h.owner=null;delete h.caption;h.item.screens_count=null;h.item.collected_count=null;this.$el.html(Mustache.render(k,h));this.$el.find(".screen").html(myd.renderScreen(h,"reuse"))}else{h=this.model.toJSON();if((j!=null)&&j.length>0){h.quotedCaption=""+l.first_name+" "+l.last_name+": "+j}h.caption=null;this.$el.html(Mustache.render(k,this.model));this.$el.find(".screen").html(myd.renderScreen(h,"reuse"));myd.renderAssetFragment(this.model,this.context,this.$el);this.$el.find(".screen-item").addClass("wide")}}if(typeof this.$el.find(".asset .image").attr("src")==="undefined"){this.$el.find(".asset .image").attr("src",this.$el.find(".asset .image").data("src-745"))}if($.browser.msie){global.myd.Placeholder().refresh(this.$el)}if(this.model.get("item")!=null){if(this.model.get("item").get("type")==="feed"){this.assetRSSView=new global.myd.AssetRSSView({model:this.model.get("item"),container:this.$el.find(".screen"),removeEvents:true})}else{if(this.model.get("item").get("type")==="video"&&(this.model.get("item").get("youtube_id")!=null)){d(this.model,this.$el)}}if(this.model.get("item").get("type")==="feed"||this.model.get("item").get("type")==="collection"||this.model.get("item").get("type")==="fact"){$("#reuse-asset-caption").remove();$(".reuse-item-form-wrapper").height("440px")}}this.dropdown=this.$el.find(".dropdown-container .options");return new global.myd.ImageCenter(this.$el.find(".asset"))};f.prototype.clickFail=function(){return false};f.prototype.clickedReuseItem=function(){var i,h,j=this;h=this.selectedCollectionUrl;if(!(h!=null)){this.$el.find("#collection-error-message").text("Please select a collage").show();return false}i={};i.entity_url=this.model.get("item")!=null?this.model.get("item").get("entity_url"):this.model.collection.entity_url;i.caption=this.$el.find("#reuse-asset-caption").val();return myd.serviceModule.post({url:h,data:[i],success:function(k){return j.close()},error:function(k){j.$el.find("#collection-error-message").text(k.responseText).show();return j.trigger("errorReset")}})};f.prototype.getUserCollections=function(){var h=this;return myd.serviceModule.get({url:myd.urls.my_collection_list,success:function(i){return _.each(i,function(k){var j;k.title=k.title.length>50?k.title.substr(0,49)+" ...":k.title;j=$("<li>").data({value:k.uid}).text(k.title);jQuery.data(j[0],"edit_items_url",k.edit_items_url);return h.dropdown.append(j)})},error:function(i){return h.trigger("errorReset")}})};f.prototype.clickedDropdown=function(){this.$el.find("#collection-error-message").hide();this.$el.find(".dropdown-container").toggleClass("open");return this.$el.find(".options").toggle("blind",150)};f.prototype.clickedDropdownItem=function(h){var i;i=$(h.target);this.selectedCollectionUrl=i.data("edit_items_url");this.$el.find(".selected-collage").text(i.text());this.$el.find(".reuse-btn").removeClass("inactive");return this.clickedDropdown()};f.prototype.onClose=function(){var h,i;if((h=this.assetRSSView)!=null){h.close()}return(i=this.overlayView)!=null?i.close():void 0};return f})(Backbone.View);global.myd.ReuseItemView=b}).call(this);(function(){var a,e,d,f,b={}.hasOwnProperty,c=function(j,h){for(var g in h){if(b.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};if((f=global.myd)==null){global.myd={}}e=global.myd.renderAsset;d=myd.serviceModule;a=(function(h){c(g,h);function g(){return g.__super__.constructor.apply(this,arguments)}g.prototype.model=myd.CommentModel;g.prototype.tagName="li";g.prototype.events={"click .delete-comment":"clickDeleteComment","click .author, .author-name":"clickedAuthor","click .view-more":"clickedViewMore"};g.prototype.initialize=function(i){if(i==null){i={container:[],prepend:false}}this.containerEl=i.container;return this.render(i)};g.prototype.render=function(k){var j,i;i=this.model.toJSON();i.user_url="/papyrus/"+new global.myd.Uri(this.model.get("author").entity_url).getPathname();j=Mustache.render($("#screen_comment_template").html(),i);if(k.prepend){this.containerEl.prepend(j);this.setElement($("li:first-child",this.containerEl))}else{this.containerEl.append(j);this.setElement($("li:last-child",this.containerEl))}return this.$el.find("date").relativeTime()};g.prototype.clickDeleteComment=function(){this.model.set("deleted",true);return false};g.prototype.clickedAuthor=function(){var i;i=this.model.get("author").entity_url;Router.navigateToProfileTab({userPath:new global.myd.Uri(i).getPathname(),tab:"collections"});return false};g.prototype.clickedViewMore=function(){this.$el.find(".comment-text .comment").text(this.model.get("text"));this.$el.find(".comment-text").css("height","auto");this.$el.find(".view-more").remove();return false};return g})(Backbone.View);global.myd.ScreenCommentView=a}).call(this);(function(){var f,d,c,e,a={}.hasOwnProperty,b=function(j,h){for(var g in h){if(a.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};if((e=global.myd)==null){global.myd={}}d=global.myd.renderAsset;c=myd.serviceModule;f=(function(g){b(h,g);function h(){return h.__super__.constructor.apply(this,arguments)}h.prototype.collection=myd.CommentsCollection;h.prototype.page=0;h.prototype.events={"click .comments-count":"clickedViewMore"};h.prototype.bindToCollection={add:"addCommentUI",remove:"removeCommentUI",reset:"reset","change:deleted":"deleteComment"};h.prototype.initialize=function(i){this.containerEl=i.container;this.item=i.item;this.render();this.commentViews=[];return this.commentsCount=this.item.get("comment_count")};h.prototype.render=function(){if($(".screen-comments",this.containerEl).length===0){this.containerEl.prepend("<div class='screen-comments'><div class='section-title'>Comments</div><ol>");this.setElement($(".screen-comments",this.containerEl));this.commentsOL=this.$el.find("ol");if(this.item.get("comment_count")>20){this.$el.find(".section-title").hide();return this.$el.prepend("<a href='#' class='comments-count'>View all <span class='count'>"+this.commentsCount+"</span> comments <b class='notch'></b></a>")}}};h.prototype.reset=function(){return this.renderList({prepend:this.page>0})};h.prototype.removeCommentUI=function(k,l,i){var j;j=this.commentViews[i.index];if(j!=null){j.close();this.commentViews.splice(i.index,1);this.commentsCount--;return this.setCommentsCount()}};h.prototype.renderList=function(i){var j=this;if(i==null){i={prepend:false}}_.each(this.collection.models,function(l){var k;k=new myd.ScreenCommentView({model:l,container:j.commentsOL});return j.commentViews.push(k)});this.setCommentsCount();this.trigger("rendered");this.$el.animate({scrollTop:this.$el.height()+200},1000);if(this.item.get("showComments")){$("body. html").animate({scrollTop:this.$el.offset().top},1000);this.item.set("showComments",false)}return this};h.prototype.setCommentsCount=function(){var i;i=myd.pluralizeIfNeededText(this.commentsCount,"Comment");this.$el.find(".section-title").html(""+this.commentsCount+" "+i);return this.$el.find(".count").html(""+this.commentsCount)};h.prototype.deleteComment=function(i){return this.collection["delete"](i)};h.prototype.addCommentUI=function(j,l,i){var k;k=new myd.ScreenCommentView({model:j,container:this.commentsOL,prepend:this.page>0});this.commentViews.splice(i.index,0,k);this.commentsCount++;return this.setCommentsCount()};h.prototype.clickedViewMore=function(){this.page++;this.collection.fetch(this.page);this.$el.find(".comments-count").remove();this.$el.find(".title").show();return false};h.prototype.onClose=function(){return _.each(this.commentViews,function(i){i.unbind("deleted",this.deleteComment,this);return i.close()})};return h})(Backbone.View);global.myd.ScreenCommentsListView=f}).call(this);(function(){var b,d,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}b=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.className="screen-nav";e.prototype.model=myd.ScreenModel;e.prototype.events={"click a":"scrollClick"};e.prototype.bindToModel={"change:index":"reset"};e.prototype.initialize=function(){return this};e.prototype.reset=function(){var h,g;h=this.$el.parent();this.$el.remove();g=this.model.toJSON();h.append(Mustache.render($("#screen_nav_template").html(),g));return this.setElement($(".screen-nav",h))};e.prototype.scrollClick=function(i){var h,g,j;g=i.target;if(g.tagName.toLowerCase()!=="a"){g=$(g).closest("a")}j=$(g).attr("href").substring(1);h=$("a[name='"+j+"']");if(h.length||j==="top"){$("body, html").animate({scrollTop:j!=="top"?h.offset().top-100:0},500,"easeOutCirc")}return false};return e})(Backbone.View);global.myd.ScreenNavView=b}).call(this);(function(){var e,c,d,a={}.hasOwnProperty,b=function(i,g){for(var f in g){if(a.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i};if((d=global.myd)==null){global.myd={}}c=global.myd.renderVideoEmbed;e=(function(f){b(g,f);function g(){return g.__super__.constructor.apply(this,arguments)}g.prototype.model=myd.ScreenModel;g.prototype.events={"click .asset-wrapper, .screen-app-link, .svg_play":"selected","click .screen-reuse":"clickedReuse","click .screen-fb-share":"clickedFBShare","click .more-info":"clickedMoreInfo","click .origin_source_url":"clickedSource","click .screen-delete":"clickedDelete"};g.prototype.initialize=function(h){var i=this;this.context=h.context;this.renderInline=h.inline;this.showComments=this.context==="collections";this.tab=h.tab;this.searchItem=h.searchItem;this.isEditing=h.isEditing||false;this.model.get("item").bind("change:metaData",this.toggleMetaDataView,this);this.bind("finishEdit",function(){var j;return(j=i.addBarView)!=null?j.trigger("finishEdit"):void 0});this.bind("cancelEdit",function(){var j;return(j=i.addBarView)!=null?j.trigger("cancelEdit"):void 0});return this};g.prototype.render=function(){var j,h,i=this;j="";if(this.renderInline){j=$("<section></section>")}else{j=$("<li></li>")}this.setElement(j);h=this.getScreenOptions();if(this.model.get("item").get("screens")!=null){this.$el.html(myd.renderScreen(this.model.toJSON(),this.context,h,this.tab));myd.renderAssetFragment(this.model,this.context,this.$el);if(this.renderinline){this.$el.addClass("screen")}}else{this.$el.html(myd.renderScreen(this.model.toJSON(),this.context,h,this.tab))}if(h.showScreenNavigation){this.screenNavView=new myd.ScreenNavView({model:this.model,el:this.$el.find(".screen-nav")})}if(this.renderInline&&this.model.get("editable")){this.addBarView=new myd.AddBarView({model:this.model,index:this.model.get("index")});this.addBarView.bind("addNewItem",function(k){return i.trigger("addNewItem",k)});this.addBarView.bind("addItem",function(k){return i.trigger("addItem",k)});this.$el.append(this.addBarView.render())}if(this.model.get("item").get("type")==="feed"){this.assetRSSView=new global.myd.AssetRSSView({model:this.model.get("item"),container:this.$el,removeEvents:this.context!=="collections"})}else{if(this.model.get("item").get("type")==="collection"){this.collectionAuthorView=new global.myd.CollectionAuthorView({model:this.model,el:this.$el.find(".collection_tile_meta")})}}this.likeButtonView=new myd.LikeButtonView({model:this.model,el:this.$el.find(".like-container")});this.likeContainer=this.$el.find(".like-container");this.caption=this.$el.find(".caption-text");this.headline=this.$el.find("h2").first();this.factText=this.$el.find(".screen-text");this.deleteIcon=this.$el.find(".screen-delete");this.reuseIcon=this.$el.find(".screen-reuse");this.shareIcon=this.$el.find(".screen-fb-share");if(this.context==="profile"&&(this.tab==="collections"||this.tab==="items")&&this.model.get("editable")&&myd.feature.deletecollections){this.deleteIcon.css("display","")}if(this.showComments){this.$el.find(".screen-item").append("<aside class='comments'>");this.commenteAside=this.$el.find("aside.comments");this.commentsCollection=new myd.CommentsCollection({comments_url:this.model.get("comments_url")});this.screenCommentsListView=new myd.ScreenCommentsListView({container:this.$el.find("aside.comments"),item:this.model,collection:this.commentsCollection});this.screenCommentsListView.bind("rendered",function(){if(this.editMode){$(this.leaveCommentView.el).hide();return $(this.screenCommentsListView.el).hide()}},this);this.leaveCommentView=new myd.LeaveCommentView({container:this.$el.find("aside.comments"),item:this.model,collection:this.commentsCollection})}if(this.isEditing){this.startEditing()}this.$el.find(".asset img").on("load",function(){return i.$el.find(".image-wrapper").css({opacity:1})});return this.initCaptionFields()};g.prototype.initCaptionFields=function(){var i,h,k,j,l,m;i=300;h=35;l=this.caption.val();j=l!=null?l.match(new RegExp("\n\r?","g")):void 0;k=18;m=0;if((j!=null?j.length:void 0)!=null){m=(j.length+1)*k;if(m>i){m=i}}else{m=h}this.caption.height(m+"px");if(this.isEditing){return this.enableCaptionField(true)}else{return this.enableCaptionField(false)}};g.prototype.enableCaptionField=function(h){if(!h){this.$el.find(".caption-wrapper").removeClass("active");return this.caption.attr("disabled","disabled")}else{this.$el.find(".caption-wrapper").addClass("active");return this.caption.removeAttr("disabled")}};g.prototype.getScreenOptions=function(){var h;h={};if(this.context==="profile"){h.showActions=true;h.showLikeButton=true;h.showReuseButton=true;if(this.tab==="collections"||this.tab==="items"){h.showDeleteButton=true}}else{if(this.context==="newstream"||this.context==="explorepopular"||this.context==="topic"){h.showLikeButton=true;h.showReuseButton=true;h.showActions=true}else{if(this.context==="collections"){h.showActions=true;h.showReuseButton=true;h.showLikeButton=true;h.showFacebookShareButton=true;h.showDeleteButton=true;h.showScreenNavigation=true}}}return h};g.prototype.selected=function(i){var h;h=$(i.target);if((this.model.get("item").get("type")==="fact"&&this.isEditing)||(this.model.get("item").get("type")==="fact"&&!h.is("a")&&!this.isEditing)){return false}if(h.hasClass("caption-text")){return false}if(this.context==="collections"&&this.model.get("item").get("type")==="fact"&&h.is("a")){this.sourceWindow=window.open(h.attr("href"));return false}else{if((h.hasClass("caption")||h.hasClass("caption-text"))&&this.isEditing){return false}}if(this.context==="collections"&&this.model.get("item").get("type")!=="collection"&&this.model.get("item").get("type")!=="video"&&this.model.get("item").get("type")!=="fact"&&!this.isEditing){this.clickedSource()}else{if(this.context==="collections"&&this.model.get("item").get("type")==="video"&&(h.is("svg")||h.is("img"))&&!this.isEditing){this.clickedPlayVideo()}else{if(!this.isEditing){this.trigger("selected",this.model)}}}return false};g.prototype.toggleMetaDataView=function(){return this.metaDataView=new global.myd.AssetMetaDataView({model:this.model.get("item"),container:this.$el.find(".below-asset")})};g.prototype.clickedMoreInfo=function(h){var j,i;i=$(h.currentTarget);if(typeof this.metaDataView==="undefined"||this.metaDataView===null){this.model.get("item").fetchMetaData()}else{j=this.metaDataView.toggle()}return false};g.prototype.clickedReuse=function(){this.reuseItemView=new myd.ReuseItemView({model:this.model});return false};g.prototype.clickedPlayVideo=function(){c(this.model,this.$el,600);return false};g.prototype.clickedFBShare=function(){var j,i,m,l,o,n,h,k;l=this.model.collection.frontMatter.get("title")||(""+(this.model.collection.frontMatter.get("owner").first_name)+" "+(this.model.collection.frontMatter.get("owner").last_name));h=myd.capFirstLetter(this.model.get("item").get("type"));if(this.model.get("item").get("type")==="feed"){h=""+(this.model.get("item").get("title"))+" Feed"}else{if(this.model.get("item").get("type")==="fact"){h="Text"}else{if(this.model.get("item").get("type")==="collection"){h=""+(this.model.get("item").get("title"))+" Collage"}}}n=""+h+" from "+l;o=this.model.get("item").get("asset_url")||this.model.get("item").get("cover_asset").thumbnail_url;if(this.model.get("item").get("type")==="video"&&(this.model.get("item").get("youtube_id")!=null)){o=myd.getVideoUrl(this.model.get("item").get("youtube_id"))}m=this.model.get("item").get("description")||this.$el.find(".screen-text").text().trim()||null;j=this.model.get("caption")||null;i=this.model.collection.frontMatter.get("uid");k="http://"+document.domain+"/papyrus/c/api/collections/"+i+"/screens/"+(this.model.get("uid"));if(this.model.get("item").get("type")==="fact"||this.model.get("item").get("type")==="feed"){o=this.model.collection.frontMatter.get("cover_asset")!=null?this.model.collection.frontMatter.get("cover_asset").thumbnail_url:"http://www.collagio.com/images/default_new_collection.png"}if(typeof FB!=="undefined"&&FB!==null){FB.ui({method:"feed",message:"",name:n,caption:j,description:m,link:k,picture:o,display:"popup",actions:[{name:"Check Out Collagio",link:"http://www.collagio.com/"}],user_message_prompt:"Share your thoughts about Collagio"},function(p){if(p&&p.post_id){}else{}})}return false};g.prototype.clickedSource=function(){var h;h=this.model.get("item").get("source_page_url")!=null?this.model.get("item").get("source_page_url"):this.model.get("item").get("asset_url");if((h!=null?h.indexOf("http://"):void 0)===0||(h!=null?h.indexOf("https://"):void 0)===0){this.sourceWindow=window.open(h)}return false};g.prototype.clickedDelete=function(){var h=this;if(this.context==="collections"){this.trigger("delete",this.model);this.$el.hide("blind",1000,function(){return h.close()})}else{if(this.context==="profile"){if(confirm("Are you sure you want to delete this? There is no undo.")){this.model.trigger("deleteScreen",this.model)}}}return false};g.prototype.fetchComments=function(){if((this.commentsCollection!=null)&&!this.commentsCollection.fetched){return this.commentsCollection.fetch()}};g.prototype.activateScreen=function(){this.commenteAside.css("opacity",1);if((this.commentsCollection!=null)&&!this.commentsCollection.fetched){return this.commentsCollection.fetch()}};g.prototype.deactivateScreen=function(){return this.commenteAside.css("opacity",0.2)};g.prototype.startEditing=function(){var i,j,h,k=this;this.isEditing=true;this.deleteIcon.show();this.reuseIcon.hide();this.shareIcon.hide();this.likeContainer.hide();if((this.model.get("item").get("type")==="image"||this.model.get("item").get("type")==="video")&&(this.model.get("caption")!=null)&&this.model.get("caption").length===0){this.$el.find(".caption").html("<div class='caption-wrapper'><textarea class='caption-text' placeholder='Enter a caption'></textarea></div>");this.caption=this.$el.find(".caption-text")}if(this.model.get("item").get("type")==="fact"){j=this.$el.find(".fact-wrapper");if(!j.find("h2").length){j.prepend("<h2 placeholder='Enter Headline'>"+(this.model.get("item").get("title"))+"</h2>")}this.headline=this.$el.find("h2").first();this.headline.attr("contenteditable",true);j=this.$el.find(".fact-wrapper");if(!this.factText.length){j.append("<div class='screen-text'>"+(this.model.get("item").get("text"))+"</div>");this.factText=j.find("screen-text")}h=markdown.toHTML(this.model.get("item").get("text")||"");this.factText.html("<textarea rows='4' cols='50' class='text-editor' id='fact-"+(this.model.get("item").get("uid"))+"'>"+h+"</textarea>");i=tinyMCE.get("fact-"+(this.model.get("item").get("uid")));window.setTimeout(function(){if(typeof i==="undefined"){return myd.renderTextEditor("fact-"+(k.model.get("item").get("uid")))}else{return i.render()}},500)}this.enableCaptionField(true);return this.caption.keyup(function(m){var l;if($(this).outerHeight()<466){l=[];while($(this).outerHeight()<this.scrollHeight+parseFloat($(this).css("borderTopWidth"))+parseFloat($(this).css("borderBottomWidth"))){l.push($(this).height($(this).height()+1))}return l}})};g.prototype.stopEditing=function(){var k,j,h;this.deleteIcon.hide();this.reuseIcon.show();this.shareIcon.show();this.likeContainer.show();this.headline.attr("contenteditable",false);k=this.caption.val();if(((k!=null?k.length:void 0)!=null)===0){this.caption.remove()}this.enableCaptionField(false);this.saveModelChanges();if(this.factText.length&&this.model.get("item").get("type")==="fact"){this.factText.attr("contenteditable",false);this.factText.html(markdown.toHTML(this.model.get("item").get("text")))}try{if((h=tinyMCE.get("fact-"+(this.model.get("item").get("uid"))))!=null){h.remove()}}catch(i){j=i}return this.isEditing=false};g.prototype.saveModelChanges=function(){var i,h,j;if((this.model.get("item").get("type")==="image"||this.model.get("item").get("type")==="video")&&this.model.get("caption")!==this.caption.val()){this.model.set("caption",this.caption.val(),{silent:true})}if(this.model.get("item").get("type")==="fact"){if(this.model.get("item").get("title")!==this.headline.text().trim()){this.model.get("item").set("title",this.headline.text().trim(),{silent:true})}h=tinyMCE.get("fact-"+(this.model.get("item").get("uid")));if(h!=null){i=$("<div>").html(h.getContent())[0];j=markdown.serialize(i);if(this.model.get("item").get("text")!==j){return this.model.get("item").set("text",j,{silent:true})}}}};g.prototype.onClose=function(){var r,o,n,m,l,k,j,i,h,p=this;try{if((o=tinyMCE.get("fact-"+(this.model.get("item").get("uid"))))!=null){o.remove()}}catch(q){r=q}this.model.get("item").unbind("change:metaData",this.toggleMetaDataView,this);this.unbind("finishEdit",function(){var t;return(t=p.addBarView)!=null?t.trigger("finishEdit"):void 0});this.unbind("cancelEdit",function(){var t;return(t=p.addBarView)!=null?t.trigger("cancelEdit"):void 0});if(this.addBarView!=null){this.addBarView.unbind("addNewItem",function(t){return p.trigger("addNewItem",t)});this.addBarView.unbind("addItem",function(t){return p.trigger("addItem",t)});this.addBarView.close()}if((n=this.assetRSSView)!=null){n.close()}if((m=this.reuseItemView)!=null){m.close()}if((l=this.metaDataView)!=null){l.close()}if((k=this.likeButtonView)!=null){k.close()}if((j=this.leaveCommentView)!=null){j.close()}if((i=this.screenCommentsListView)!=null){i.close()}return(h=this.screenNavView)!=null?h.close():void 0};return g})(Backbone.View);global.myd.ScreenView=e}).call(this);(function(){var a,d,e,b={}.hasOwnProperty,c=function(i,g){for(var f in g){if(b.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i};if((e=global.myd)==null){global.myd={}}a=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.collection=myd.GridCollection;f.prototype.showFrontMatter=true;f.prototype.bindToCollection={errorReset:"renderError",reset:"reset"};f.prototype.initialize=function(h){this.context=h.context;this.inline=h.inline;this.clearHistory=h.clearHistory||false;this.filter=h.filter;this.appView=h.appView;this.screenViews=[];this.tileViewCreator=h.tileViewCreator||function(k){var i,j;j=k.get("entity_url");i=new myd.ScreenView({model:k,context:h.context,inline:h.inline,tab:h.tab});i.bind("selected",this.selectedAsset,this);this.screenViews.push(i);return i};this.collection=h.collection;return this.collection.filter=this.filter};f.prototype.reset=function(h){var i=this;this.$el.find("ol").empty();if(this.showFrontMatter&&this.frontMatterView!==null){this.frontMatterView.unbind("refresh",function(){return i.collection.fetch()});this.frontMatterView.close()}return this.render()};f.prototype.render=function(){var h=this;if(this.showFrontMatter){this.frontMatterView=new global.myd.CollageHeaderView({container:this.$el,model:this.collection.frontMatter,collection:this.collection,isEditing:false,type:{explorepopular:"popular",profile:"profile","new":"new_stream",collections:"collection"}[this.context]});this.frontMatterView.bind("refresh",function(){return h.collection.fetch()});this.frontMatterView.bind("editBackground",this.launchEditBackground,this)}$(".page-header").removeClass("collection");this.renderCollectionTiles();if(this.collection.frontMatter.get("cover_asset")!=null){this.trigger("rendered",{clearHistory:this.clearHistory,thumbnail:this.collection.frontMatter.get("cover_asset").thumbnail_url})}else{this.trigger("rendered",{clearHistory:this.clearHistory})}return this.$el.show()};f.prototype.renderCollectionTiles=function(){var h,i=this;h=this.collection.map(function(k){var j;j=i.tileViewCreator(k);j.render(i.streamView);return j.el});if(this.$el.find("article").length){return this.$el.find("article").html(h)}else{return this.$el.find("ol").html(h)}};f.prototype.display=function(){this.$el.show();return this.collection.fetch()};f.prototype.selectedAsset=function(h){return myd.common.selectedScreen(h)};f.prototype.renderError=function(){return this.$el.html("There was an error processing your request.")};f.prototype.onClose=function(){var h=this;_.each(this.screenViews,function(i){i.unbind("selected",this.selectedAsset,this);i.unbind("addItem",this.callAddItem,this);i.unbind("addNewItem",this.callAddNewItem,this);i.unbind("delete",this.deleteScreen,this);return i.close()});if(this.reuseItemView!=null){this.reuseItemView.close()}if(this.frontMatterView!=null){this.frontMatterView.unbind("refresh",function(){return h.collection.fetch()});this.frontMatterView.unbind("editBackground",this.launchEditBackground,this);this.frontMatterView.close()}if(this.itemLightboxView!=null){return this.itemLightboxView.close()}};return f})(Backbone.View);d=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.el="#search";f.prototype.searchViews=[];f.prototype.initialize=function(h){$("#content").html('<div id="search" class="body"><div class="searchResults"></div></div>');this.setElement($("#search"));this.context=h.context="search";this.inline=h.inline=false;this.searchTerm=h.searchTerm||"";this.exploreNavigationView=new global.myd.ExploreNavigationView({context:this.context,container:this.$el,model:this.collection.frontMatter,collection:this.collection,searchTerm:this.searchTerm});this.exploreNavigationView.searchInput.bind("keyup",_.debounce($.proxy(this.doSearch,this),250));this.exploreNavigationView.searchInput.focus();return f.__super__.initialize.call(this,h)};f.prototype.render=function(){$("#page-title").text("Search for '"+this.searchTerm);document.title=""+($("#page-title").text())+" - Collagio";$(".page-header").removeClass("collection");this.renderPeopleResults();return this.renderCollectionResults()};f.prototype.display=function(){if(this.searchTerm.length){return this.collection.fetchInternalSearchResults(this.searchTerm)}};f.prototype.reset=function(h){this.$el.find(".searchResults").empty();if(this.collection.models.length===0){this.$el.find(".searchResults").prepend("<div class='collectionResults'><h2 class='result-count'>No Items Found</h2>")}return this.render()};f.prototype.renderPeopleResults=function(){var k,l,j,i,h,m=this;l=_.filter(this.collection.models,function(n){return n.get("item").get("type")==="user"}).slice(0,6);if(!l.length){return}k=this.$el.find(".searchResults").append('<div class="peopleResults"><ol class="collage-list cf"></ol></div><div class="border"></div>');j=k.find(".peopleResults");i=j.find("ol");h=l.length===1?"Person":"People";j.prepend("<h2 class='result-count'>"+l.length+" "+h+"</h2>");return _.map(l,function(o){var n;n=new myd.ScreenView({model:o,context:m.context,inline:m.inline,searchItem:true});n.render();n.bind("selected",m.selectedAsset,m);m.searchViews.push(n);return i.append(n.$el)})};f.prototype.renderCollectionResults=function(j){var p,t,l,k,o,n,r,h,i,q,m=this;k=_.filter(this.collection.models,function(u){return u.get("item").get("type")==="collection"});if(!k.length){return}n=this.$el.find(".searchResults").append('<div class="collectionResults"><ol class="collage-list cf"></ol></div>');p=n.find(".collectionResults");t=p.find("ol");l=k.length===1?"Collage":"Collages";p.prepend("<h2 class='result-count'>"+k.length+" "+l+"</h2>");_.map(k,function(v){var u;u=new myd.ScreenView({model:v,context:m.context,inline:m.inline,searchItem:true});u.render();u.bind("selected",m.selectedAsset,m);m.searchViews.push(u);return t.append(u.$el.addClass("screen subFeatured"))});h=$(".collage-list .screen");for(i=0,q=h.length;i<q;i++){r=h[i];o=$(r).find(".asset .frame .image");o.attr("src",o.data("src-745"))}return new global.myd.ImageCenter($(".asset"))};f.prototype.doSearch=function(h){var i;i=$(h.target);this.searchTerm=i.val().trim();if(this.searchTerm.length){Router.navigate("search/"+this.searchTerm);return this.display()}};return f})(a);global.myd.SearchBaseView=a;global.myd.SearchView=d}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.model=myd.FrontMatterTileModel;f.prototype.id="topic-header";f.prototype.initialize=function(g){this.containerEl=g.container;this.collection=g.collection;this.model.bind("change:collected",this.refreshLike,this);return this.render()};f.prototype.render=function(){var g;g=Mustache.render($("#topic_header_template").html(),this.model.toJSON());this.containerEl.find(".explore-navigation-header").after(g);this.setElement($("#topic-header",this.containerEl));return this.likeButtonView=new myd.LikeButtonView({model:this.model,el:this.$el.find(".like-container")})};f.prototype.onClose=function(){return this.likeButtonView.close()};return f})(Backbone.View);global.myd.TopicHeaderView=d}).call(this);(function(){var d,c,a={}.hasOwnProperty,b=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((c=global.myd)==null){global.myd={}}d=(function(e){b(f,e);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.tagName="li";f.prototype.className="item";f.prototype.model=myd.ScreenModel;f.prototype.events={"click .collage":"clickedCollage"};f.prototype.initialize=function(g){this.containerEl=g.container;return this.render()};f.prototype.render=function(){var h,g;g=this.model.get("item").toJSON();h=$('<li class="item"/>').append(myd.renderScreen(g));this.containerEl.append(h);return this.setElement("#"+this.containerEl[0].id+" li:last-child")};f.prototype.clickedCollage=function(){var g,h;if(this.model.get("item").get("type")==="collection"){h=this.model.get("item").get("entity_url");g=myd.routesModule.getRoutesFromUrl(h);Router.navigate(g.getPapyrusPath(),{trigger:true})}return false};f.prototype.renderScreens=function(){var h,g,i=this;h=this.model.get("item").get("screens");if(h!=null){h=h.slice(0,6);this.$el.find(".record-screens").remove();this.$el.find(".collage").append("<ul class='record-screens'></ul>");g=this.$el.find(".record-screens").addClass("layout-"+h.length);return _.each(h,function(j){return g.append("<li>").find("li:last-child").append(myd.renderTurntableScreen(j))})}};return f})(Backbone.View);global.myd.TurntableCollageView=d}).call(this);(function(){var b,d,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};if((d=global.myd)==null){global.myd={}}b=(function(f){c(e,f);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.itemWidth=850;e.prototype.singleWidth=100;e.prototype.collection=myd.GridCollection;e.prototype.events={"click #records li":"clickedSingle","click #turntable li .advance":"clickedAdvance","click #records-wrapper .turntable-arrow-left":"clickPrevFilmstrip","click #records-wrapper .turntable-arrow-right":"clickNextFilmstrip"};e.prototype.bindToCollection={reset:"render"};e.prototype.initialize=function(g){this.containerEl=g.container;this.collection=new myd.GridCollection();this.topic=g.topic||"All Topics";this.collection.fetchByUrl(""+myd.urls.spotlight+"?topic="+this.topic);this.turntableViews=[];return this.filmstripPage=0};e.prototype.render=function(){var h,g,i,j,k=this;$("#explore-turntable").remove();g=this.collection.pluck("item");i=(function(){var n,m,l;l=[];for(n=0,m=g.length;n<m;n++){h=g[n];l.push(h.toJSON())}return l})();j=Mustache.render($("#turntable_explore_template").html(),{items:i});if(this.topic!=="All Topics"){$("#content header#topic-header").after(j)}else{$("#content header:first-child").after(j)}this.setElement($("#explore-turntable"));this.turntable=this.$el.find("ol#turntable");this.records=this.$el.find("ol#records");this.recordsContainer=this.$el.find("#records-wrapper");if(!this.$el.length){return}this.recordsCount=this.records.find("li").length;this.turntable.css("width",(this.collection.models.length+1)*(this.itemWidth+20));this.records.css("width",this.collection.models.length*(this.singleWidth+5));_.each(this.collection.models,function(l){var m;m=new myd.TurntableCollageView({model:l,container:k.turntable});k.turntableViews.push(m);return m.renderScreens()});this.getScreensForCollection(0);this.turntable.find("li").unbind("click");this.records.find("li").eq(0).addClass("pager-active");this.recordsContainer.find(".turntable-arrow-left").css("opacity",0);if(this.recordsCount<=10){this.recordsContainer.find(".turntable-arrow-right").hide()}this.slider=new myd.TurntableModule({el:this.$el.find("#turntable"),onAfterSlide:function(m,l){return k.getScreensForCollection(m,l)}});this.turntable.hover(function(){return k.slider.stopTimer()},function(){return k.slider.startTimer()});if(myd.feature.turntableslide){$("#explore-turntable").css("margin-top","-592px");return window.setTimeout(function(){return $("#explore-turntable").animate({"margin-top":"-492px"},1000)},750)}};e.prototype.getScreensForCollection=function(i,h){var l,g,j,k=this;if(!this.turntableViews.length){this.$el.hide();return false}g=this.turntable.find(".pager-active");g.removeClass("pager-active");g.find(".previous").removeClass(".previous");g.prev().find(".turntable-arrow-left").remove();g.next().find(".turntable-arrow-right").remove();this.records.find(".pager-active").removeClass("pager-active");this.turntable.removeClass("forced");if(!this.turntableViews.length){this.$el.hide();this.close();return}this.turntableViews[i].$el.addClass("pager-active");window.setTimeout(function(){return k.turntableViews[i].$el.find(".collage-cover").addClass("previous")},750);this.$el.find("#records li").eq(i).addClass("pager-active");if(h){this.turntable.addClass("forced")}l=this.turntable.find(".pager-active");l.prev().append('<div class="turntable-arrow-left advance" />');l.next().append('<div class="turntable-arrow-right advance" />');j=Math.floor(i/10);if(this.filmstripPage!==j){return this.jumpToRecordSlide(j)}};e.prototype.clickecBack=function(){this.slider.goToPreviousSlide();return false};e.prototype.clickedSingle=function(i){var g,h;g=$(i.target);h=this.records.find("li").index(i.target);this.slider.slide(h,true);this.records.find(".pager-active").removeClass("pager-active");$(i.target).addClass("pager-active");$("#explore-turntable").css("margin-top","0");return false};e.prototype.clickedAdvance=function(h){var g;g=this.turntable.children().index($(h.target).parents("li.item"));this.slider.slide(g,true);return false};e.prototype.clickPrevFilmstrip=function(){if(this.filmstripPage===0){return false}return this.jumpToRecordSlide(this.filmstripPage-1)};e.prototype.clickNextFilmstrip=function(){if(Math.floor(this.recordsCount/10)===this.filmstripPage+1){return}return this.jumpToRecordSlide(this.filmstripPage+1)};e.prototype.jumpToRecordSlide=function(g){this.filmstripPage=g;this.records.css("left",((this.recordsContainer.find(".container").width()+5)*this.filmstripPage)*-1);if(this.filmstripPage>0&&this.recordsCount>10){this.recordsContainer.find(".turntable-arrow-left").css({opacity:1,cursor:"pointer"})}else{this.recordsContainer.find(".turntable-arrow-left").css({opacity:0,cursor:"default"})}if(Math.floor(this.recordsCount/10)-1===this.filmstripPage){this.recordsContainer.find(".turntable-arrow-right").css({opacity:0,cursor:"default"})}else{this.recordsContainer.find(".turntable-arrow-right").css({opacity:1,cursor:"pointer"})}return false};e.prototype.onClose=function(){var g;if((g=this.slider)!=null){g.close()}return _.each(this.views,function(h){return h!=null?h.close():void 0})};return e})(Backbone.View);global.myd.TurntableExploreView=b}).call(this);(function(){var a,e,d,f,b={}.hasOwnProperty,c=function(j,h){for(var g in h){if(b.call(h,g)){j[g]=h[g]}}function i(){this.constructor=j}i.prototype=h.prototype;j.prototype=new i();j.__super__=h.prototype;return j};if((f=global.myd)==null){global.myd={}}e=global.myd.renderAsset;d=myd.serviceModule;a=(function(h){c(g,h);function g(){return g.__super__.constructor.apply(this,arguments)}g.prototype.tagName="div";g.prototype.className="wayback";g.prototype.collection=myd.WayBackCollection;g.prototype.turntableViews=[];g.prototype.initialize=function(i){this.containerEl=i.container;this.collection.bind("add",this.render,this);return this.collection.bind("reset",this.render,this)};g.prototype.render=function(){var i,j,k=this;$("#wayback").remove();if(this.collection.models.length<2){$("#content").removeClass("wayback");return}$("#content").addClass("wayback");i={collection:{models:this.collection.toJSON()}};j=Mustache.render($("#way_back_template").html(),i);$(j).insertAfter("body > header");this.setElement($("#wayback",this.containerEl));return _.each(this.collection.models,function(l){var m;m=new myd.BreadcrumbView({model:l,container:k.$el.find("ol")});m.bind("goBack",function(n){return k.collection.rollBackHistory(n)});return k.turntableViews.push(m)})};g.prototype.onClose=function(){return _.each(this.views,function(i){crumbView.unbind("goBack",this.rollBackHistory,this);return i.close()})};return g})(Backbone.View);global.myd.WayBackView=a}).call(this);(function(){var a,b;if((b=global.myd)==null){global.myd={}}a=Backbone.Collection.extend({model:myd.BreadcrumbModel,overflow:[],initialize:function(){return this},add:function(d,c){var e;e=_.first(this.models);if((e!=null)&&d.get("name")===e.get("name")&&d.get("url")===e.get("url")){return}if(this.models.length>5){this.overflow.push(this.pop())}return Backbone.Collection.prototype.add.call(this,d,c)},rollBackHistory:function(c){var f,e,d,h,g;e=this.indexOf(c);for(d=h=0;0<=e?h<=e:h>=e;d=0<=e?++h:--h){this.shift()}this.reset(this.models);f=4-e;for(d=g=1;1<=f?g<=f:g>=f;d=1<=f?++g:--g){this.addOverflow(d)}return Router.navigate(c.get("url"),{trigger:true})},addOverflow:function(){var c;c=this.overflow.pop();if(c!=null){return this.add(c,{silent:true})}}});global.myd.WayBackCollection=a}).call(this);(function(){var a,b;if((b=global.myd)==null){global.myd={}}a=Backbone.Collection.extend({model:myd.CommentModel,fetched:false,initialize:function(c){this.commentsUrl=c.comments_url;return this},save:function(d){var c=this;return myd.serviceModule.post({url:this.commentsUrl,data:d.toJSON(),success:function(e){return c.add(e)},error:function(e){return c.trigger("errorReset")}})},"delete":function(d){var c=this;if(d.get("deleted")){return myd.serviceModule["delete"]({url:d.get("entity_url"),success:function(e){return c.remove(d)},error:function(e){return c.trigger("errorReset")}})}},fetch:function(d,c){var e=this;if(d==null){d=0}if(c==null){c=20}this.fetched=true;return myd.serviceModule.get({url:this.commentsUrl,data:{page:d,per_page:c},success:function(f){if(d===0){return e.reset(f)}else{return e.add(f.reverse(),{at:0})}},error:function(f){return e.trigger("errorReset")}})}});global.myd.CommentsCollection=a}).call(this);(function(){var g,b,h,f,a,e,c={}.hasOwnProperty,d=function(l,j){for(var i in j){if(c.call(j,i)){l[i]=j[i]}}function k(){this.constructor=l}k.prototype=j.prototype;l.prototype=new k();l.__super__=j.prototype;return l};if((e=global.myd)==null){global.myd={}}g=Backbone.Collection.extend({model:myd.ScreenModel,initialize:function(){},comparator:function(i){return i.get("index")},fetch:function(j){var i,k=this;i=this.getUrl(j);if(this.contentLoaded(i)){return}return myd.serviceModule.get({url:i,success:function(l){return k.parse(l)},error:function(l){return k.trigger("errorReset")}})},fetchByUrl:function(i){var j=this;if(this.contentLoaded(i)){return}return myd.serviceModule.get({url:i,success:function(k){return j.parse(k)},error:function(k){return j.trigger("errorReset")}})},fetchSearchResults:function(i){var j=this;return myd.serviceModule.get({url:myd.urls.search+i,success:function(k){return j.parse(k)}})},fetchInternalSearchResults:function(i){var j=this;return myd.serviceModule.get({url:myd.urls.search_internal+i,success:function(k){return j.parse(k)}})},parse:function(k){var l,m,n,j,i;this.frontMatter=new myd.FrontMatterTileModel(k.collection);this.uid=k.collection.uid;this.syncUrl=k.collection.sync_url;this.url=this.syncUrl;this.newItemUrl=k.collection.add_new_item_url;this.coverUrl=k.collection.cover_url;this.coverAsset=k.collection.cover_asset;this.editItemsUrl=k.collection.edit_items_url;this.collection=k.collection;this.originalCover=new myd.ItemModel(k.collection.cover_asset);if(this.context==="popular"){this.collection.screens=this.sortScreensCollectedCountDescending()}if(this.context==="latest"){this.collection.screens=this.sortScreensByDateDescending()}if(this.context==="topic"){if(this.filter==="popular"){this.collection.screens=this.sortScreensCollectedCountDescending()}if(this.filter==="latest"){this.collection.screens=this.sortScreensByDateDescending()}}m=[];i=k.collection.screens;for(n=0,j=i.length;n<j;n++){l=i[n];if(l.item.cover_asset==null){l.item.cover_asset={thumbnail_url:"/images/default_new_collection.png",asset_url:"/images/default_new_collection.png"}}if(typeof l.editable==="undefined"&&this.context==="profile"){l.editable=k.collection.editable}m.push(new myd.ScreenModel(l))}this.reset(m,{sort:false});return this.originalResponse=k},sortScreensCollectedCountDescending:function(){var i,j=this;i=_.sortBy(this.collection.screens,function(k){return -k.item.collected_count});return i},sortScreensByDateDescending:function(){var i,j=this;i=_.sortBy(this.collection.screens,function(k){return -k.item.created_timestamp});return i},cancelEditing:function(){this.setCoverImage(this.originalCover);this.parse(this.originalResponse);return this.sync()},setCoverImage:function(i){var j=this;return myd.serviceModule.post({url:this.coverUrl,data:{cover_asset_url:i.get("entity_url")},success:function(k){}})},getUrl:function(i){if(i!=null){return i.pathname}else{return this.url}},getLastPath:function(){if(this.lastRequestUrl!=null){if(this.lastRequestUrl.indexOf("http://")>-1){return false}else{return this.lastRequestUrl.slice(1)}}else{return""}},contentLoaded:function(i){if(this.lastRequestUrl===i){return true}this.lastRequestUrl=i;return false},deleteScreen:function(i,j){var k=this;return myd.serviceModule["delete"]({url:j.get("item").get("type")==="collection"?myd.urls.edit_collection:j.get("item").get("entity_url"),data:j.get("item").get("type")==="collection"?[i]:void 0,success:function(m){var l;_.each(k.models,function(n){if(n.get("originalUID")===j.get("uid")&&n.get("type")==="collection"){return n.set({type:"fact",text:"This item has been removed by the owner.",thumbnail_url:null})}});k.remove(j);l=k.frontMatter.get("collection_count");k.frontMatter.set("collection_count",--l);return k.reset(k.models)},error:function(l){return k.trigger("errorReset")}})},addItemToCollection:function(j,i){var k=this;if(i==null){i=0}return myd.serviceModule.post({url:this.editItemsUrl,data:[{entity_url:j.get("entity_url"),index:i}],success:function(l){return k.add(new myd.ScreenModel(l[0]),{at:i})},error:function(l){return global.myd.modalAlert(l.responseText)}})},addNewItem:function(j,i){var k=this;if(i==null){i=0}j.set("index",i);return myd.serviceModule.post({url:this.newItemUrl,data:j,success:function(l){return k.add(new myd.ScreenModel(l),{at:i})},error:function(l){return global.myd.modalAlert(l.responseText)}})},saveCurrentStateAsOriginal:function(){var i,j=this;i={};i.collection=this.frontMatter.toJSON();i.collection.screens=this.toJSON();_.each(i.collection.screens,function(k){return k.item=k.item.toJSON()});return this.originalResponse=i},sync:function(j){var k,l,i,m=this;l=[];i=true;_.each(this.models,function(n){var o;if(!n.isNew()){o=n.changed;o.uid=n.get("uid");if(!_.isEmpty(n.get("item").changed)){o.item=n.get("item").changed}delete o.index;delete o.nextIndex;delete o.prevIndex;if(o.item!=null){o.item.uid=n.get("item").get("uid")}}else{o=n}l.push(o);if(Object.keys(o).length>1){return i=true}});k=this.frontMatter.changed;if(Object.keys(k).length){i=true}k.screens=l;if(!i){if(j!=null){j()}return}return myd.serviceModule.post({url:this.syncUrl,data:k,success:function(n){if(j!=null){return j(n)}},error:function(n){return global.myd.modalAlert(n.responseText)}})},syncReorder:function(i,j){var k=this;return myd.serviceModule.post({url:this.syncUrl,data:{screens:i},success:function(l){if(j!=null){return j()}},error:function(l){return global.myd.modalAlert(l.responseText)}})}});h=(function(i){d(j,i);function j(){return j.__super__.constructor.apply(this,arguments)}j.prototype.initialize=function(){return this.context="popular"};return j})(g);b=(function(j){d(i,j);function i(){return i.__super__.constructor.apply(this,arguments)}i.prototype.initialize=function(){return this.context="latest"};return i})(g);a=(function(j){d(i,j);function i(){return i.__super__.constructor.apply(this,arguments)}i.prototype.initialize=function(){return this.context="topic"};return i})(g);f=(function(i){d(j,i);function j(){return j.__super__.constructor.apply(this,arguments)}j.prototype.initialize=function(){return this.context="profile"};return j})(g);global.myd.GridCollection=g;global.myd.PopularGridCollection=h;global.myd.LatestGridCollection=b;global.myd.TopicGridCollection=a;global.myd.ProfileGridCollection=f}).call(this);(function(){var b,a;if((a=global.myd)==null){global.myd={}}b=Backbone.Collection.extend({model:myd.ItemModel,fetched:false,initialize:function(c){this.url=myd.urls.my_collected;return this},fetch:function(c){var d=this;return myd.serviceModule.get({url:c==="Collection"?myd.urls.my_profile:this.url,success:function(f){var g,h,e;if(c!=="Collection"){h=(function(){var l,k,i,j;i=f.items;j=[];for(l=0,k=i.length;l<k;l++){g=i[l];if(g.type===c){j.push(g)}}return j})();_.each(f.items,function(i){i.image_300_url=i.thumbnail_url;if(i.type===c){if(i.type.toLowerCase()==="collection"&&(i.cover_asset!=null)){i.image_300_url=i.cover_asset.thumbnail_url}else{if(i.type.toLowerCase()==="videoasset"&&(i.youtube_id!=null)){i.image_300_url=myd.getVideoUrl(i.youtube_id)}}return h.push(i)}});return d.reset(d.parse(h))}else{h=(function(){var l,k,i,j;i=f.collection.screens;j=[];for(l=0,k=i.length;l<k;l++){e=i[l];if(e.item.type!=null){j.push(e.item)}}return j})();return d.reset(d.parse(h))}}})},fetchSearchResults:function(c){var d=this;return myd.serviceModule.get({url:myd.urls.search+c,success:function(f){var e;e=[];_.each(f.collection.screens,function(g){return e.push({title:g.title,image_300_url:g.assets[0].thumbnail_url,asset_url:g.assets[0].asset_url,type:"ImageAsset",search_origin:g.search_origin,source_page_url:g.assets[0].asset_url})});return d.reset(d.parse(e))}})}});global.myd.ItemsCollection=b}).call(this);(function(){var a,b;if((b=global.myd)==null){global.myd={}}a=Backbone.Collection.extend({model:myd.NotificationModel,initialize:function(c){this.fetchUrl=myd.urls.notifications;return this},fetch:function(){var c=this;return myd.serviceModule.get({url:this.fetchUrl,success:function(d){return c.reset(d)},error:function(d){return c.trigger("errorReset")}})},markAllRead:function(){var c=this;return myd.serviceModule.post({url:this.fetchUrl,success:function(d){return _.each(c.models,function(e){return e.set("read",true)})}})}});global.myd.NotificationsCollection=a}).call(this);(function(){var d,a,e,b={}.hasOwnProperty,c=function(i,g){for(var f in g){if(b.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i};if((e=global.myd)==null){global.myd={}}a=myd.routesModule;d=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.routes={"":"latest",papyrus:"latest",latest:"latest",popular:"popular",search:"search","search/:query":"search","topic/:uid":"topicLatest","topic/:uid/latest":"topicLatest","topic/:uid/popular":"topicPopular",bookmarklet:"bookmarklet","?:query_params":"latest","papyrus?:query_params":"latest"};f.prototype.initialize=function(h){this.appView=h.app_view;this.currentUsersUserPath=new global.myd.Uri(global.myd.urls.current_user).getPathname();this.route(/^c\/(.*)$/,"collectionRoute",this.showCollection);this.route(/^c\/(.*)\/screens\/([^\/\?]+)/,"collection",this.showCollection);this.route(/^p\/(.*)\/([^\/\?]+)/,"profileTab",this.profileTab);return this.bind("all",this.trackPageview)};f.prototype.trackPageview=function(){var h;h=Backbone.history.getFragment();if(typeof _gaq!=="undefined"&&_gaq!==null){return _gaq.push(["_trackPageview","/"+h])}};f.prototype.topicLatest=function(h){return this.appView.showTopic({uid:h,filter:"latest"})};f.prototype.topicPopular=function(h){return this.appView.showTopic({uid:h,filter:"popular"})};f.prototype.latest=function(){return this.appView.showLatest()};f.prototype.popular=function(){return this.appView.showPopular()};f.prototype.bookmarklet=function(){return this.appView.showBookmarklet()};f.prototype.showCollection=function(k,j,i){var h;if(i==null){i=false}h=a.getRoutesFromRelativePath(k);return this.appView.showCollection(h,j)};f.prototype.search=function(h){return this.appView.showSearch(h)};f.prototype.profileTab=function(h,i){return this.appView.showProfile({tab:i,userPath:h})};f.prototype.navigateToProfileTabForCurrentUser=function(i,h){if(h==null){h={}}return this.navigateToProfileTab({tab:i,userPath:this.currentUsersUserPath})};f.prototype.navigateToProfileTab=function(h){return this.navigate("p"+h.userPath+"/"+h.tab,{trigger:true})};f.prototype.navigateToEditCollection=function(h,i){this.navigate(h,i);return this.appView.currentView.startInEditMode=true};return f})(Backbone.Router);global.myd.PapyrusRouter=d}).call(this);(function(){var a;if((a=global.myd)==null){global.myd={}}$(document).ready(function(){var c,d,b,e;d=$.browser.msie;b=$.browser.version;if(d&&b<9){this.template=$("#unsupported_browser").html();e=Mustache.render(this.template);$("body").html(e)}Backbone.View.prototype.close=function(){this.remove();this.unbind();if(this.onClose!=null){return this.onClose()}};c=c!=null?c:new myd.AppView();return Backbone.history.start({pushState:true,root:"/papyrus/"})})}).call(this);(function(){global.myd.UserAdmin=(function(){function a(){}a.prototype.initialize=function(){var b=this;return $("#save_btn").bind("click",function(){return b.post()})};a.prototype.post=function(){var b,c=this;b=$("#emailAddress").val();return $.ajax({url:myd.urls.new_beta_whitelist_user,type:"post",data:{email:$.trim(b)},success:function(){return c.handleResponse(b,"success")},error:function(){return c.handleResponse(b,"fail")}})};a.prototype.handleResponse=function(d,c){var b,e;e="There was an issue with saving "+d+" please try again later.";b=$("<li class='newUser saving' style='display:none'></li>");if(c==="success"){e=""+d;$("#result").prepend(b);$(".newUser:first").text(e).fadeIn("slow",function(){return $(this).removeClass("saving").addClass("saved")});return $("#emailAddress").val("")}else{return alert("there was an issue please try again.")}};return a})()}).call(this);